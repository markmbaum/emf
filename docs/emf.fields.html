
    <html lang="en">
        <head>
            <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
            <title>emf.fields</title>
            <link href="https://fonts.googleapis.com/css?family=Anonymous+Pro|Open+Sans" rel="stylesheet">
            <style>body{color:#ABB2BF;background-color:#282C34;font-family:'Anonymous Pro', monospace;margin:0;padding:0;overflow:scroll;}#back-to-top{position:fixed;right:0;bottom:0;padding:3px;margin:0;background-color:inherit;color:#828997;font-family:"Open Sans", sans-serif;font-size:11pt;text-decoration:none;border-top:1px solid #505050;border-left:1px solid #505050;}#mod-docstr{margin:0;text-align:justify;line-height:150%;color:#ABB2BF;font-family:"Open Sans", sans-serif;font-size:11pt;}.monospace-span{font-family:'Anonymous Pro', monospace;font-size:125%;}#nav-wrapper{position:absolute;top:0;left:0;margin:0;padding:0 5px 0 0;min-height:1vh;background-color:#20242C;}#nav{position:fixed;top:0;left:0;bottom:0;overflow-y:scroll;padding:0.5cm;min-height:1vh;background-color:inherit;border-right:1px solid #505050;}#nav::-webkit-scrollbar{width:4px;}#nav h2{font-family:"Open Sans", sans-serif;font-weight:normal;font-size:24pt;margin:0.25cm 0;}#nav-ul{margin:0;padding:0;list-style-type:none;}.nav-li{font-family:"Open Sans", sans-serif;font-size:18pt;margin:0.5cm 0;}.nav-li a{text-decoration:none;color:#828997;}.subnav-ul{list-style-type:none;padding:0 0 0 0.5cm;margin:0.5cm 0;}.subnav-li{font-family:"Anonymous Pro", monospace;font-size:13pt;margin:0.15cm 0;}.subnav-li a{text-decoration:none;color:#828997;}.subsubnav-ul{list-style-type:none;padding:0 0 0 0.5cm;margin:0.4cm 0;}.subsubnav-li{font-family:"Open Sans", sans-serif;font-size:11pt;margin:0.15cm 0;}.subsubnav-li a{text-decoration:none;color:#828997;}.subsubsubnav-ul{list-style-type:none;padding:0 0 0 0.5cm;margin:0.3cm 0;}.subsubsubnav-li{font-family:"Anonymous Pro", monospace;font-size:11pt;margin:0.15cm 0;}.subsubsubnav-li a{text-decoration:none;color:#828997;}#nav a:hover{font-weight:700;color:#ABB2BF;/*background-color:#282C34;*/}#main{float:right;z-index:-1;}#main h1{font-family:"Open Sans", sans-serif;font-weight:normal;font-size:400%;text-align:center;margin:1cm 0;}.section{margin:1cm;padding:5% 5% 5% 1cm;border:1px solid #484848;border-radius:12px;}.section h2{font-weight:normal;font-size:250%;font-family:"Open Sans", sans-serif;text-align:center;margin:0 0 1cm 0;}.docstr{margin:.5cm 0 .5cm 1cm;font-size:90%;text-align:justify;line-height:125%;color:#98C379;}.docstr pre{margin:0;padding:0;font-size:inherit;}.class{border-top:1px solid #404040;}.class h3{font-weight:normal;font-size:200%;font-family:"Open Sans", sans-serif;padding:0;margin:1cm 0 0 0.5cm;}#classes .class{margin-top:1cm;}.class .function{padding-left:0.1cm;border-left:1px solid #404040;}.properties{margin:1cm 0;padding-left:0.1cm;border-left:1px solid #404040;}.properties h4{font-weight:normal;font-family:"Open Sans", sans-serif;font-size:150%;}.properties .property{margin-left:1cm;padding-left:0.1cm;border-left:1px solid #383838;}.methods{margin:1cm 0 0 0;padding-left:0.1cm;border-left:1px solid #404040;}.methods h4{font-weight:normal;font-family:"Open Sans", sans-serif;font-size:150%;}.methods .function{margin-left:1cm;border-left:1px solid #383838;}#functions .function{border-top:1px solid #404040;}.function .function-name{color:#61AFEF;}.function .function-arg{color:#D19A66;}.function .default-str{color:#98C379;}.source{display:inline-block;margin:.5cm 0 .5cm 1cm;border:1px solid #383838;border-radius:12px;}.source h4{font-family:"Open Sans", sans-serif;font-weight:400;font-size:10pt;margin:0;padding:0.25cm;cursor:pointer;}.source .code{display:none;overflow:auto;padding:0 0.5cm 0.5cm 0.5cm;font-size:10pt;}.other{margin:0.5cm 0;}.other-type{margin:.1cm .1cm .1cm 0;color:#5C6370;}.other-value{margin:.1cm .1cm .1cm 0;color:#5C6370;}.other .comments{margin:0;padding:0.5cm 0 0.5 1cm;}.highlight .k {color:#C678DD;} .highlight .nf {color:#61AFEF;} .highlight .nf .n {color:#D19A66;} .highlight .nb {color:#56B6C2;} .highlight .o {font-weight:bold;} .highlight .ow {color:#C678DD;} .highlight .s1 {color:#98C379;} .highlight .s2 {color:#98C379;} .highlight .sd {color:#98C379;} .highlight .si {color:#D19A66;} .highlight .mi {color:#D19A66;} .highlight .mf {color:#D19A66;} .highlight .mh {color:#D19A66;} .highlight .mo {color:#D19A66;} .highlight .bp {color:#D19A66;} .highlight .c1 {color:#5C6370;}</style>
    	</head>
        <body onresize="arrange()" onload="arrange()">

            <!--Back to Top Button-->
            <a id="back-to-top" href="#">back to top</a>

            <!--Navigation Sidebar-->
            <div id="nav-wrapper">
                <div id="nav">
                    <h2>contents</h2>
                    <ul id="nav-ul">
            <li class="nav-li"><a href="#functions">functions</a>
                <ul class="subnav-ul"><li class="subnav-li"><a href="#B_field">B_field</a></li><li class="subnav-li"><a href="#E_field">E_field</a></li><li class="subnav-li"><a href="#close">close</a></li><li class="subnav-li"><a href="#convert_DAT">convert_DAT</a></li><li class="subnav-li"><a href="#convert_DAT_crawl">convert_DAT_crawl</a></li><li class="subnav-li"><a href="#drop_template">drop_template</a></li><li class="subnav-li"><a href="#ion">ion</a></li><li class="subnav-li"><a href="#load_template">load_template</a></li><li class="subnav-li"><a href="#optimize_phasing">optimize_phasing</a></li><li class="subnav-li"><a href="#phasors_to_magnitudes">phasors_to_magnitudes</a></li><li class="subnav-li"><a href="#plot_Bmax">plot_Bmax</a></li><li class="subnav-li"><a href="#plot_Emax">plot_Emax</a></li><li class="subnav-li"><a href="#plot_groups">plot_groups</a></li><li class="subnav-li"><a href="#plot_groups_at_ROW">plot_groups_at_ROW</a></li><li class="subnav-li"><a href="#plot_max_fields">plot_max_fields</a></li><li class="subnav-li"><a href="#plot_xs">plot_xs</a></li><li class="subnav-li"><a href="#read_DAT">read_DAT</a></li><li class="subnav-li"><a href="#run">run</a></li><li class="subnav-li"><a href="#show">show</a></li><li class="subnav-li"><a href="#target_fields">target_fields</a></li><li class="subnav-li"><a href="#to_FLD">to_FLD</a></li><li class="subnav-li"><a href="#to_FLDs">to_FLDs</a></li><li class="subnav-li"><a href="#to_FLDs_crawl">to_FLDs_crawl</a></li></ul>
            <li class="nav-li"><a href="#classes">classes</a>
                <ul class="subnav-ul"><li class="subnav-li"><a href="#Conductor">Conductor</a><ul class="subsubnav-ul"><li class="subsubnav-li"><a href=#Conductor-properties>properties</a><ul class="subsubsubnav-ul"><li class="subsubsubnav-li"><a href=#Conductor-I>I</a></li><li class="subsubsubnav-li"><a href=#Conductor-V>V</a></li><li class="subsubsubnav-li"><a href=#Conductor-complete>complete</a></li><li class="subsubsubnav-li"><a href=#Conductor-d_bund>d_bund</a></li><li class="subsubsubnav-li"><a href=#Conductor-d_cond>d_cond</a></li><li class="subsubsubnav-li"><a href=#Conductor-freq>freq</a></li><li class="subsubsubnav-li"><a href=#Conductor-phase>phase</a></li><li class="subsubsubnav-li"><a href=#Conductor-subconds>subconds</a></li><li class="subsubsubnav-li"><a href=#Conductor-tag>tag</a></li><li class="subsubsubnav-li"><a href=#Conductor-x>x</a></li><li class="subsubsubnav-li"><a href=#Conductor-y>y</a></li></ul></li><li class="subsubnav-li"><a href=#Conductor-methods>methods</a><ul class="subsubsubnav-ul"><li class="subsubsubnav-li"><a href=#Conductor-copy>copy</a></li></ul></li></ul></li><li class="subnav-li"><a href="#CrossSection">CrossSection</a><ul class="subsubnav-ul"><li class="subsubnav-li"><a href=#CrossSection-properties>properties</a><ul class="subsubsubnav-ul"><li class="subsubsubnav-li"><a href=#CrossSection-I>I</a></li><li class="subsubsubnav-li"><a href=#CrossSection-ROW_edge_fields>ROW_edge_fields</a></li><li class="subsubsubnav-li"><a href=#CrossSection-V>V</a></li><li class="subsubsubnav-li"><a href=#CrossSection-complete>complete</a></li><li class="subsubsubnav-li"><a href=#CrossSection-conds>conds</a></li><li class="subsubsubnav-li"><a href=#CrossSection-d_bund>d_bund</a></li><li class="subsubsubnav-li"><a href=#CrossSection-d_cond>d_cond</a></li><li class="subsubsubnav-li"><a href=#CrossSection-fields>fields</a></li><li class="subsubsubnav-li"><a href=#CrossSection-freq>freq</a></li><li class="subsubsubnav-li"><a href=#CrossSection-gnd>gnd</a></li><li class="subsubsubnav-li"><a href=#CrossSection-hot>hot</a></li><li class="subsubsubnav-li"><a href=#CrossSection-i>i</a></li><li class="subsubsubnav-li"><a href=#CrossSection-lROW>lROW</a></li><li class="subsubsubnav-li"><a href=#CrossSection-max_dist>max_dist</a></li><li class="subsubsubnav-li"><a href=#CrossSection-phase>phase</a></li><li class="subsubsubnav-li"><a href=#CrossSection-rROW>rROW</a></li><li class="subsubsubnav-li"><a href=#CrossSection-sample_height>sample_height</a></li><li class="subsubsubnav-li"><a href=#CrossSection-sheet>sheet</a></li><li class="subsubsubnav-li"><a href=#CrossSection-step>step</a></li><li class="subsubsubnav-li"><a href=#CrossSection-subconds>subconds</a></li><li class="subsubsubnav-li"><a href=#CrossSection-tag>tag</a></li><li class="subsubsubnav-li"><a href=#CrossSection-tags>tags</a></li><li class="subsubsubnav-li"><a href=#CrossSection-title>title</a></li><li class="subsubsubnav-li"><a href=#CrossSection-x>x</a></li><li class="subsubsubnav-li"><a href=#CrossSection-x_sample>x_sample</a></li><li class="subsubsubnav-li"><a href=#CrossSection-y>y</a></li><li class="subsubsubnav-li"><a href=#CrossSection-y_sample>y_sample</a></li></ul></li><li class="subsubnav-li"><a href=#CrossSection-methods>methods</a><ul class="subsubsubnav-ul"><li class="subsubsubnav-li"><a href=#CrossSection-add_conductor>add_conductor</a></li><li class="subsubsubnav-li"><a href=#CrossSection-compare_DAT>compare_DAT</a></li><li class="subsubsubnav-li"><a href=#CrossSection-copy>copy</a></li><li class="subsubsubnav-li"><a href=#CrossSection-export>export</a></li><li class="subsubsubnav-li"><a href=#CrossSection-remove_conductor>remove_conductor</a></li><li class="subsubsubnav-li"><a href=#CrossSection-sample>sample</a></li></ul></li></ul></li><li class="subnav-li"><a href="#SectionBook">SectionBook</a><ul class="subsubnav-ul"><li class="subsubnav-li"><a href=#SectionBook-properties>properties</a><ul class="subsubsubnav-ul"><li class="subsubsubnav-li"><a href=#SectionBook-ROW_edge_max>ROW_edge_max</a></li><li class="subsubsubnav-li"><a href=#SectionBook-complete>complete</a></li><li class="subsubsubnav-li"><a href=#SectionBook-i>i</a></li><li class="subsubsubnav-li"><a href=#SectionBook-name>name</a></li><li class="subsubsubnav-li"><a href=#SectionBook-sheets>sheets</a></li><li class="subsubsubnav-li"><a href=#SectionBook-tag_groups>tag_groups</a></li><li class="subsubsubnav-li"><a href=#SectionBook-tags>tags</a></li><li class="subsubsubnav-li"><a href=#SectionBook-titles>titles</a></li><li class="subsubsubnav-li"><a href=#SectionBook-xss>xss</a></li></ul></li><li class="subsubnav-li"><a href=#SectionBook-methods>methods</a><ul class="subsubsubnav-ul"><li class="subsubsubnav-li"><a href=#SectionBook-ROW_edge_export>ROW_edge_export</a></li><li class="subsubsubnav-li"><a href=#SectionBook-add_section>add_section</a></li><li class="subsubsubnav-li"><a href=#SectionBook-export>export</a></li><li class="subsubsubnav-li"><a href=#SectionBook-remove_section>remove_section</a></li><li class="subsubsubnav-li"><a href=#SectionBook-results_export>results_export</a></li><li class="subsubsubnav-li"><a href=#SectionBook-sample>sample</a></li></ul></li></ul></li></ul>
            <li class="nav-li"><a href="#others">others</a>
                <ul class="subnav-ul"><li class="subnav-li"><a href="#EPSILON">EPSILON</a></li><li class="subnav-li"><a href="#MU">MU</a></li><li class="subnav-li"><a href="#electric_prefactor">electric_prefactor</a></li><li class="subnav-li"><a href="#magnetic_prefactor">magnetic_prefactor</a></li></ul></ul></div></div>

            <div id="main">
                <h1>emf.fields</h1>
                <!--module docstring section-->
                <div class="section"><p id="mod-docstr">emf.fields was originally a small stand-alone package that streamlined the use of an old electromagnetic field (EMF) modeling program called FIELDS, which predicts electric and magnetic fields near parallel sets of power lines by assuming the conductors are infinitely long and computing the fields along a transect perpendicular to the power lines (a cross section model). The old FIELDS program is very difficult to use (details on why below), so it made sense to transplant as much of the modeling process as possible into other programs. Initially, to compute a cross section model, emf.fields would read power line information from excel templates, create input files that could be run through FIELDS to get EMF results, then read the FIELDS output files and provide plots, formatted results, etc. The package did everything except perform the actual EMF calculations. emf.fields still contains functions streamlining the use of FIELDS, but at this point the package does all the things the old FIELDS program does and more, including the EMF calculations, and it does them better.</p></div>

                <!--functions section-->
                <div class="section" id="functions"><h2>functions</h2><div class="function" id="B_field"><p class="function-str"><span class="function-name">B_field</span>(<span class="function-arg">x_cond</span>, <span class="function-arg">y_cond</span>, <span class="function-arg">I_cond</span>, <span class="function-arg">p_cond</span>, <span class="function-arg">x</span>, <span class="function-arg">y</span>)</p><p class="docstr">Calculate the approximate magnetic field generated by a group of conductors. Each of the variables with '_cond' should be an numpy array of parameters, where each index in those arrays describes a unique conductor, i.e. the 0th value in each variable is attributed to one power line.<br>&ensp;&ensp;&ensp;&ensp;args:<br>&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;x_cond - 1D numpy array, horizontal coordinates of conductors (ft)<br>&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;y_cond - 1D numpy array, vertical coordinates of conductors (ft)<br>&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;I_cond - 1D numpy array, currents of conductors (Amps)<br>&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;p_cond - 1D numpy array, phases of conductors (degrees)<br>&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;x - iterable of floats, horizontal coordinates of sample points (ft)<br>&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;y - iterable of floats, vertical coordinates of sample points (ft)<br>&ensp;&ensp;&ensp;&ensp;returns:<br>&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;Bx - 1D numpy array of complex numbers, magnitic field phasors in<br>&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;the horizontal direction (mG)<br>&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;By - 1D numpy array of complex numbers, magnitic field phasors in<br>&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;the vertical direction (mG)</p>
                <div class="source">
                    <h4 onclick="toggleSource(this)">show source</h4>
                    <div class="code">
                        <div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">B_field</span><span class="p">(</span><span class="n">x_cond</span><span class="p">,</span> <span class="n">y_cond</span><span class="p">,</span> <span class="n">I_cond</span><span class="p">,</span> <span class="n">p_cond</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Calculate the approximate magnetic field generated by a group of</span>
<span class="sd">    conductors. Each of the variables with &#39;_cond&#39; should be an numpy array of</span>
<span class="sd">    parameters, where each index in those arrays describes a unique conductor,</span>
<span class="sd">    i.e. the 0th value in each variable is attributed to one power line.</span>
<span class="sd">    args:</span>
<span class="sd">        x_cond - 1D numpy array, horizontal coordinates of conductors (ft)</span>
<span class="sd">        y_cond - 1D numpy array, vertical coordinates of conductors (ft)</span>
<span class="sd">        I_cond - 1D numpy array, currents of conductors (Amps)</span>
<span class="sd">        p_cond - 1D numpy array, phases of conductors (degrees)</span>
<span class="sd">        x - iterable of floats, horizontal coordinates of sample points (ft)</span>
<span class="sd">        y - iterable of floats, vertical coordinates of sample points (ft)</span>
<span class="sd">    returns:</span>
<span class="sd">        Bx - 1D numpy array of complex numbers, magnitic field phasors in</span>
<span class="sd">                the horizontal direction (mG)</span>
<span class="sd">        By - 1D numpy array of complex numbers, magnitic field phasors in</span>
<span class="sd">                the vertical direction (mG)&quot;&quot;&quot;</span>

    <span class="c1">#array length variables</span>
    <span class="n">N</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">p_cond</span><span class="p">)</span>         <span class="c1">#number of conductors</span>
    <span class="n">Z</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>              <span class="c1">#number of sample points or x,y pairs</span>

    <span class="c1">#conversions</span>
    <span class="n">x_cond</span> <span class="o">=</span> <span class="n">x_cond</span><span class="o">*</span><span class="mf">0.3048</span>          <span class="c1">#convert to meters</span>
    <span class="n">y_cond</span> <span class="o">=</span> <span class="n">y_cond</span><span class="o">*</span><span class="mf">0.3048</span>          <span class="c1">#convert to meters</span>
    <span class="n">p_cond</span> <span class="o">=</span> <span class="n">p_cond</span><span class="o">*</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mf">360.</span>    <span class="c1">#convert to radians</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">x</span><span class="o">*</span><span class="mf">0.3048</span>                    <span class="c1">#convert to meters</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">y</span><span class="o">*</span><span class="mf">0.3048</span>                    <span class="c1">#convert to meters</span>

    <span class="c1">#initialize complex current phasors</span>
    <span class="n">I</span> <span class="o">=</span> <span class="n">I_cond</span><span class="o">*</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">p_cond</span><span class="p">)</span> <span class="o">+</span> <span class="nb">complex</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">p_cond</span><span class="p">))</span>

    <span class="c1">#compute magnetic field component phasors for each x,y point</span>
    <span class="n">Bx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">Z</span><span class="p">,),</span> <span class="n">dtype</span> <span class="o">=</span> <span class="nb">complex</span><span class="p">)</span>
    <span class="n">By</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">Z</span><span class="p">,),</span> <span class="n">dtype</span> <span class="o">=</span> <span class="nb">complex</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">Z</span><span class="p">):</span> <span class="c1">#x,y pairs</span>
        <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">):</span> <span class="c1">#conductors</span>
            <span class="n">dx</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="n">a</span><span class="p">]</span> <span class="o">-</span> <span class="n">x_cond</span><span class="p">[</span><span class="n">b</span><span class="p">]</span>
            <span class="n">dy</span> <span class="o">=</span> <span class="n">y</span><span class="p">[</span><span class="n">a</span><span class="p">]</span> <span class="o">-</span> <span class="n">y_cond</span><span class="p">[</span><span class="n">b</span><span class="p">]</span>
            <span class="c1">#magnitude phasor</span>
            <span class="n">B</span> <span class="o">=</span> <span class="n">magnetic_prefactor</span><span class="o">*</span><span class="n">I</span><span class="p">[</span><span class="n">b</span><span class="p">]</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">dx</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">dy</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
            <span class="c1">#break it up into components</span>
            <span class="n">theta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arctan</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">dy</span><span class="o">/</span><span class="n">dx</span><span class="p">))</span>
            <span class="c1">#x component calculated with sine and y component with cosine</span>
            <span class="c1">#because the field is perpendicular to the line to the conductor,</span>
            <span class="c1">#potentially contrary to one&#39;s first instinct that sine goes</span>
            <span class="c1">#with y components and cosine with x components, but it&#39;s right</span>
            <span class="n">Bx</span><span class="p">[</span><span class="n">a</span><span class="p">]</span> <span class="o">-=</span> <span class="n">np</span><span class="o">.</span><span class="n">sign</span><span class="p">(</span><span class="n">dy</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span><span class="o">*</span><span class="n">B</span>
            <span class="n">By</span><span class="p">[</span><span class="n">a</span><span class="p">]</span> <span class="o">+=</span> <span class="n">np</span><span class="o">.</span><span class="n">sign</span><span class="p">(</span><span class="n">dx</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span><span class="o">*</span><span class="n">B</span>

    <span class="c1">#return phasors, complex numbers, for the x and y components</span>
    <span class="c1">#   - these complex phasors are converted to real valued outputs by the</span>
    <span class="c1">#   - phasors_to_magnitudes() function</span>
    <span class="k">return</span><span class="p">(</span><span class="n">Bx</span><span class="p">,</span> <span class="n">By</span><span class="p">)</span>
</pre></div>

                    </div>
                </div></div><div class="function" id="E_field"><p class="function-str"><span class="function-name">E_field</span>(<span class="function-arg">x_cond</span>, <span class="function-arg">y_cond</span>, <span class="function-arg">subconds</span>, <span class="function-arg">d_cond</span>, <span class="function-arg">d_bund</span>, <span class="function-arg">V_cond</span>, <span class="function-arg">p_cond</span>, <span class="function-arg">x</span>, <span class="function-arg">y</span>)</p><p class="docstr">Calculate the approximate electric field generated by a group of conductors. Each of the inputs with '_cond' in their name should be an numpy array of parameters, where each index in those arrays describes a unique conductor, i.e. the 0th value in each variable is attributed to one power line.<br>&ensp;&ensp;&ensp;&ensp;args:<br>&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;x_cond - 1D numpy array, horizontal coordinates of conductors (ft)<br>&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;y_cond - 1D numpy array, vertical coordinates of conductors (ft)<br>&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;subconds - 1D numpy array, number of subconductors per bundle<br>&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;d_cond - 1D numpy array, conductor diameters (inches)<br>&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;d_bund - 1D numpy array, bundle diameters (inches)<br>&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;V_cond - 1D numpy array, voltages of conductors (kilovolts, kV)<br>&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;p_cond - 1D numpy array, phases of conductors (degrees)<br>&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;x - iterable of floats, horizontal coordinates of sample points (ft)<br>&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;y - iterable of floats, vertical coordinates of sample points (ft)<br>&ensp;&ensp;&ensp;&ensp;returns:<br>&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;Ex - 1D numpy array of complex numbers, electric field phasors in<br>&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;the horizontal direction (kV/m)<br>&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;Ey - 1D numpy array of complex numbers, electric field phasors in<br>&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;the vertical direction (kV/m)</p>
                <div class="source">
                    <h4 onclick="toggleSource(this)">show source</h4>
                    <div class="code">
                        <div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">E_field</span><span class="p">(</span><span class="n">x_cond</span><span class="p">,</span> <span class="n">y_cond</span><span class="p">,</span> <span class="n">subconds</span><span class="p">,</span> <span class="n">d_cond</span><span class="p">,</span> <span class="n">d_bund</span><span class="p">,</span> <span class="n">V_cond</span><span class="p">,</span> <span class="n">p_cond</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Calculate the approximate electric field generated by a group of</span>
<span class="sd">    conductors. Each of the inputs with &#39;_cond&#39; in their name should be an numpy</span>
<span class="sd">    array of parameters, where each index in those arrays describes a unique</span>
<span class="sd">    conductor, i.e. the 0th value in each variable is attributed to one power</span>
<span class="sd">    line.</span>
<span class="sd">    args:</span>
<span class="sd">        x_cond - 1D numpy array, horizontal coordinates of conductors (ft)</span>
<span class="sd">        y_cond - 1D numpy array, vertical coordinates of conductors (ft)</span>
<span class="sd">        subconds - 1D numpy array, number of subconductors per bundle</span>
<span class="sd">        d_cond - 1D numpy array, conductor diameters (inches)</span>
<span class="sd">        d_bund - 1D numpy array, bundle diameters (inches)</span>
<span class="sd">        V_cond - 1D numpy array, voltages of conductors (kilovolts, kV)</span>
<span class="sd">        p_cond - 1D numpy array, phases of conductors (degrees)</span>
<span class="sd">        x - iterable of floats, horizontal coordinates of sample points (ft)</span>
<span class="sd">        y - iterable of floats, vertical coordinates of sample points (ft)</span>
<span class="sd">    returns:</span>
<span class="sd">        Ex - 1D numpy array of complex numbers, electric field phasors in</span>
<span class="sd">                the horizontal direction (kV/m)</span>
<span class="sd">        Ey - 1D numpy array of complex numbers, electric field phasors in</span>
<span class="sd">                the vertical direction (kV/m)&quot;&quot;&quot;</span>

    <span class="c1">#conversions and screening out underground lines</span>
    <span class="n">ohd</span> <span class="o">=</span> <span class="n">y_cond</span> <span class="o">&gt;</span> <span class="mf">0.</span>
    <span class="n">x_cond</span> <span class="o">=</span> <span class="n">x_cond</span><span class="p">[</span><span class="n">ohd</span><span class="p">]</span><span class="o">*</span><span class="mf">0.3048</span>         <span class="c1">#convert to meters</span>
    <span class="n">y_cond</span> <span class="o">=</span> <span class="n">y_cond</span><span class="p">[</span><span class="n">ohd</span><span class="p">]</span><span class="o">*</span><span class="mf">0.3048</span>         <span class="c1">#convert to meters</span>
    <span class="n">subconds</span> <span class="o">=</span> <span class="n">subconds</span><span class="p">[</span><span class="n">ohd</span><span class="p">]</span>
    <span class="n">d_cond</span> <span class="o">=</span> <span class="n">d_cond</span><span class="p">[</span><span class="n">ohd</span><span class="p">]</span><span class="o">*</span><span class="mf">0.0254</span>         <span class="c1">#convert to meters</span>
    <span class="n">d_bund</span> <span class="o">=</span> <span class="n">d_bund</span><span class="p">[</span><span class="n">ohd</span><span class="p">]</span><span class="o">*</span><span class="mf">0.0254</span>         <span class="c1">#convert to meters</span>
    <span class="n">V_cond</span> <span class="o">=</span> <span class="n">V_cond</span><span class="p">[</span><span class="n">ohd</span><span class="p">]</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mf">3.0</span><span class="p">)</span>   <span class="c1">#convert to ground reference from</span>
                                            <span class="c1">#line-line reference, leave in kV</span>
    <span class="n">p_cond</span> <span class="o">=</span> <span class="n">p_cond</span><span class="p">[</span><span class="n">ohd</span><span class="p">]</span><span class="o">*</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mf">360.</span>   <span class="c1">#convert to radians</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">x</span><span class="o">*</span><span class="mf">0.3048</span>                        <span class="c1">#convert to meters</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">y</span><span class="o">*</span><span class="mf">0.3048</span>                        <span class="c1">#convert to meters</span>

    <span class="c1">#array length variables</span>
    <span class="n">N</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">p_cond</span><span class="p">)</span>     <span class="c1">#number of conductors</span>
    <span class="n">Z</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>          <span class="c1">#number of sample points or x,y pairs</span>

    <span class="c1">#calculate the effective conductor diameters</span>
    <span class="n">d_cond</span>  <span class="o">=</span> <span class="n">d_bund</span><span class="o">*</span><span class="p">((</span><span class="n">subconds</span><span class="o">*</span><span class="n">d_cond</span><span class="o">/</span><span class="n">d_bund</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mf">1.</span><span class="o">/</span><span class="n">subconds</span><span class="p">))</span>

    <span class="c1">#compute the matrix of potential coefficients</span>
    <span class="n">range_N</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">)</span>
    <span class="n">P</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="n">N</span><span class="p">,</span><span class="n">N</span><span class="p">))</span>
    <span class="c1">#diagonals</span>
    <span class="n">P</span><span class="p">[</span><span class="n">range_N</span><span class="p">,</span> <span class="n">range_N</span><span class="p">]</span> <span class="o">=</span> <span class="n">electric_prefactor</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">4</span><span class="o">*</span><span class="n">y_cond</span><span class="o">/</span><span class="n">d_cond</span><span class="p">)</span>
    <span class="c1">#other elements</span>
    <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">range_N</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="n">range_N</span><span class="p">:</span>
            <span class="k">if</span><span class="p">(</span><span class="n">a</span> <span class="o">!=</span> <span class="n">b</span><span class="p">):</span>
                <span class="n">n</span> <span class="o">=</span> <span class="p">(</span><span class="n">x_cond</span><span class="p">[</span><span class="n">a</span><span class="p">]</span> <span class="o">-</span> <span class="n">x_cond</span><span class="p">[</span><span class="n">b</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="n">y_cond</span><span class="p">[</span><span class="n">a</span><span class="p">]</span> <span class="o">+</span> <span class="n">y_cond</span><span class="p">[</span><span class="n">b</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span>
                <span class="n">d</span> <span class="o">=</span> <span class="p">(</span><span class="n">x_cond</span><span class="p">[</span><span class="n">a</span><span class="p">]</span> <span class="o">-</span> <span class="n">x_cond</span><span class="p">[</span><span class="n">b</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="n">y_cond</span><span class="p">[</span><span class="n">a</span><span class="p">]</span> <span class="o">-</span> <span class="n">y_cond</span><span class="p">[</span><span class="n">b</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span>
                <span class="n">P</span><span class="p">[</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">]</span> <span class="o">=</span> <span class="n">electric_prefactor</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">n</span><span class="o">/</span><span class="n">d</span><span class="p">))</span>

    <span class="c1">#initialize complex voltage phasors</span>
    <span class="n">V</span> <span class="o">=</span> <span class="n">V_cond</span><span class="o">*</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">p_cond</span><span class="p">)</span> <span class="o">+</span> <span class="nb">complex</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">p_cond</span><span class="p">))</span>

    <span class="c1">#compute real and imaginary charge phasors</span>
    <span class="n">Q</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span><span class="n">P</span><span class="p">,</span> <span class="n">V</span><span class="p">)</span>

    <span class="c1">#compute components of the electric field phasors at each point, with each</span>
    <span class="c1">#column of E_x and E_y storing components due to each conductor, so that the</span>
    <span class="c1">#rows represent a spatial point across the ROW or an x,y pair</span>
    <span class="n">Ex</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="n">N</span><span class="p">,</span><span class="n">Z</span><span class="p">))</span>
    <span class="n">Ey</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="n">N</span><span class="p">,</span><span class="n">Z</span><span class="p">))</span>
    <span class="c1">#first compute the coefficients without the charges</span>
    <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">Z</span><span class="p">):</span>
        <span class="c1">#denominators, squared distance between the point and the conductors</span>
        <span class="n">d1</span> <span class="o">=</span> <span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">a</span><span class="p">]</span> <span class="o">-</span> <span class="n">x_cond</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="n">y</span><span class="p">[</span><span class="n">a</span><span class="p">]</span> <span class="o">-</span> <span class="n">y_cond</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span>
        <span class="n">d2</span> <span class="o">=</span> <span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">a</span><span class="p">]</span> <span class="o">-</span> <span class="n">x_cond</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="n">y</span><span class="p">[</span><span class="n">a</span><span class="p">]</span> <span class="o">+</span> <span class="n">y_cond</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span>
        <span class="c1">#x component numerator, the same for the conductor and its image</span>
        <span class="n">nx</span> <span class="o">=</span> <span class="n">electric_prefactor</span><span class="o">*</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">a</span><span class="p">]</span> <span class="o">-</span> <span class="n">x_cond</span><span class="p">)</span>
        <span class="c1">#y component numerators, different for the conductor and its image</span>
        <span class="n">ny1</span> <span class="o">=</span> <span class="n">electric_prefactor</span><span class="o">*</span><span class="p">(</span><span class="n">y</span><span class="p">[</span><span class="n">a</span><span class="p">]</span> <span class="o">-</span> <span class="n">y_cond</span><span class="p">)</span>
        <span class="n">ny2</span> <span class="o">=</span> <span class="n">electric_prefactor</span><span class="o">*</span><span class="p">(</span><span class="n">y</span><span class="p">[</span><span class="n">a</span><span class="p">]</span> <span class="o">+</span> <span class="n">y_cond</span><span class="p">)</span>
        <span class="c1">#evaluate</span>
        <span class="n">Ex</span><span class="p">[:,</span><span class="n">a</span><span class="p">]</span> <span class="o">=</span> <span class="n">nx</span><span class="o">/</span><span class="n">d1</span> <span class="o">-</span> <span class="n">nx</span><span class="o">/</span><span class="n">d2</span>
        <span class="n">Ey</span><span class="p">[:,</span><span class="n">a</span><span class="p">]</span> <span class="o">=</span> <span class="n">ny1</span><span class="o">/</span><span class="n">d1</span> <span class="o">-</span> <span class="n">ny2</span><span class="o">/</span><span class="n">d2</span>

    <span class="c1">#MUltiply the charges by the field coefficients calculated above</span>
    <span class="n">Q</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">tile</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">Q</span><span class="p">,</span> <span class="p">(</span><span class="n">N</span><span class="p">,</span><span class="mi">1</span><span class="p">)),</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">Z</span><span class="p">))</span>
    <span class="n">Ex</span> <span class="o">=</span> <span class="n">Ex</span><span class="o">*</span><span class="n">Q</span>
    <span class="n">Ey</span> <span class="o">=</span> <span class="n">Ey</span><span class="o">*</span><span class="n">Q</span>

    <span class="c1">#sum the phasors for each sample point, yielding the sum of phasors for each</span>
    <span class="c1">#conductor, which are the final phasors for each point</span>
    <span class="n">Ex</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">Ex</span><span class="p">,</span> <span class="n">axis</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span>
    <span class="n">Ey</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">Ey</span><span class="p">,</span> <span class="n">axis</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span>

    <span class="c1">#return phasors, complex numbers, for the x and y components</span>
    <span class="c1">#   - these complex phasors are converted to real valued outputs by the</span>
    <span class="c1">#   - phasors_to_magnitudes() function</span>
    <span class="k">return</span><span class="p">(</span><span class="n">Ex</span><span class="p">,</span> <span class="n">Ey</span><span class="p">)</span>
</pre></div>

                    </div>
                </div></div><div class="function" id="close"><p class="function-str"><span class="function-name">close</span>(*<span class="function-arg">args</span>)</p><p class="docstr">Call plt.close() on any Figure objects or lists of Figure objects passed in. If nothing is passed, all Figure objects are closed with plt.close('all')</p>
                <div class="source">
                    <h4 onclick="toggleSource(this)">show source</h4>
                    <div class="code">
                        <div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">close</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Call plt.close() on any Figure objects or lists of Figure objects passed</span>
<span class="sd">    in. If nothing is passed, all Figure objects are closed with</span>
<span class="sd">    plt.close(&#39;all&#39;)&quot;&quot;&quot;</span>
    <span class="k">if</span><span class="p">(</span><span class="n">args</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">args</span><span class="p">:</span>
            <span class="k">if</span><span class="p">(</span><span class="nb">hasattr</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="s1">&#39;__len__&#39;</span><span class="p">)):</span>
                <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="n">a</span><span class="p">:</span>
                    <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="n">b</span><span class="o">.</span><span class="n">number</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">number</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="s1">&#39;all&#39;</span><span class="p">)</span>
</pre></div>

                    </div>
                </div></div><div class="function" id="convert_DAT"><p class="function-str"><span class="function-name">convert_DAT</span>(<span class="function-arg">file_path</span>, **<span class="function-arg">kw</span>)</p><p class="docstr">read a DAT file and write it to a csv<br>&ensp;&ensp;&ensp;&ensp;args:<br>&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;file_path - target DAT file<br>&ensp;&ensp;&ensp;&ensp;kw:<br>&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;path - output location/name for csv file</p>
                <div class="source">
                    <h4 onclick="toggleSource(this)">show source</h4>
                    <div class="code">
                        <div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">convert_DAT</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;read a DAT file and write it to a csv</span>
<span class="sd">    args:</span>
<span class="sd">        file_path - target DAT file</span>
<span class="sd">    kw:</span>
<span class="sd">        path - output location/name for csv file&quot;&quot;&quot;</span>
    <span class="c1">#get the DAT data</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">read_DAT</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>
    <span class="c1">#write it to a csv</span>
    <span class="n">fn</span> <span class="o">=</span> <span class="n">fields_funks</span><span class="o">.</span><span class="n">_path_manage</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">file_path</span><span class="p">)[:</span><span class="n">file_path</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)],</span>
        <span class="s1">&#39;csv&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">)</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">fn</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">ofile</span><span class="p">:</span>
        <span class="n">df</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">ofile</span><span class="p">,</span> <span class="n">index_label</span> <span class="o">=</span> <span class="s1">&#39;Distance (ft)&#39;</span><span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="s1">&#39;DAT converted to csv: &quot;</span><span class="si">%s</span><span class="s1">&quot;&#39;</span> <span class="o">%</span> <span class="n">fn</span><span class="p">)</span>
</pre></div>

                    </div>
                </div></div><div class="function" id="convert_DAT_crawl"><p class="function-str"><span class="function-name">convert_DAT_crawl</span>(<span class="function-arg">dir_name</span>, **<span class="function-arg">kw</span>)</p><p class="docstr">crawl a directory and all of its subdirectories for .DAT files that can be passed to DAT_to_csv() for output re-formatting and optional plotting.<br>&ensp;&ensp;&ensp;&ensp;args:<br>&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;dir_name - Directory to initiate the crawl in.<br>&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;To designate the current directory, use '*'<br>&ensp;&ensp;&ensp;&ensp;kw:<br>&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;bundle - bool, if True, all DAT files found in the same directory<br>&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;are written to a common excel workbook. If False or absent,<br>&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;the DAT files are simply written to individual csv files.</p>
                <div class="source">
                    <h4 onclick="toggleSource(this)">show source</h4>
                    <div class="code">
                        <div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">convert_DAT_crawl</span><span class="p">(</span><span class="n">dir_name</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;crawl a directory and all of its subdirectories for .DAT files that can be</span>
<span class="sd">    passed to DAT_to_csv() for output re-formatting and optional plotting.</span>
<span class="sd">    args:</span>
<span class="sd">        dir_name - Directory to initiate the crawl in.</span>
<span class="sd">                    To designate the current directory, use &#39;*&#39;</span>
<span class="sd">    kw:</span>
<span class="sd">        bundle - bool, if True, all DAT files found in the same directory</span>
<span class="sd">                are written to a common excel workbook. If False or absent,</span>
<span class="sd">                the DAT files are simply written to individual csv files.&quot;&quot;&quot;</span>

    <span class="c1">#get input directory&#39;s file and subdir names</span>
    <span class="n">dir_contents</span> <span class="o">=</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">dir_name</span><span class="p">)</span>

    <span class="c1">#get the bundling option</span>
    <span class="k">if</span><span class="p">(</span><span class="s1">&#39;bundle&#39;</span> <span class="ow">in</span> <span class="n">kw</span><span class="p">):</span>
        <span class="n">bundle</span> <span class="o">=</span> <span class="n">kw</span><span class="p">[</span><span class="s1">&#39;bundle&#39;</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">bundle</span> <span class="o">=</span> <span class="bp">False</span>
    <span class="c1">#if bundle is True, set a flag for the existence of an ExcelWriter object</span>
    <span class="k">if</span><span class="p">(</span><span class="n">bundle</span><span class="p">):</span>
        <span class="n">xl_flag</span> <span class="o">=</span> <span class="bp">False</span>

    <span class="c1">#loop over the dir_contents</span>
    <span class="k">for</span> <span class="n">dir_element</span> <span class="ow">in</span> <span class="n">dir_contents</span><span class="p">:</span>
        <span class="c1">#if the file is a .DAT, convert it</span>
        <span class="k">if</span><span class="p">(</span><span class="n">dir_element</span><span class="p">[</span><span class="o">-</span><span class="mi">4</span><span class="p">:]</span> <span class="o">==</span> <span class="s1">&#39;.DAT&#39;</span><span class="p">):</span>
            <span class="c1">#if bundling is on, read the DAT and write it to the excel book</span>
            <span class="k">if</span><span class="p">(</span><span class="n">bundle</span><span class="p">):</span>
                <span class="c1">#if an ExcelWriter doesn&#39;t exist, initialize one and set flag</span>
                <span class="k">if</span><span class="p">(</span><span class="ow">not</span> <span class="n">xl_flag</span><span class="p">):</span>
                    <span class="n">xl_flag</span> <span class="o">=</span> <span class="bp">True</span>
                    <span class="n">fn</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">dir_element</span><span class="p">),</span>
                            <span class="s1">&#39;converted_DATs.xlsx&#39;</span><span class="p">)</span>
                    <span class="n">xl</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">ExcelWriter</span><span class="p">(</span><span class="n">fn</span><span class="p">,</span> <span class="n">engine</span> <span class="o">=</span> <span class="s1">&#39;xlsxwriter&#39;</span><span class="p">)</span>
                <span class="c1">#use the DAT&#39;s filename as the sheet name, without extension</span>
                <span class="n">sn</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">dir_element</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;.DAT&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
                <span class="c1">#read the DAT into a DataFrame and send it to the ExcelWriter</span>
                <span class="n">read_DAT</span><span class="p">(</span><span class="n">dir_element</span><span class="p">)</span><span class="o">.</span><span class="n">to_excel</span><span class="p">(</span><span class="n">xl</span><span class="p">,</span> <span class="n">sheet_name</span> <span class="o">=</span> <span class="n">sn</span><span class="p">,</span>
                    <span class="n">index_label</span> <span class="o">=</span> <span class="s1">&#39;Distance (ft)&#39;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1">#without bundling, write an individual csv file</span>
                <span class="n">convert_DAT</span><span class="p">(</span><span class="n">dir_element</span><span class="p">,</span> <span class="n">path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">dir_name</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1">#if there&#39;s a period in the dir_element, it&#39;s not a directory</span>
            <span class="k">if</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">dir_element</span><span class="p">)):</span>
                <span class="n">convert_DAT_crawl</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dir_element</span><span class="p">,</span> <span class="s1">&#39;*&#39;</span><span class="p">),</span> <span class="o">**</span><span class="n">kw</span><span class="p">)</span>
    <span class="c1">#close/save the excel bundles DAT results</span>
    <span class="k">if</span><span class="p">(</span><span class="n">bundle</span> <span class="ow">and</span> <span class="n">xl_flag</span><span class="p">):</span>
        <span class="n">xl</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
        <span class="k">print</span><span class="p">(</span><span class="s1">&#39;Converted DAT files written to &quot;</span><span class="si">%s</span><span class="s1">&quot;&#39;</span> <span class="o">%</span> <span class="n">fn</span><span class="p">)</span>
</pre></div>

                    </div>
                </div></div><div class="function" id="drop_template"><p class="function-str"><span class="function-name">drop_template</span>(*<span class="function-arg">args</span>, **<span class="function-arg">kw</span>)</p><p class="docstr">Copy the emf.fields template in the current directory or a directory specified by an input string<br>&ensp;&ensp;&ensp;&ensp;args:<br>&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;drop_path - string, path of copied template file</p>
                <div class="source">
                    <h4 onclick="toggleSource(this)">show source</h4>
                    <div class="code">
                        <div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">drop_template</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Copy the emf.fields template in the current directory or a directory</span>
<span class="sd">    specified by an input string</span>
<span class="sd">    args:</span>
<span class="sd">        drop_path - string, path of copied template file&quot;&quot;&quot;</span>
    <span class="c1">#check inputs</span>
    <span class="k">if</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">):</span>
        <span class="k">raise</span><span class="p">(</span><span class="n">fields_class</span><span class="o">.</span><span class="n">EMFError</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;drop_template only accepts zero or one</span>
<span class="s2">        input argument. A string can be passed to specify the directory in which</span>
<span class="s2">        the template file is copied. With no arguments, the template file is</span>
<span class="s2">        copied into the current directory.&quot;&quot;&quot;</span><span class="p">))</span>
    <span class="k">elif</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">):</span>
        <span class="n">kw</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;path&#39;</span><span class="p">:</span> <span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]}</span>
    <span class="c1">#get template file path</span>
    <span class="n">template_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">__file__</span><span class="p">))</span>
    <span class="n">template_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">template_path</span><span class="p">,</span> <span class="s1">&#39;templates&#39;</span><span class="p">)</span>
    <span class="n">template_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">template_path</span><span class="p">,</span> <span class="s1">&#39;fields-template.xlsx&#39;</span><span class="p">)</span>
    <span class="c1">#get drop path</span>
    <span class="n">drop_path</span> <span class="o">=</span> <span class="n">_path_manage</span><span class="p">(</span><span class="s1">&#39;fields-template&#39;</span><span class="p">,</span> <span class="s1">&#39;xlsx&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">)</span>
    <span class="c1">#copy and notify</span>
    <span class="n">shutil</span><span class="o">.</span><span class="n">copyfile</span><span class="p">(</span><span class="n">template_path</span><span class="p">,</span> <span class="n">drop_path</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="s1">&#39;emf.fields template written to: </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">drop_path</span><span class="p">)</span>
</pre></div>

                    </div>
                </div></div><div class="function" id="ion"><p class="function-str"><span class="function-name">ion</span>()</p><p class="docstr">Call plt.ion() to toggle interactive plotting on</p>
                <div class="source">
                    <h4 onclick="toggleSource(this)">show source</h4>
                    <div class="code">
                        <div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">ion</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;Call plt.ion() to toggle interactive plotting on&quot;&quot;&quot;</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ion</span><span class="p">()</span>
</pre></div>

                    </div>
                </div></div><div class="function" id="load_template"><p class="function-str"><span class="function-name">load_template</span>(<span class="function-arg">file_path</span>, **<span class="function-arg">kw</span>)</p><p class="docstr">Import conductor data from an excel template, loading each conductor into a Conductor object, each Conductor into a CrossSection object, and each CrossSection object into a SectionBook object. The SectionBook object is returned.<br>&ensp;&ensp;&ensp;&ensp;args:<br>&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;template_path - string, path to cross section template excel<br>&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;workbook<br>&ensp;&ensp;&ensp;&ensp;kw:<br>&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;sheets - list of strings, a list of sheet names to load, default is<br>&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;all sheets</p>
                <div class="source">
                    <h4 onclick="toggleSource(this)">show source</h4>
                    <div class="code">
                        <div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">load_template</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Import conductor data from an excel template, loading each conductor into</span>
<span class="sd">    a Conductor object, each Conductor into a CrossSection object, and each</span>
<span class="sd">    CrossSection object into a SectionBook object. The SectionBook object is</span>
<span class="sd">    returned.</span>
<span class="sd">    args:</span>
<span class="sd">        template_path - string, path to cross section template excel</span>
<span class="sd">                        workbook</span>
<span class="sd">    kw:</span>
<span class="sd">        sheets - list of strings, a list of sheet names to load, default is</span>
<span class="sd">                all sheets&quot;&quot;&quot;</span>
    <span class="c1">#import the cross sections as a dictionary of pandas DataFrames, also</span>
    <span class="c1">#getting a list of the ordered sheets</span>
    <span class="n">file_path</span> <span class="o">=</span> <span class="n">_check_extension</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="s1">&#39;xlsx&#39;</span><span class="p">,</span> <span class="s2">&quot;&quot;&quot;Templates must be excel</span>
<span class="s2">    workbooks. The input target path &quot;</span><span class="si">%s</span><span class="s2">&quot; is not recognized as an excel file&quot;&quot;&quot;</span> <span class="o">%</span>
    <span class="n">file_path</span><span class="p">)</span>
    <span class="n">xl</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">ExcelFile</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>
    <span class="n">sheets</span> <span class="o">=</span> <span class="n">xl</span><span class="o">.</span><span class="n">sheet_names</span>
    <span class="n">frames</span> <span class="o">=</span> <span class="n">xl</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">sheetname</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="n">skiprows</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">],</span>
            <span class="n">parse_cols</span> <span class="o">=</span> <span class="mi">16</span><span class="p">,</span> <span class="n">header</span> <span class="o">=</span> <span class="bp">None</span><span class="p">)</span>
    <span class="c1">#remove necessary sheets if the &#39;sheets&#39; keyword is passed in</span>
    <span class="k">if</span><span class="p">(</span><span class="s1">&#39;sheets&#39;</span> <span class="ow">in</span> <span class="n">kw</span><span class="p">):</span>
        <span class="n">include</span> <span class="o">=</span> <span class="n">kw</span><span class="p">[</span><span class="s1">&#39;sheets&#39;</span><span class="p">]</span>
        <span class="n">sheets</span> <span class="o">=</span> <span class="p">[</span><span class="n">sh</span> <span class="k">for</span> <span class="n">sh</span> <span class="ow">in</span> <span class="n">sheets</span> <span class="k">if</span> <span class="n">sh</span> <span class="ow">in</span> <span class="n">include</span><span class="p">]</span>
    <span class="c1">#create a SectionBook object to store the CrossSection objects</span>
    <span class="n">basename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>
    <span class="k">if</span><span class="p">(</span><span class="s1">&#39;.&#39;</span> <span class="ow">in</span> <span class="n">basename</span><span class="p">):</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">basename</span><span class="p">[:</span><span class="n">basename</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">basename</span>
    <span class="n">sb</span> <span class="o">=</span> <span class="n">fields_class</span><span class="o">.</span><span class="n">SectionBook</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
    <span class="c1">#convert the dataframes into a list of CrossSection objects</span>
    <span class="n">titles</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">sheets</span><span class="p">:</span>
        <span class="c1">#load miscellaneous information applicable to the whole CrossSection</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">frames</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
        <span class="n">xs</span> <span class="o">=</span> <span class="n">fields_class</span><span class="o">.</span><span class="n">CrossSection</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
        <span class="n">misc</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
        <span class="n">xs</span><span class="o">.</span><span class="n">tag</span> <span class="o">=</span> <span class="n">misc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">xs</span><span class="o">.</span><span class="n">title</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">misc</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="c1">#check for duplicate title inputs</span>
        <span class="k">if</span><span class="p">(</span><span class="n">xs</span><span class="o">.</span><span class="n">title</span> <span class="ow">in</span> <span class="n">titles</span><span class="p">):</span>
            <span class="k">raise</span><span class="p">(</span><span class="n">fields_class</span><span class="o">.</span><span class="n">EMFError</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;Cross-sections should have unique</span>
<span class="s2">            title entries. title: &quot;</span><span class="si">%s</span><span class="s2">&quot; in sheet: &quot;</span><span class="si">%s</span><span class="s2">&quot; is used by at least one</span>
<span class="s2">            other sheet.&quot;&quot;&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">xs</span><span class="o">.</span><span class="n">title</span><span class="p">,</span> <span class="n">k</span><span class="p">)))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">titles</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">xs</span><span class="o">.</span><span class="n">title</span><span class="p">)</span>
        <span class="n">xs</span><span class="o">.</span><span class="n">soil_resistivity</span> <span class="o">=</span> <span class="n">misc</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
        <span class="n">xs</span><span class="o">.</span><span class="n">max_dist</span> <span class="o">=</span> <span class="n">misc</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span>
        <span class="n">xs</span><span class="o">.</span><span class="n">step</span> <span class="o">=</span> <span class="n">misc</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span>
        <span class="n">xs</span><span class="o">.</span><span class="n">sample_height</span> <span class="o">=</span> <span class="n">misc</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span>
        <span class="n">xs</span><span class="o">.</span><span class="n">lROW</span> <span class="o">=</span> <span class="n">misc</span><span class="p">[</span><span class="mi">7</span><span class="p">]</span>
        <span class="n">xs</span><span class="o">.</span><span class="n">rROW</span> <span class="o">=</span> <span class="n">misc</span><span class="p">[</span><span class="mi">8</span><span class="p">]</span>
        <span class="c1">#load hot conductors</span>
        <span class="n">tags</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
            <span class="c1">#initialize a Conductor</span>
            <span class="n">cond</span> <span class="o">=</span> <span class="n">fields_class</span><span class="o">.</span><span class="n">Conductor</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">iat</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
            <span class="c1">#check for conductors with identical tags (names/labels)</span>
            <span class="k">if</span><span class="p">(</span><span class="n">cond</span><span class="o">.</span><span class="n">tag</span> <span class="ow">in</span> <span class="n">tags</span><span class="p">):</span>
                <span class="k">raise</span><span class="p">(</span><span class="n">fields_class</span><span class="o">.</span><span class="n">EMFError</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;Conductors in a Cross Section must</span>
<span class="s2">                have unique tags. The conductor tag &quot;</span><span class="si">%s</span><span class="s2">&quot; in sheet:     &quot;</span><span class="si">%s</span><span class="s2">&quot; is</span>
<span class="s2">                used at least twice.&quot;&quot;&quot;</span>
                <span class="o">%</span> <span class="p">(</span><span class="n">cond</span><span class="o">.</span><span class="n">tag</span><span class="p">,</span> <span class="n">k</span><span class="p">)))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">tags</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cond</span><span class="o">.</span><span class="n">tag</span><span class="p">)</span>
            <span class="c1">#cond.freq = misc[2]</span>
            <span class="n">cond</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">iat</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="n">cond</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span><span class="o">.</span><span class="n">iat</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="c1">#check for conductors with identical x,y coordinates</span>
            <span class="k">if</span><span class="p">(</span><span class="n">cond</span><span class="o">.</span><span class="n">x</span> <span class="ow">in</span> <span class="n">x</span><span class="p">):</span>
                <span class="n">idx</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">cond</span><span class="o">.</span><span class="n">x</span><span class="p">)</span>
                <span class="k">if</span><span class="p">(</span><span class="n">cond</span><span class="o">.</span><span class="n">y</span> <span class="o">==</span> <span class="n">y</span><span class="p">[</span><span class="n">idx</span><span class="p">]):</span>
                    <span class="k">raise</span><span class="p">(</span><span class="n">fields_class</span><span class="o">.</span><span class="n">EMFError</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;Conductors cannot have</span>
<span class="s2">                    identical x,y coordinates. Conductor &quot;</span><span class="si">%s</span><span class="s2">&quot; is in the exact</span>
<span class="s2">                    same place as conductor &quot;</span><span class="si">%s</span><span class="s2">&quot;.&quot;&quot;&quot;</span>
                <span class="o">%</span> <span class="p">(</span><span class="n">cond</span><span class="o">.</span><span class="n">tag</span><span class="p">,</span> <span class="n">tags</span><span class="p">[</span><span class="n">idx</span><span class="p">])))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">x</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cond</span><span class="o">.</span><span class="n">x</span><span class="p">)</span>
                <span class="n">y</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cond</span><span class="o">.</span><span class="n">y</span><span class="p">)</span>
            <span class="n">cond</span><span class="o">.</span><span class="n">subconds</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">iat</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="mi">5</span><span class="p">]</span>
            <span class="n">cond</span><span class="o">.</span><span class="n">d_cond</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">iat</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="mi">6</span><span class="p">]</span>
            <span class="n">cond</span><span class="o">.</span><span class="n">d_bund</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">iat</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="mi">7</span><span class="p">]</span>
            <span class="n">cond</span><span class="o">.</span><span class="n">V</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">iat</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="mi">8</span><span class="p">]</span>
            <span class="n">cond</span><span class="o">.</span><span class="n">I</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">iat</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="mi">9</span><span class="p">]</span>
            <span class="n">cond</span><span class="o">.</span><span class="n">phase</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">iat</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="mi">10</span><span class="p">]</span>
            <span class="n">xs</span><span class="o">.</span><span class="n">add_conductor</span><span class="p">(</span><span class="n">cond</span><span class="p">)</span>
        <span class="c1">#load grounded conductors</span>
        <span class="n">tags</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="mi">12</span><span class="p">]</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
            <span class="c1">#initialize a Conductor</span>
            <span class="n">cond</span> <span class="o">=</span> <span class="n">fields_class</span><span class="o">.</span><span class="n">Conductor</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">iat</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="mi">11</span><span class="p">])</span>
            <span class="c1">#check for conductors with identical tags (names/labels)</span>
            <span class="k">if</span><span class="p">(</span><span class="n">cond</span><span class="o">.</span><span class="n">tag</span> <span class="ow">in</span> <span class="n">tags</span><span class="p">):</span>
                <span class="k">raise</span><span class="p">(</span><span class="n">fields_class</span><span class="o">.</span><span class="n">EMFError</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;Conductors in a Cross Section must</span>
<span class="s2">                have unique tags. The conductor tag &quot;</span><span class="si">%s</span><span class="s2">&quot; in sheet: &quot;</span><span class="si">%s</span><span class="s2">&quot; is used</span>
<span class="s2">                at least twice.&quot;&quot;&quot;</span>
                <span class="o">%</span> <span class="p">(</span><span class="n">cond</span><span class="o">.</span><span class="n">tag</span><span class="p">,</span> <span class="n">k</span><span class="p">)))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">tags</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cond</span><span class="o">.</span><span class="n">tag</span><span class="p">)</span>
            <span class="c1">#cond.freq = misc[2]</span>
            <span class="n">cond</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">iat</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="mi">12</span><span class="p">]</span>
            <span class="n">cond</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">iat</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="mi">13</span><span class="p">]</span>
            <span class="c1">#check for conductors with identical x,y coordinates</span>
            <span class="k">if</span><span class="p">(</span><span class="n">cond</span><span class="o">.</span><span class="n">x</span> <span class="ow">in</span> <span class="n">x</span><span class="p">):</span>
                <span class="n">idx</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">cond</span><span class="o">.</span><span class="n">x</span><span class="p">)</span>
                <span class="k">if</span><span class="p">(</span><span class="n">cond</span><span class="o">.</span><span class="n">y</span> <span class="o">==</span> <span class="n">y</span><span class="p">[</span><span class="n">idx</span><span class="p">]):</span>
                    <span class="k">raise</span><span class="p">(</span><span class="n">fields_class</span><span class="o">.</span><span class="n">EMFError</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;Conductors cannot have</span>
<span class="s2">                    identical x,y coordinates. Conductor &quot;</span><span class="si">%s</span><span class="s2">&quot; is in the exact</span>
<span class="s2">                    same place as conductor &quot;</span><span class="si">%s</span><span class="s2">&quot;.&quot;&quot;&quot;</span>
                <span class="o">%</span> <span class="p">(</span><span class="n">cond</span><span class="o">.</span><span class="n">tag</span><span class="p">,</span> <span class="n">tags</span><span class="p">[</span><span class="n">idx</span><span class="p">])))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">x</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cond</span><span class="o">.</span><span class="n">x</span><span class="p">)</span>
                <span class="n">y</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cond</span><span class="o">.</span><span class="n">y</span><span class="p">)</span>
            <span class="n">cond</span><span class="o">.</span><span class="n">subconds</span> <span class="o">=</span> <span class="mf">1.</span>
            <span class="n">cond</span><span class="o">.</span><span class="n">d_cond</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">iat</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="mi">14</span><span class="p">]</span>
            <span class="n">cond</span><span class="o">.</span><span class="n">d_bund</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">iat</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="mi">14</span><span class="p">]</span>
            <span class="n">cond</span><span class="o">.</span><span class="n">V</span> <span class="o">=</span> <span class="mf">0.</span>
            <span class="n">cond</span><span class="o">.</span><span class="n">I</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">iat</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="mi">15</span><span class="p">]</span>
            <span class="n">cond</span><span class="o">.</span><span class="n">phase</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">iat</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="mi">16</span><span class="p">]</span>
            <span class="n">xs</span><span class="o">.</span><span class="n">add_conductor</span><span class="p">(</span><span class="n">cond</span><span class="p">)</span>
        <span class="c1">#add the CrossSection object to the SectionBook</span>
        <span class="c1">#fields automatically updated upon addition to SectionBook</span>
        <span class="n">sb</span><span class="o">.</span><span class="n">add_section</span><span class="p">(</span><span class="n">xs</span><span class="p">)</span>
    <span class="c1">#return the SectionBook object</span>
    <span class="k">return</span><span class="p">(</span><span class="n">sb</span><span class="p">)</span>
</pre></div>

                    </div>
                </div></div><div class="function" id="optimize_phasing"><p class="function-str"><span class="function-name">optimize_phasing</span>(<span class="function-arg">xs</span>, <span class="function-arg">circuits</span>, **<span class="function-arg">kw</span>)</p><p class="docstr">Permute the phasing of non-grounded conductors and find the arrangement that results in the lowest fields at the left and right edge of the ROW. The number of hot conductors must be a multiple of three. The phases of consecutive groups of three conductors are swapped around, assuming that those groups represent a single three-phase transfer circuit.<br>&ensp;&ensp;&ensp;&ensp;args:<br>&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;xs - target CrossSection object<br>&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;circuits - list of lists of Conductor tags, or 'all'. If a list of<br>&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;lists, each sublist contains the Conductor tags of the<br>&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;Conductors comprising a single circuit. If 'all',<br>&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;circuits are assumed to be consecutive groups of three<br>&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;conductors. (consecutive according to the order in which<br>&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;hot conductors were added to the CrossSection)<br>&ensp;&ensp;&ensp;&ensp;kw:<br>&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;save - bool, toggle saving of the results DataFrame to an excel book<br>&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;path - string, location/filename for saved results workbook,<br>&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;forces saving even if no 'save' keyword is used.<br>&ensp;&ensp;&ensp;&ensp;returns:<br>&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;res - pandas DataFrame listing conductor phasings that optimize<br>&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;electric and magnetic fields at both ROW edges.<br>&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;opt - new SectionBook object containing the permuted phasings that<br>&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;optimize the E and B fields at the left and right ROW edges.</p>
                <div class="source">
                    <h4 onclick="toggleSource(this)">show source</h4>
                    <div class="code">
                        <div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">optimize_phasing</span><span class="p">(</span><span class="n">xs</span><span class="p">,</span> <span class="n">circuits</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Permute the phasing of non-grounded conductors and find the arrangement</span>
<span class="sd">    that results in the lowest fields at the left and right edge of the ROW. The</span>
<span class="sd">    number of hot conductors must be a multiple of three. The phases of</span>
<span class="sd">    consecutive groups of three conductors are swapped around, assuming that</span>
<span class="sd">    those groups represent a single three-phase transfer circuit.</span>
<span class="sd">    args:</span>
<span class="sd">        xs - target CrossSection object</span>
<span class="sd">        circuits - list of lists of Conductor tags, or &#39;all&#39;. If a list of</span>
<span class="sd">                    lists, each sublist contains the Conductor tags of the</span>
<span class="sd">                    Conductors comprising a single circuit. If &#39;all&#39;,</span>
<span class="sd">                    circuits are assumed to be consecutive groups of three</span>
<span class="sd">                    conductors. (consecutive according to the order in which</span>
<span class="sd">                    hot conductors were added to the CrossSection)</span>
<span class="sd">    kw:</span>
<span class="sd">        save - bool, toggle saving of the results DataFrame to an excel book</span>
<span class="sd">        path - string, location/filename for saved results workbook,</span>
<span class="sd">                forces saving even if no &#39;save&#39; keyword is used.</span>
<span class="sd">    returns:</span>
<span class="sd">        res - pandas DataFrame listing conductor phasings that optimize</span>
<span class="sd">                electric and magnetic fields at both ROW edges.</span>
<span class="sd">        opt - new SectionBook object containing the permuted phasings that</span>
<span class="sd">                optimize the E and B fields at the left and right ROW edges.&quot;&quot;&quot;</span>

    <span class="k">if</span><span class="p">(</span><span class="n">circuits</span> <span class="o">==</span> <span class="s1">&#39;all&#39;</span><span class="p">):</span>
        <span class="c1">#number of hot wires</span>
        <span class="n">hot</span> <span class="o">=</span> <span class="n">xs</span><span class="o">.</span><span class="n">hot</span>
        <span class="n">N</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">xs</span><span class="o">.</span><span class="n">hot</span><span class="p">)</span>
        <span class="c1">#check the number of hot lines</span>
        <span class="k">if</span><span class="p">(</span><span class="n">N</span> <span class="o">%</span> <span class="mi">3</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">):</span>
            <span class="k">raise</span><span class="p">(</span><span class="n">fields_class</span><span class="o">.</span><span class="n">EMFError</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;The number of hot (not grounded)</span>
<span class="s2">            conductors must be a multiple of three for phase optimization with</span>
<span class="s2">            &#39;all&#39; circuits. Circuits are assumed to be three-phase and conductors</span>
<span class="s2">            comprising each circuit are assumed to be consecutive groups of</span>
<span class="s2">            three, in the order that they appear in the template. The number of</span>
<span class="s2">            hot conductors is not a multiple of three in the CrossSection named:</span>
<span class="s2">            </span><span class="si">%s</span><span class="s2">&quot;&quot;&quot;</span> <span class="o">%</span> <span class="n">xs</span><span class="o">.</span><span class="n">sheet</span><span class="p">))</span>
        <span class="c1">#number of circuits, groups of 3 hot conductors</span>
        <span class="n">G</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">N</span><span class="o">/</span><span class="mi">3</span><span class="p">)</span>
        <span class="c1">#circuits, consecutive groups of three conductors</span>
        <span class="n">circuits</span> <span class="o">=</span> <span class="p">[[]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">G</span><span class="p">)]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">G</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
                <span class="n">circuits</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">hot</span><span class="p">[</span><span class="n">i</span><span class="o">*</span><span class="mi">3</span> <span class="o">+</span> <span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">tag</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1">#check that all conductor tags are present and refer to hot conds</span>
        <span class="n">gnd</span> <span class="o">=</span> <span class="n">xs</span><span class="o">.</span><span class="n">gnd</span>
        <span class="k">for</span> <span class="n">circ</span> <span class="ow">in</span> <span class="n">circuits</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">tag</span> <span class="ow">in</span> <span class="n">circ</span><span class="p">:</span>
                <span class="k">if</span><span class="p">(</span><span class="n">xs</span><span class="p">[</span><span class="n">tag</span><span class="p">]</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">):</span>
                    <span class="k">raise</span><span class="p">(</span><span class="n">fields_class</span><span class="o">.</span><span class="n">EMFError</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;Unrecognized conductor tag: </span><span class="si">%s</span><span class="s2"></span>
<span class="s2">                    All conductor tags must refer to Conductor objects in the</span>
<span class="s2">                    target CrossSecton object.&quot;&quot;&quot;</span> <span class="o">%</span> <span class="nb">repr</span><span class="p">(</span><span class="n">tag</span><span class="p">)))</span>
                <span class="k">if</span><span class="p">(</span><span class="n">xs</span><span class="p">[</span><span class="n">tag</span><span class="p">]</span> <span class="ow">in</span> <span class="n">gnd</span><span class="p">):</span>
                    <span class="k">raise</span><span class="p">(</span><span class="n">fields_class</span><span class="o">.</span><span class="n">EMFError</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;Only phasing of non-grounded</span>
<span class="s2">                    Conductors can be permuted. Tag &quot;</span><span class="si">%s</span><span class="s2">&quot; refers to a grounded</span>
<span class="s2">                    Conductor&quot;&quot;&quot;</span> <span class="o">%</span> <span class="nb">repr</span><span class="p">(</span><span class="n">tag</span><span class="p">)))</span>
    <span class="c1">#convert the conductor tags to integer indices in xs.conds</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">circuits</span><span class="p">)):</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">circuits</span><span class="p">[</span><span class="n">i</span><span class="p">])):</span>
            <span class="n">circuits</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">xs</span><span class="o">.</span><span class="n">_tag2idx</span><span class="p">[</span><span class="n">circuits</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]]</span>
    <span class="c1">#all permutations of the phases of each circuit</span>
    <span class="n">perm</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">circuits</span><span class="p">:</span>
        <span class="n">perm</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">itertools</span><span class="o">.</span><span class="n">permutations</span><span class="p">(</span><span class="n">c</span><span class="p">)))</span>
    <span class="c1">#all possible arrangements of line phasings, 6 permutations for each circuit</span>
    <span class="c1">#so 6^(N/3) total line arrangements. Leave P as a generator to avoid storing</span>
    <span class="c1">#a huge, factorial sized array of indices</span>
    <span class="n">P</span> <span class="o">=</span> <span class="n">itertools</span><span class="o">.</span><span class="n">product</span><span class="p">(</span><span class="o">*</span><span class="n">perm</span><span class="p">)</span>
    <span class="c1">#variables to find the minima with respect to each field and ROW edge</span>
    <span class="n">B_left_min</span><span class="p">,</span> <span class="n">B_left_arr</span><span class="p">,</span> <span class="n">B_right_min</span><span class="p">,</span> <span class="n">B_right_arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="p">[],</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="p">[]</span>
    <span class="n">E_left_min</span><span class="p">,</span> <span class="n">E_left_arr</span><span class="p">,</span> <span class="n">E_right_min</span><span class="p">,</span> <span class="n">E_right_arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="p">[],</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="p">[]</span>
    <span class="c1">#get coordinates of the ROW edges</span>
    <span class="n">x_ROW</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">xs</span><span class="o">.</span><span class="n">lROW</span><span class="p">,</span> <span class="n">xs</span><span class="o">.</span><span class="n">rROW</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
    <span class="n">y_ROW</span> <span class="o">=</span> <span class="n">xs</span><span class="o">.</span><span class="n">sample_height</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="mi">2</span><span class="p">,),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
    <span class="c1">#pull conductor data</span>
    <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">I</span><span class="p">,</span> <span class="n">V</span><span class="p">,</span> <span class="n">phase</span> <span class="o">=</span> <span class="n">xs</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">xs</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="n">xs</span><span class="o">.</span><span class="n">I</span><span class="p">,</span> <span class="n">xs</span><span class="o">.</span><span class="n">V</span><span class="p">,</span> <span class="n">xs</span><span class="o">.</span><span class="n">phase</span>
    <span class="n">subconds</span><span class="p">,</span> <span class="n">d_cond</span><span class="p">,</span> <span class="n">d_bund</span> <span class="o">=</span> <span class="n">xs</span><span class="o">.</span><span class="n">subconds</span><span class="p">,</span> <span class="n">xs</span><span class="o">.</span><span class="n">d_cond</span><span class="p">,</span> <span class="n">xs</span><span class="o">.</span><span class="n">d_bund</span>
    <span class="c1">#phasing array to swap the elements around in</span>
    <span class="n">phase_swap</span> <span class="o">=</span> <span class="n">phase</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="c1">#store a flattened version of the conductor indices for swapping</span>
    <span class="n">conds</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">i</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">circuits</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">j</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>
    <span class="c1">#loop through all possible arrangements in P</span>
    <span class="k">for</span> <span class="n">arr</span> <span class="ow">in</span> <span class="n">P</span><span class="p">:</span>
        <span class="c1">#flatten the new arrangement</span>
        <span class="n">new_arr</span> <span class="o">=</span> <span class="n">_flatten</span><span class="p">(</span><span class="n">arr</span><span class="p">)</span>
        <span class="c1">#swap phases according to the new phasing arrangement</span>
        <span class="n">phase_swap</span><span class="p">[</span><span class="n">conds</span><span class="p">]</span> <span class="o">=</span> <span class="n">phase</span><span class="p">[</span><span class="n">new_arr</span><span class="p">]</span>
        <span class="c1">#calculate fields with index swapped phases</span>
        <span class="n">Ex</span><span class="p">,</span> <span class="n">Ey</span> <span class="o">=</span> <span class="n">fields_calcs</span><span class="o">.</span><span class="n">E_field</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">subconds</span><span class="p">,</span> <span class="n">d_cond</span><span class="p">,</span> <span class="n">d_bund</span><span class="p">,</span> <span class="n">V</span><span class="p">,</span>
                <span class="n">phase_swap</span><span class="p">,</span> <span class="n">x_ROW</span><span class="p">,</span> <span class="n">y_ROW</span><span class="p">)</span>
        <span class="n">Ex</span><span class="p">,</span> <span class="n">Ey</span><span class="p">,</span> <span class="n">Eprod</span><span class="p">,</span> <span class="n">Emax</span> <span class="o">=</span> <span class="n">fields_calcs</span><span class="o">.</span><span class="n">phasors_to_magnitudes</span><span class="p">(</span><span class="n">Ex</span><span class="p">,</span> <span class="n">Ey</span><span class="p">)</span>
        <span class="n">Bx</span><span class="p">,</span> <span class="n">By</span> <span class="o">=</span> <span class="n">fields_calcs</span><span class="o">.</span><span class="n">B_field</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">I</span><span class="p">,</span> <span class="n">phase_swap</span><span class="p">,</span> <span class="n">x_ROW</span><span class="p">,</span> <span class="n">y_ROW</span><span class="p">)</span>
        <span class="n">Bx</span><span class="p">,</span> <span class="n">By</span><span class="p">,</span> <span class="n">Bprod</span><span class="p">,</span> <span class="n">Bmax</span> <span class="o">=</span> <span class="n">fields_calcs</span><span class="o">.</span><span class="n">phasors_to_magnitudes</span><span class="p">(</span><span class="n">Bx</span><span class="p">,</span> <span class="n">By</span><span class="p">)</span>
        <span class="c1">#test for minima</span>
        <span class="k">if</span><span class="p">(</span><span class="n">Bmax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">B_left_min</span><span class="p">):</span>
            <span class="n">B_left_min</span><span class="p">,</span> <span class="n">B_left_arr</span> <span class="o">=</span> <span class="n">Bmax</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">new_arr</span>
        <span class="k">if</span><span class="p">(</span><span class="n">Bmax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">B_right_min</span><span class="p">):</span>
            <span class="n">B_right_min</span><span class="p">,</span> <span class="n">B_right_arr</span> <span class="o">=</span> <span class="n">Bmax</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">new_arr</span>
        <span class="k">if</span><span class="p">(</span><span class="n">Emax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">E_left_min</span><span class="p">):</span>
            <span class="n">E_left_min</span><span class="p">,</span> <span class="n">E_left_arr</span> <span class="o">=</span> <span class="n">Emax</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">new_arr</span>
        <span class="k">if</span><span class="p">(</span><span class="n">Emax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">E_right_min</span><span class="p">):</span>
            <span class="n">E_right_min</span><span class="p">,</span> <span class="n">E_right_arr</span> <span class="o">=</span> <span class="n">Emax</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">new_arr</span>
    <span class="c1">#return results in a DataFrame</span>
    <span class="n">results</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="p">{</span>
        <span class="s1">&#39;Optimal Phasing - Bmax Left ROW Edge&#39;</span><span class="p">:</span> <span class="n">phase</span><span class="p">[</span><span class="n">B_left_arr</span><span class="p">],</span>
        <span class="s1">&#39;Optimal Phasing - Bmax Right ROW Edge&#39;</span><span class="p">:</span> <span class="n">phase</span><span class="p">[</span><span class="n">B_right_arr</span><span class="p">],</span>
        <span class="s1">&#39;Optimal Phasing - Emax Left ROW Edge&#39;</span><span class="p">:</span> <span class="n">phase</span><span class="p">[</span><span class="n">E_left_arr</span><span class="p">],</span>
        <span class="s1">&#39;Optimal Phasing - Emax Right ROW Edge&#39;</span><span class="p">:</span> <span class="n">phase</span><span class="p">[</span><span class="n">E_right_arr</span><span class="p">]},</span>
        <span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="n">xs</span><span class="o">.</span><span class="n">conds</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">tag</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">conds</span><span class="p">])</span>
    <span class="c1">#compile a new sectionbook with the optimal phasings</span>
    <span class="n">fn</span> <span class="o">=</span> <span class="n">_path_str_condition</span><span class="p">(</span><span class="n">xs</span><span class="o">.</span><span class="n">sheet</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="s1">&#39;-&#39;</span><span class="p">)</span>
    <span class="n">xs</span> <span class="o">=</span> <span class="n">xs</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="n">opt</span> <span class="o">=</span> <span class="n">fields_class</span><span class="o">.</span><span class="n">SectionBook</span><span class="p">(</span><span class="n">xs</span><span class="o">.</span><span class="n">sheet</span> <span class="o">+</span> <span class="s1">&#39;-optimal_phasing&#39;</span><span class="p">)</span>
    <span class="n">xs</span><span class="o">.</span><span class="n">sheet</span> <span class="o">+=</span> <span class="s1">&#39; (original)&#39;</span>
    <span class="n">xs</span><span class="o">.</span><span class="n">tag</span> <span class="o">=</span> <span class="s1">&#39;Phase Optimized&#39;</span>
    <span class="n">opt</span><span class="o">.</span><span class="n">add_section</span><span class="p">(</span><span class="n">xs</span><span class="p">)</span>
    <span class="n">names</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Optimized for Bmax left&#39;</span><span class="p">,</span><span class="s1">&#39;Optimized for Bmax right&#39;</span><span class="p">,</span>
            <span class="s1">&#39;Optimized for Emax left&#39;</span><span class="p">,</span><span class="s1">&#39;Optimized for Emax right&#39;</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">n</span><span class="p">,</span> <span class="n">ti</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">names</span><span class="p">,</span> <span class="n">results</span><span class="o">.</span><span class="n">columns</span><span class="p">):</span>
        <span class="c1">#copy the input xs</span>
        <span class="n">new_xs</span> <span class="o">=</span> <span class="n">xs</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="c1">#change the identification fields</span>
        <span class="n">new_xs</span><span class="o">.</span><span class="n">sheet</span><span class="p">,</span> <span class="n">new_xs</span><span class="o">.</span><span class="n">title</span><span class="p">,</span> <span class="n">new_xs</span><span class="o">.</span><span class="n">tag</span> <span class="o">=</span> <span class="n">n</span><span class="p">,</span> <span class="n">ti</span><span class="p">,</span> <span class="s1">&#39;Phase Optimized&#39;</span>
        <span class="c1">#swap the conductor phasings</span>
        <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">new_xs</span><span class="o">.</span><span class="n">hot</span><span class="p">:</span>
            <span class="n">t</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">tag</span>
            <span class="k">if</span><span class="p">(</span><span class="n">t</span> <span class="ow">in</span> <span class="n">results</span><span class="o">.</span><span class="n">index</span><span class="p">):</span>
                <span class="n">c</span><span class="o">.</span><span class="n">phase</span> <span class="o">=</span> <span class="n">results</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">t</span><span class="p">,</span> <span class="n">ti</span><span class="p">]</span>
        <span class="c1">#store new_xs in the SectionBook</span>
        <span class="n">opt</span><span class="o">.</span><span class="n">add_section</span><span class="p">(</span><span class="n">new_xs</span><span class="p">)</span>
    <span class="c1">#deal with saving</span>
    <span class="k">if</span><span class="p">(</span><span class="s1">&#39;path&#39;</span> <span class="ow">in</span> <span class="n">kw</span><span class="p">):</span>
        <span class="n">kw</span><span class="p">[</span><span class="s1">&#39;save&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">True</span>
    <span class="k">if</span><span class="p">(</span><span class="s1">&#39;save&#39;</span> <span class="ow">in</span> <span class="n">kw</span><span class="p">):</span>
        <span class="k">if</span><span class="p">(</span><span class="n">kw</span><span class="p">[</span><span class="s1">&#39;save&#39;</span><span class="p">]):</span>
            <span class="n">fn</span> <span class="o">=</span> <span class="n">_path_manage</span><span class="p">(</span><span class="n">fn</span> <span class="o">+</span> <span class="s1">&#39;_phase_optimization&#39;</span><span class="p">,</span> <span class="s1">&#39;xlsx&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">)</span>
            <span class="n">xl</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">ExcelWriter</span><span class="p">(</span><span class="n">fn</span><span class="p">,</span> <span class="n">engine</span><span class="o">=</span><span class="s1">&#39;xlsxwriter&#39;</span><span class="p">)</span>
            <span class="n">results</span><span class="o">.</span><span class="n">to_excel</span><span class="p">(</span><span class="n">xl</span><span class="p">,</span> <span class="n">index_label</span><span class="o">=</span><span class="s1">&#39;Conductor Tag&#39;</span><span class="p">,</span>
                <span class="n">sheet_name</span><span class="o">=</span><span class="s1">&#39;phase_assignments&#39;</span><span class="p">)</span>
            <span class="n">opt</span><span class="o">.</span><span class="n">ROW_edge_export</span><span class="p">(</span><span class="n">xl</span><span class="o">=</span><span class="n">xl</span><span class="p">)</span>
            <span class="n">df</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">h</span> <span class="o">=</span> <span class="n">_xs_sb_diff</span><span class="p">(</span><span class="n">xs</span><span class="p">,</span> <span class="n">opt</span><span class="p">)</span>
            <span class="n">df</span><span class="o">.</span><span class="n">to_excel</span><span class="p">(</span><span class="n">xl</span><span class="p">,</span> <span class="n">sheet_name</span><span class="o">=</span><span class="s1">&#39;ROW_edge_diff&#39;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
                    <span class="n">columns</span><span class="o">=</span><span class="n">c</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="n">h</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">xs</span> <span class="ow">in</span> <span class="n">opt</span><span class="p">:</span>
                <span class="n">xs</span><span class="o">.</span><span class="n">fields</span><span class="o">.</span><span class="n">to_excel</span><span class="p">(</span><span class="n">xl</span><span class="p">,</span> <span class="n">sheet_name</span><span class="o">=</span><span class="n">xs</span><span class="o">.</span><span class="n">sheet</span><span class="p">)</span>
            <span class="n">xl</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
            <span class="k">print</span><span class="p">(</span><span class="s1">&#39;Phase optimization results written to: </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">fn</span><span class="p">)</span>

    <span class="k">return</span><span class="p">(</span><span class="n">results</span><span class="p">,</span> <span class="n">opt</span><span class="p">)</span>
</pre></div>

                    </div>
                </div></div><div class="function" id="phasors_to_magnitudes"><p class="function-str"><span class="function-name">phasors_to_magnitudes</span>(<span class="function-arg">Ph_x</span>, <span class="function-arg">Ph_y</span>)</p><p class="docstr">Convert vectors of complex x and y phasors into real quantities, namely the amplitude of the field in the x and y directions, the product (the hypotenuse of the amplitudes), and the maxiMUm field. Results of E_field and B_field can be passed directly to this function for conversion from phasor form into usable form.<br>&ensp;&ensp;&ensp;&ensp;args:<br>&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;Ph_x - complex 1D numpy array, phasor horizontal components<br>&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;Ph_y - complex 1D numpy array, phasor vertical components<br>&ensp;&ensp;&ensp;&ensp;returns:<br>&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;mag_x - 1D numpy array, maxiMUm horizontal field<br>&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;mag_y - 1D numpy array, maxiMUm vertical field<br>&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;prod - 1D numpy array, sqrt(mag_x**2 + mag_y**2)<br>&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;maxiMUm - 1D numpy array, maxiMUm field at any time</p>
                <div class="source">
                    <h4 onclick="toggleSource(this)">show source</h4>
                    <div class="code">
                        <div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">phasors_to_magnitudes</span><span class="p">(</span><span class="n">Ph_x</span><span class="p">,</span> <span class="n">Ph_y</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Convert vectors of complex x and y phasors into real quantities, namely</span>
<span class="sd">    the amplitude of the field in the x and y directions, the product (the</span>
<span class="sd">    hypotenuse of the amplitudes), and the maxiMUm field. Results of E_field and</span>
<span class="sd">    B_field can be passed directly to this function for conversion from phasor</span>
<span class="sd">    form into usable form.</span>
<span class="sd">    args:</span>
<span class="sd">        Ph_x - complex 1D numpy array, phasor horizontal components</span>
<span class="sd">        Ph_y - complex 1D numpy array, phasor vertical components</span>
<span class="sd">    returns:</span>
<span class="sd">        mag_x - 1D numpy array, maxiMUm horizontal field</span>
<span class="sd">        mag_y - 1D numpy array, maxiMUm vertical field</span>
<span class="sd">        prod - 1D numpy array, sqrt(mag_x**2 + mag_y**2)</span>
<span class="sd">        maxiMUm - 1D numpy array, maxiMUm field at any time&quot;&quot;&quot;</span>
    <span class="c1">#amplitude along each component, storing squared magnitudes for later</span>
    <span class="n">mag_x_sq</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">Ph_x</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">imag</span><span class="p">(</span><span class="n">Ph_x</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span>
    <span class="n">mag_x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">mag_x_sq</span><span class="p">)</span>
    <span class="n">mag_y_sq</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">Ph_y</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">imag</span><span class="p">(</span><span class="n">Ph_y</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span>
    <span class="n">mag_y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">mag_y_sq</span><span class="p">)</span>
    <span class="c1">#phase angle of each component</span>
    <span class="n">phase_x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arctan2</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">imag</span><span class="p">(</span><span class="n">Ph_x</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">Ph_x</span><span class="p">))</span>
    <span class="n">phase_y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arctan2</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">imag</span><span class="p">(</span><span class="n">Ph_y</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">Ph_y</span><span class="p">))</span>
    <span class="c1">#&quot;product&quot;</span>
    <span class="n">prod</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">mag_x</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">mag_y</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
    <span class="c1">#maxiMUm resultant value found by setting the time derivative of the</span>
    <span class="c1">#squared resultant magnitude to zero (Appendix 8.1 EPRI&#39;s &quot;Big Red Book&quot;)</span>
    <span class="n">num</span> <span class="o">=</span> <span class="n">mag_x_sq</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">phase_x</span><span class="p">)</span> <span class="o">+</span> <span class="n">mag_y_sq</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">phase_y</span><span class="p">)</span>
    <span class="n">den</span> <span class="o">=</span> <span class="n">mag_x_sq</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">phase_x</span><span class="p">)</span> <span class="o">+</span> <span class="n">mag_y_sq</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">phase_y</span><span class="p">)</span>
    <span class="n">t1</span> <span class="o">=</span> <span class="p">(</span><span class="mf">0.5</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">arctan2</span><span class="p">(</span><span class="o">-</span><span class="n">num</span><span class="p">,</span> <span class="n">den</span><span class="p">)</span>
    <span class="n">t2</span> <span class="o">=</span> <span class="n">t1</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">2</span>
    <span class="n">term1</span> <span class="o">=</span> <span class="n">mag_x_sq</span><span class="o">*</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">t1</span> <span class="o">+</span> <span class="n">phase_x</span><span class="p">))</span><span class="o">**</span><span class="mi">2</span>
    <span class="n">term2</span> <span class="o">=</span> <span class="n">mag_y_sq</span><span class="o">*</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">t1</span> <span class="o">+</span> <span class="n">phase_y</span><span class="p">))</span><span class="o">**</span><span class="mi">2</span>
    <span class="n">ax_mag1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">term1</span> <span class="o">+</span> <span class="n">term2</span><span class="p">)</span>
    <span class="n">term1</span> <span class="o">=</span> <span class="n">mag_x_sq</span><span class="o">*</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">t2</span> <span class="o">+</span> <span class="n">phase_x</span><span class="p">))</span><span class="o">**</span><span class="mi">2</span>
    <span class="n">term2</span> <span class="o">=</span> <span class="n">mag_y_sq</span><span class="o">*</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">t2</span> <span class="o">+</span> <span class="n">phase_y</span><span class="p">))</span><span class="o">**</span><span class="mi">2</span>
    <span class="n">ax_mag2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">term1</span> <span class="o">+</span> <span class="n">term2</span><span class="p">)</span>
    <span class="c1">#pick out the semi-major axis magnitude from the two semi-axis results</span>
    <span class="n">maxiMUm</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">maxiMUm</span><span class="p">(</span><span class="n">ax_mag1</span><span class="p">,</span> <span class="n">ax_mag2</span><span class="p">)</span>
    <span class="c1">#return the 4 output columns</span>
    <span class="k">return</span><span class="p">(</span><span class="n">mag_x</span><span class="p">,</span> <span class="n">mag_y</span><span class="p">,</span> <span class="n">prod</span><span class="p">,</span> <span class="n">maxiMUm</span><span class="p">)</span>
</pre></div>

                    </div>
                </div></div><div class="function" id="plot_Bmax"><p class="function-str"><span class="function-name">plot_Bmax</span>(<span class="function-arg">xs</span>, **<span class="function-arg">kw</span>)</p><p class="docstr">Plot the maximum magnetic field along the ROW with conductor locations shown in artificial coordinates.<br>&ensp;&ensp;&ensp;&ensp;args:<br>&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;xs - a CrossSection object<br>&ensp;&ensp;&ensp;&ensp;kw:<br>&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;ax - target Axes<br>&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;fig - Figure object, target figure for plotting, overridden by 'ax'<br>&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;save - bool, toggle plot saving<br>&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;path - string, destination/filename for saved figure<br>&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;format - string, saved plot format/extension (default 'png')<br>&ensp;&ensp;&ensp;&ensp;returns:<br>&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;fig - Figure object<br>&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;ax - Axes object</p>
                <div class="source">
                    <h4 onclick="toggleSource(this)">show source</h4>
                    <div class="code">
                        <div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">plot_Bmax</span><span class="p">(</span><span class="n">xs</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Plot the maximum magnetic field along the ROW with conductor locations</span>
<span class="sd">    shown in artificial coordinates.</span>
<span class="sd">    args:</span>
<span class="sd">        xs - a CrossSection object</span>
<span class="sd">    kw:</span>
<span class="sd">        ax - target Axes</span>
<span class="sd">        fig - Figure object, target figure for plotting, overridden by &#39;ax&#39;</span>
<span class="sd">        save - bool, toggle plot saving</span>
<span class="sd">        path - string, destination/filename for saved figure</span>
<span class="sd">        format - string, saved plot format/extension (default &#39;png&#39;)</span>
<span class="sd">    returns:</span>
<span class="sd">        fig - Figure object</span>
<span class="sd">        ax - Axes object&quot;&quot;&quot;</span>

    <span class="c1">#get plotting objects</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">_prepare_fig</span><span class="p">(</span><span class="o">**</span><span class="n">kw</span><span class="p">)</span>
    <span class="c1">#get plotting specs</span>
    <span class="n">xmax</span> <span class="o">=</span> <span class="n">_find_xmax</span><span class="p">(</span><span class="n">xs</span><span class="p">)</span>
    <span class="c1">#init handles and labels lists for legend</span>
    <span class="n">kw</span><span class="p">[</span><span class="s1">&#39;H&#39;</span><span class="p">],</span> <span class="n">kw</span><span class="p">[</span><span class="s1">&#39;L&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[]</span>
    <span class="c1">#plot the field curve</span>
    <span class="n">kw</span><span class="p">[</span><span class="s1">&#39;H&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xs</span><span class="o">.</span><span class="n">fields</span><span class="p">[</span><span class="s1">&#39;Bmax&#39;</span><span class="p">][</span><span class="o">-</span><span class="n">xmax</span><span class="p">:</span><span class="n">xmax</span><span class="p">],</span>
                <span class="n">color</span><span class="o">=</span><span class="n">_B_color</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="n">_fields_linewidth</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">kw</span><span class="p">[</span><span class="s1">&#39;L&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">r&#39;Magnetic Field $(mG)$&#39;</span><span class="p">)</span>
    <span class="c1">#plot wires</span>
    <span class="n">_plot_wires</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">xs</span><span class="o">.</span><span class="n">hot</span><span class="p">,</span> <span class="n">xs</span><span class="o">.</span><span class="n">gnd</span><span class="p">,</span> <span class="n">xs</span><span class="o">.</span><span class="n">fields</span><span class="p">[</span><span class="s1">&#39;Bmax&#39;</span><span class="p">],</span> <span class="o">**</span><span class="n">kw</span><span class="p">)</span>
    <span class="n">_check_und_conds</span><span class="p">([</span><span class="n">xs</span><span class="p">],</span> <span class="p">[</span><span class="n">ax</span><span class="p">],</span> <span class="o">**</span><span class="n">kw</span><span class="p">)</span>
    <span class="c1">#adjust axis limits if headspace is called for</span>
    <span class="k">if</span><span class="p">(</span><span class="n">_include_headspace</span><span class="p">):</span>
        <span class="n">yl</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_ylim</span><span class="p">()</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">yl</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">_fields_plots_xs_headspace</span><span class="p">)</span><span class="o">*</span><span class="n">yl</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
    <span class="c1">#plot ROW lines</span>
    <span class="n">_plot_ROW_edges</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">xs</span><span class="o">.</span><span class="n">lROW</span><span class="p">,</span> <span class="n">xs</span><span class="o">.</span><span class="n">rROW</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">)</span>
    <span class="c1">#set axis text and legend</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">r&#39;Distance from Center of ROW $(ft)$&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">r&#39;Maximum Magnetic Field $(mG)$&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Maximum Magnetic Field - </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">xs</span><span class="o">.</span><span class="n">title</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">kw</span><span class="p">[</span><span class="s1">&#39;H&#39;</span><span class="p">],</span> <span class="n">kw</span><span class="p">[</span><span class="s1">&#39;L&#39;</span><span class="p">],</span> <span class="n">numpoints</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">_format_line_axes_legends</span><span class="p">(</span><span class="n">ax</span><span class="p">)</span>
    <span class="c1">#save the fig or don&#39;t, depending on keywords</span>
    <span class="n">_save_fig</span><span class="p">(</span><span class="n">xs</span><span class="o">.</span><span class="n">sheet</span><span class="p">,</span> <span class="n">fig</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">)</span>
    <span class="c1">#return</span>
    <span class="k">return</span><span class="p">(</span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span><span class="p">)</span>
</pre></div>

                    </div>
                </div></div><div class="function" id="plot_Emax"><p class="function-str"><span class="function-name">plot_Emax</span>(<span class="function-arg">xs</span>, **<span class="function-arg">kw</span>)</p><p class="docstr">Plot the maximum electric field along the ROW with conductor locations shown in artificial coordinates.<br>&ensp;&ensp;&ensp;&ensp;args:<br>&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;xs - a CrossSection object<br>&ensp;&ensp;&ensp;&ensp;kw:<br>&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;ax - target Axes<br>&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;fig - Figure object, target figure for plotting, overridden by 'ax'<br>&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;save - bool, toggle plot saving<br>&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;path - string, destination/filename for saved figure<br>&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;format - string, saved plot format/extension (default 'png')<br>&ensp;&ensp;&ensp;&ensp;returns:<br>&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;fig - Figure object</p>
                <div class="source">
                    <h4 onclick="toggleSource(this)">show source</h4>
                    <div class="code">
                        <div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">plot_Emax</span><span class="p">(</span><span class="n">xs</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Plot the maximum electric field along the ROW with conductor locations</span>
<span class="sd">    shown in artificial coordinates.</span>
<span class="sd">    args:</span>
<span class="sd">        xs - a CrossSection object</span>
<span class="sd">    kw:</span>
<span class="sd">        ax - target Axes</span>
<span class="sd">        fig - Figure object, target figure for plotting, overridden by &#39;ax&#39;</span>
<span class="sd">        save - bool, toggle plot saving</span>
<span class="sd">        path - string, destination/filename for saved figure</span>
<span class="sd">        format - string, saved plot format/extension (default &#39;png&#39;)</span>
<span class="sd">    returns:</span>
<span class="sd">        fig - Figure object&quot;&quot;&quot;</span>

    <span class="c1">#get plotting objects</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">_prepare_fig</span><span class="p">(</span><span class="o">**</span><span class="n">kw</span><span class="p">)</span>
    <span class="c1">#get plotting specs</span>
    <span class="n">xmax</span> <span class="o">=</span> <span class="n">_find_xmax</span><span class="p">(</span><span class="n">xs</span><span class="p">)</span>
    <span class="c1">#init handles and labels lists for legend</span>
    <span class="n">kw</span><span class="p">[</span><span class="s1">&#39;H&#39;</span><span class="p">],</span> <span class="n">kw</span><span class="p">[</span><span class="s1">&#39;L&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[]</span>
    <span class="c1">#plot the field curve</span>
    <span class="n">kw</span><span class="p">[</span><span class="s1">&#39;H&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xs</span><span class="o">.</span><span class="n">fields</span><span class="p">[</span><span class="s1">&#39;Emax&#39;</span><span class="p">][</span><span class="o">-</span><span class="n">xmax</span><span class="p">:</span><span class="n">xmax</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="n">_E_color</span><span class="p">,</span>
                <span class="n">linewidth</span><span class="o">=</span><span class="n">_fields_linewidth</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">kw</span><span class="p">[</span><span class="s1">&#39;L&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">r&#39;Electric Field $(kV/m)$&#39;</span><span class="p">)</span>
    <span class="c1">#plot wires</span>
    <span class="n">_plot_wires</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">xs</span><span class="o">.</span><span class="n">hot</span><span class="p">,</span> <span class="n">xs</span><span class="o">.</span><span class="n">gnd</span><span class="p">,</span> <span class="n">xs</span><span class="o">.</span><span class="n">fields</span><span class="p">[</span><span class="s1">&#39;Emax&#39;</span><span class="p">],</span> <span class="o">**</span><span class="n">kw</span><span class="p">)</span>
    <span class="n">_check_und_conds</span><span class="p">([</span><span class="n">xs</span><span class="p">],</span> <span class="p">[</span><span class="n">ax</span><span class="p">],</span> <span class="o">**</span><span class="n">kw</span><span class="p">)</span>
    <span class="c1">#adjust axis limits if headspace is called for</span>
    <span class="k">if</span><span class="p">(</span><span class="n">_include_headspace</span><span class="p">):</span>
        <span class="n">yl</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_ylim</span><span class="p">()</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">yl</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">_fields_plots_xs_headspace</span><span class="p">)</span><span class="o">*</span><span class="n">yl</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
    <span class="c1">#plot ROW lines</span>
    <span class="n">_plot_ROW_edges</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">xs</span><span class="o">.</span><span class="n">lROW</span><span class="p">,</span> <span class="n">xs</span><span class="o">.</span><span class="n">rROW</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">)</span>
    <span class="c1">#set axis text and legend</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">r&#39;Distance from Center of ROW $(ft)$&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">r&#39;Maximum Electric Field $(kV/m)$&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Maximum Electric Field - </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">xs</span><span class="o">.</span><span class="n">title</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">kw</span><span class="p">[</span><span class="s1">&#39;H&#39;</span><span class="p">],</span> <span class="n">kw</span><span class="p">[</span><span class="s1">&#39;L&#39;</span><span class="p">],</span> <span class="n">numpoints</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">_format_line_axes_legends</span><span class="p">(</span><span class="n">ax</span><span class="p">)</span>
    <span class="c1">#save the fig or don&#39;t, depending on keywords</span>
    <span class="n">_save_fig</span><span class="p">(</span><span class="n">xs</span><span class="o">.</span><span class="n">sheet</span><span class="p">,</span> <span class="n">fig</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">)</span>
    <span class="c1">#return</span>
    <span class="k">return</span><span class="p">(</span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span><span class="p">)</span>
</pre></div>

                    </div>
                </div></div><div class="function" id="plot_groups"><p class="function-str"><span class="function-name">plot_groups</span>(<span class="function-arg">sb</span>, **<span class="function-arg">kw</span>)</p><p class="docstr">Plot the fields of grouped CrossSections in the same axis, a plot for both fields. Only plots groups of more than one CrossSection.<br>&ensp;&ensp;&ensp;&ensp;args:<br>&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;sb - SectionBook object to pull plotting groups from<br>&ensp;&ensp;&ensp;&ensp;kw:<br>&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;save - bool, toggle plot saving<br>&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;path - string, destination/filename for saved figure<br>&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;format - string, saved plot format/extension (default 'png')<br>&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;xmax - cutoff distance from ROW center<br>&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;B - bool, toggle magnetic field plots, default is True<br>&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;E - bool, toggle electric field plots, default is True<br>&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;groups - a list of group names to plot, default is all groups<br>&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;return_figs - toggle whether a list of figure objects is returned<br>&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;instead of closing the figures to clear memory,<br>&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;default is False<br>&ensp;&ensp;&ensp;&ensp;returns:<br>&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;figs - dict of dicts, keys are 'E' and 'B', which are each keyed<br>&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;by group tags, leading to Figure objects</p>
                <div class="source">
                    <h4 onclick="toggleSource(this)">show source</h4>
                    <div class="code">
                        <div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">plot_groups</span><span class="p">(</span><span class="n">sb</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Plot the fields of grouped CrossSections in the same axis, a plot for both</span>
<span class="sd">    fields. Only plots groups of more than one CrossSection.</span>
<span class="sd">    args:</span>
<span class="sd">        sb - SectionBook object to pull plotting groups from</span>
<span class="sd">    kw:</span>
<span class="sd">        save - bool, toggle plot saving</span>
<span class="sd">        path - string, destination/filename for saved figure</span>
<span class="sd">        format - string, saved plot format/extension (default &#39;png&#39;)</span>
<span class="sd">        xmax - cutoff distance from ROW center</span>
<span class="sd">        B - bool, toggle magnetic field plots, default is True</span>
<span class="sd">        E - bool, toggle electric field plots, default is True</span>
<span class="sd">        groups - a list of group names to plot, default is all groups</span>
<span class="sd">        return_figs - toggle whether a list of figure objects is returned</span>
<span class="sd">                        instead of closing the figures to clear memory,</span>
<span class="sd">                        default is False</span>
<span class="sd">    returns:</span>
<span class="sd">        figs - dict of dicts, keys are &#39;E&#39; and &#39;B&#39;, which are each keyed</span>
<span class="sd">                by group tags, leading to Figure objects&quot;&quot;&quot;</span>

    <span class="c1">#check kws</span>
    <span class="n">return_figs</span> <span class="o">=</span> <span class="bp">False</span>
    <span class="k">if</span><span class="p">(</span><span class="s1">&#39;return_figs&#39;</span> <span class="ow">in</span> <span class="n">kw</span><span class="p">):</span>
        <span class="k">if</span><span class="p">(</span><span class="n">kw</span><span class="p">[</span><span class="s1">&#39;return_figs&#39;</span><span class="p">]):</span>
            <span class="n">return_figs</span> <span class="o">=</span> <span class="bp">True</span>
            <span class="n">figs</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;E&#39;</span><span class="p">:</span> <span class="p">{},</span> <span class="s1">&#39;B&#39;</span><span class="p">:</span> <span class="p">{}}</span>
    <span class="n">B_flag</span> <span class="o">=</span> <span class="bp">True</span>
    <span class="k">if</span><span class="p">(</span><span class="s1">&#39;B&#39;</span> <span class="ow">in</span> <span class="n">kw</span><span class="p">):</span>
        <span class="n">B_flag</span> <span class="o">=</span> <span class="n">kw</span><span class="p">[</span><span class="s1">&#39;B&#39;</span><span class="p">]</span>
    <span class="n">E_flag</span> <span class="o">=</span> <span class="bp">True</span>
    <span class="k">if</span><span class="p">(</span><span class="s1">&#39;E&#39;</span> <span class="ow">in</span> <span class="n">kw</span><span class="p">):</span>
        <span class="n">E_flag</span> <span class="o">=</span> <span class="n">kw</span><span class="p">[</span><span class="s1">&#39;E&#39;</span><span class="p">]</span>
    <span class="n">groups</span> <span class="o">=</span> <span class="n">sb</span><span class="o">.</span><span class="n">tags</span>
    <span class="k">if</span><span class="p">(</span><span class="s1">&#39;groups&#39;</span> <span class="ow">in</span> <span class="n">kw</span><span class="p">):</span>
        <span class="n">groups</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">kw</span><span class="p">[</span><span class="s1">&#39;groups&#39;</span><span class="p">])</span>

    <span class="c1">#iterate over groups with more than 1 CrossSection</span>
    <span class="k">for</span> <span class="n">xss</span> <span class="ow">in</span> <span class="n">sb</span><span class="o">.</span><span class="n">tag_groups</span><span class="p">:</span>

        <span class="k">if</span><span class="p">(</span><span class="n">xss</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">tag</span> <span class="ow">in</span> <span class="n">groups</span><span class="p">):</span>

            <span class="c1">#BMAX</span>
            <span class="k">if</span><span class="p">(</span><span class="n">B_flag</span><span class="p">):</span>
                <span class="c1">#get plotting objects</span>
                <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
                <span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
                <span class="c1">#init handles and labels lists for legend</span>
                <span class="n">kw</span><span class="p">[</span><span class="s1">&#39;H&#39;</span><span class="p">],</span> <span class="n">kw</span><span class="p">[</span><span class="s1">&#39;L&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[]</span>
                <span class="c1">#plot the Bmax results for each xs in the group</span>
                <span class="n">_plot_group_fields</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">xss</span><span class="p">,</span> <span class="s1">&#39;Bmax&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">)</span>
                <span class="c1">#plot wires</span>
                <span class="n">max_field</span> <span class="o">=</span> <span class="nb">max</span><span class="p">([</span><span class="n">xs</span><span class="o">.</span><span class="n">fields</span><span class="p">[</span><span class="s1">&#39;Bmax&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="k">for</span> <span class="n">xs</span> <span class="ow">in</span> <span class="n">xss</span><span class="p">])</span>
                <span class="n">_plot_group_wires</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">xss</span><span class="p">,</span> <span class="n">max_field</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">)</span>
                <span class="c1">#adjust axis limits if called for</span>
                <span class="k">if</span><span class="p">(</span><span class="n">_include_headspace</span><span class="p">):</span>
                    <span class="n">yl</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_ylim</span><span class="p">()</span>
                    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">yl</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">_fields_plots_xs_headspace</span><span class="p">)</span><span class="o">*</span><span class="n">yl</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                <span class="c1">#plot ROW lines</span>
                <span class="n">_plot_group_ROW_edges</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">xss</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">)</span>
                <span class="c1">#set axis text and legend</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">r&#39;Distance from Center of ROW $(ft)$&#39;</span><span class="p">)</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">r&#39;Maximum Magnetic Field $(mG)$&#39;</span><span class="p">)</span>
                <span class="n">t</span> <span class="o">=</span> <span class="s1">&#39;Maximum Magnetic Field - </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="nb">str</span><span class="p">(</span><span class="n">xss</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">tag</span><span class="p">)</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">kw</span><span class="p">[</span><span class="s1">&#39;H&#39;</span><span class="p">],</span> <span class="n">kw</span><span class="p">[</span><span class="s1">&#39;L&#39;</span><span class="p">],</span> <span class="n">numpoints</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
                <span class="n">_format_line_axes_legends</span><span class="p">(</span><span class="n">ax</span><span class="p">)</span>
                <span class="c1">#save the figure if keyword &#39;save&#39; == True, and append fig</span>
                <span class="n">_save_fig</span><span class="p">(</span><span class="s1">&#39;group_</span><span class="si">%s</span><span class="s1">-Bmax&#39;</span> <span class="o">%</span> <span class="nb">str</span><span class="p">(</span><span class="n">xss</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">tag</span><span class="p">),</span> <span class="n">fig</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">)</span>
                <span class="c1">#store the fig or close it</span>
                <span class="k">if</span><span class="p">(</span><span class="n">return_figs</span><span class="p">):</span>
                    <span class="n">figs</span><span class="p">[</span><span class="s1">&#39;B&#39;</span><span class="p">][</span><span class="n">xss</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">tag</span><span class="p">]</span> <span class="o">=</span> <span class="n">fig</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>

            <span class="c1">#EMAX</span>
            <span class="k">if</span><span class="p">(</span><span class="n">E_flag</span><span class="p">):</span>
                <span class="c1">#get plotting objects</span>
                <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
                <span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
                <span class="c1">#init handles and labels lists for legend</span>
                <span class="n">kw</span><span class="p">[</span><span class="s1">&#39;H&#39;</span><span class="p">],</span> <span class="n">kw</span><span class="p">[</span><span class="s1">&#39;L&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[]</span>
                <span class="c1">#plot the Bmax results for each xs in the group</span>
                <span class="n">_plot_group_fields</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">xss</span><span class="p">,</span> <span class="s1">&#39;Emax&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">)</span>
                <span class="c1">#plot wires</span>
                <span class="n">max_field</span> <span class="o">=</span> <span class="nb">max</span><span class="p">([</span><span class="n">xs</span><span class="o">.</span><span class="n">fields</span><span class="p">[</span><span class="s1">&#39;Emax&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="k">for</span> <span class="n">xs</span> <span class="ow">in</span> <span class="n">xss</span><span class="p">])</span>
                <span class="n">_plot_group_wires</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">xss</span><span class="p">,</span> <span class="n">max_field</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">)</span>
                <span class="c1">#adjust axis limits if called for</span>
                <span class="k">if</span><span class="p">(</span><span class="n">_include_headspace</span><span class="p">):</span>
                    <span class="n">yl</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_ylim</span><span class="p">()</span>
                    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">yl</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">_fields_plots_xs_headspace</span><span class="p">)</span><span class="o">*</span><span class="n">yl</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                <span class="c1">#plot ROW lines</span>
                <span class="n">_plot_group_ROW_edges</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">xss</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">)</span>
                <span class="c1">#set axis text and legendf</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">r&#39;Distance from Center of ROW $(ft)$&#39;</span><span class="p">)</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">r&#39;Maximum Electric Field $(kV/m)$&#39;</span><span class="p">)</span>
                <span class="n">t</span> <span class="o">=</span> <span class="s1">&#39;Maximum Electric Field - </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="nb">str</span><span class="p">(</span><span class="n">xss</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">tag</span><span class="p">)</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">kw</span><span class="p">[</span><span class="s1">&#39;H&#39;</span><span class="p">],</span> <span class="n">kw</span><span class="p">[</span><span class="s1">&#39;L&#39;</span><span class="p">],</span> <span class="n">numpoints</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
                <span class="n">_format_line_axes_legends</span><span class="p">(</span><span class="n">ax</span><span class="p">)</span>

                <span class="c1">#save the figure if keyword &#39;save&#39; == True or a path string is passed</span>
                <span class="n">_save_fig</span><span class="p">(</span><span class="s1">&#39;group_</span><span class="si">%s</span><span class="s1">-Emax&#39;</span> <span class="o">%</span> <span class="nb">str</span><span class="p">(</span><span class="n">xss</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">tag</span><span class="p">),</span> <span class="n">fig</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">)</span>
                <span class="c1">#store the fig or close it</span>
                <span class="k">if</span><span class="p">(</span><span class="n">return_figs</span><span class="p">):</span>
                    <span class="n">figs</span><span class="p">[</span><span class="s1">&#39;E&#39;</span><span class="p">][</span><span class="n">xss</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">tag</span><span class="p">]</span> <span class="o">=</span> <span class="n">fig</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>

    <span class="k">if</span><span class="p">(</span><span class="n">return_figs</span><span class="p">):</span>
        <span class="k">return</span><span class="p">(</span><span class="n">figs</span><span class="p">)</span>
</pre></div>

                    </div>
                </div></div><div class="function" id="plot_groups_at_ROW"><p class="function-str"><span class="function-name">plot_groups_at_ROW</span>(<span class="function-arg">sb</span>, **<span class="function-arg">kw</span>)</p><p class="docstr">Create bar charts showing the field values at ROW edges for each CrossSection group in a SectionBook<br>&ensp;&ensp;&ensp;&ensp;args:<br>&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;sb - SectionBook object to pull plotting groups from<br>&ensp;&ensp;&ensp;&ensp;kw:<br>&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;save - bool, toggle plot saving<br>&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;path - string, destination/filename for saved figure<br>&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;format - string, saved plot format/extension (default 'png')<br>&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;B - bool, toggle magnetic field plots, default is True<br>&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;E - bool, toggle electric field plots, default is True<br>&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;groups - a list of group names to plot, default is all groups<br>&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;xs_order - dict, keys are CrossSection group tags, which map to<br>&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;lists of CrossSection sheets specifying the order of the<br>&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;plotted CrossSection bars (left to right). Not all<br>&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;CrossSections in a group must be listed.<br>&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;Any/all can be left out.<br>&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;return_figs - toggle whether a list of figure objects is returned<br>&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;instead of closing the figures to clear memory,<br>&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;default is False<br>&ensp;&ensp;&ensp;&ensp;returns:<br>&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;figs - dict of dicts, keys are 'E' and 'B', which are each keyed<br>&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;by group tags, leading to Figure objects</p>
                <div class="source">
                    <h4 onclick="toggleSource(this)">show source</h4>
                    <div class="code">
                        <div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">plot_groups_at_ROW</span><span class="p">(</span><span class="n">sb</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Create bar charts showing the field values at ROW edges for each</span>
<span class="sd">    CrossSection group in a SectionBook</span>
<span class="sd">    args:</span>
<span class="sd">        sb - SectionBook object to pull plotting groups from</span>
<span class="sd">    kw:</span>
<span class="sd">        save - bool, toggle plot saving</span>
<span class="sd">        path - string, destination/filename for saved figure</span>
<span class="sd">        format - string, saved plot format/extension (default &#39;png&#39;)</span>
<span class="sd">        B - bool, toggle magnetic field plots, default is True</span>
<span class="sd">        E - bool, toggle electric field plots, default is True</span>
<span class="sd">        groups - a list of group names to plot, default is all groups</span>
<span class="sd">        xs_order - dict, keys are CrossSection group tags, which map to</span>
<span class="sd">                    lists of CrossSection sheets specifying the order of the</span>
<span class="sd">                    plotted CrossSection bars (left to right). Not all</span>
<span class="sd">                    CrossSections in a group must be listed.</span>
<span class="sd">                    Any/all can be left out.</span>
<span class="sd">        return_figs - toggle whether a list of figure objects is returned</span>
<span class="sd">                    instead of closing the figures to clear memory,</span>
<span class="sd">                    default is False</span>
<span class="sd">    returns:</span>
<span class="sd">        figs - dict of dicts, keys are &#39;E&#39; and &#39;B&#39;, which are each keyed</span>
<span class="sd">                by group tags, leading to Figure objects&quot;&quot;&quot;</span>

    <span class="c1">#check kws</span>
    <span class="n">return_figs</span> <span class="o">=</span> <span class="bp">False</span>
    <span class="k">if</span><span class="p">(</span><span class="s1">&#39;return_figs&#39;</span> <span class="ow">in</span> <span class="n">kw</span><span class="p">):</span>
        <span class="k">if</span><span class="p">(</span><span class="n">kw</span><span class="p">[</span><span class="s1">&#39;return_figs&#39;</span><span class="p">]):</span>
            <span class="n">return_figs</span> <span class="o">=</span> <span class="bp">True</span>
            <span class="n">figs</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;E&#39;</span><span class="p">:</span> <span class="p">{},</span> <span class="s1">&#39;B&#39;</span><span class="p">:</span> <span class="p">{}}</span>
    <span class="n">B_flag</span> <span class="o">=</span> <span class="bp">True</span>
    <span class="k">if</span><span class="p">(</span><span class="s1">&#39;B&#39;</span> <span class="ow">in</span> <span class="n">kw</span><span class="p">):</span>
        <span class="n">B_flag</span> <span class="o">=</span> <span class="n">kw</span><span class="p">[</span><span class="s1">&#39;B&#39;</span><span class="p">]</span>
    <span class="n">E_flag</span> <span class="o">=</span> <span class="bp">True</span>
    <span class="k">if</span><span class="p">(</span><span class="s1">&#39;E&#39;</span> <span class="ow">in</span> <span class="n">kw</span><span class="p">):</span>
        <span class="n">E_flag</span> <span class="o">=</span> <span class="n">kw</span><span class="p">[</span><span class="s1">&#39;E&#39;</span><span class="p">]</span>
    <span class="n">groups</span> <span class="o">=</span> <span class="n">sb</span><span class="o">.</span><span class="n">tags</span>
    <span class="k">if</span><span class="p">(</span><span class="s1">&#39;groups&#39;</span> <span class="ow">in</span> <span class="n">kw</span><span class="p">):</span>
        <span class="n">groups</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">kw</span><span class="p">[</span><span class="s1">&#39;groups&#39;</span><span class="p">])</span>

    <span class="c1">#iterate over groups with more than 1 CrossSection</span>
    <span class="k">for</span> <span class="n">xss</span> <span class="ow">in</span> <span class="n">sb</span><span class="o">.</span><span class="n">tag_groups</span><span class="p">:</span>

        <span class="k">if</span><span class="p">(</span><span class="n">xss</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">tag</span> <span class="ow">in</span> <span class="n">groups</span><span class="p">):</span>

            <span class="c1">#get reordered CrossSection list</span>
            <span class="n">xss</span> <span class="o">=</span> <span class="n">_reorder_xss</span><span class="p">(</span><span class="n">xss</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">)</span>

            <span class="c1">#plot Bmax</span>
            <span class="k">if</span><span class="p">(</span><span class="n">B_flag</span><span class="p">):</span>
                <span class="n">fig</span><span class="p">,</span> <span class="n">axl</span><span class="p">,</span> <span class="n">axr</span> <span class="o">=</span> <span class="n">_generate_ROW_value_plot_objects</span><span class="p">(</span><span class="n">xss</span><span class="p">)</span>
                <span class="n">_plot_group_bars</span><span class="p">(</span><span class="n">axl</span><span class="p">,</span> <span class="n">xss</span><span class="p">,</span> <span class="s1">&#39;Bmax&#39;</span><span class="p">,</span> <span class="s1">&#39;left&#39;</span><span class="p">)</span>
                <span class="n">_plot_group_bars</span><span class="p">(</span><span class="n">axr</span><span class="p">,</span> <span class="n">xss</span><span class="p">,</span> <span class="s1">&#39;Bmax&#39;</span><span class="p">,</span> <span class="s1">&#39;right&#39;</span><span class="p">)</span>
                <span class="c1">#format</span>
                <span class="n">_format_bar_axes_legends</span><span class="p">(</span><span class="n">axl</span><span class="p">,</span> <span class="n">axr</span><span class="p">)</span>
                <span class="c1">#apply text</span>
                <span class="n">axl</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">r&#39;Maximum Magnetic Field $(mG)$&#39;</span><span class="p">)</span>
                <span class="n">fig</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="s1">&#39;Maximum Magnetic Fields at ROW Edges - </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span>
                        <span class="n">xss</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">tag</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">18</span><span class="p">)</span>
                <span class="c1">#save?</span>
                <span class="n">_save_fig</span><span class="p">(</span><span class="s1">&#39;group_</span><span class="si">%s</span><span class="s1">-ROW-Bmax&#39;</span> <span class="o">%</span> <span class="nb">str</span><span class="p">(</span><span class="n">xss</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">tag</span><span class="p">),</span> <span class="n">fig</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">)</span>
                <span class="c1">#store the fig or close it</span>
                <span class="k">if</span><span class="p">(</span><span class="n">return_figs</span><span class="p">):</span>
                    <span class="n">figs</span><span class="p">[</span><span class="s1">&#39;B&#39;</span><span class="p">][</span><span class="n">xss</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">tag</span><span class="p">]</span> <span class="o">=</span> <span class="n">fig</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>

            <span class="c1">#plot Emax</span>
            <span class="k">if</span><span class="p">(</span><span class="n">E_flag</span><span class="p">):</span>
                <span class="n">fig</span><span class="p">,</span> <span class="n">axl</span><span class="p">,</span> <span class="n">axr</span> <span class="o">=</span> <span class="n">_generate_ROW_value_plot_objects</span><span class="p">(</span><span class="n">xss</span><span class="p">)</span>
                <span class="n">_plot_group_bars</span><span class="p">(</span><span class="n">axl</span><span class="p">,</span> <span class="n">xss</span><span class="p">,</span> <span class="s1">&#39;Emax&#39;</span><span class="p">,</span> <span class="s1">&#39;left&#39;</span><span class="p">)</span>
                <span class="n">_plot_group_bars</span><span class="p">(</span><span class="n">axr</span><span class="p">,</span> <span class="n">xss</span><span class="p">,</span> <span class="s1">&#39;Emax&#39;</span><span class="p">,</span> <span class="s1">&#39;right&#39;</span><span class="p">)</span>
                <span class="c1">#format</span>
                <span class="n">_format_bar_axes_legends</span><span class="p">(</span><span class="n">axl</span><span class="p">,</span> <span class="n">axr</span><span class="p">)</span>
                <span class="c1">#apply text</span>
                <span class="n">axl</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">r&#39;Maximum Electric Field $(kV/m)$&#39;</span><span class="p">)</span>
                <span class="n">fig</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="s1">&#39;Maximum Electric Fields at ROW Edges - </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span>
                        <span class="n">xss</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">tag</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">18</span><span class="p">)</span>
                <span class="c1">#save?</span>
                <span class="n">_save_fig</span><span class="p">(</span><span class="s1">&#39;group_</span><span class="si">%s</span><span class="s1">-ROW-Emax&#39;</span> <span class="o">%</span> <span class="nb">str</span><span class="p">(</span><span class="n">xss</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">tag</span><span class="p">),</span> <span class="n">fig</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">)</span>
                <span class="c1">#store the fig or close it</span>
                <span class="k">if</span><span class="p">(</span><span class="n">return_figs</span><span class="p">):</span>
                    <span class="n">figs</span><span class="p">[</span><span class="s1">&#39;E&#39;</span><span class="p">][</span><span class="n">xss</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">tag</span><span class="p">]</span> <span class="o">=</span> <span class="n">fig</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>

    <span class="k">if</span><span class="p">(</span><span class="n">return_figs</span><span class="p">):</span>
        <span class="k">return</span><span class="p">(</span><span class="n">figs</span><span class="p">)</span>
</pre></div>

                    </div>
                </div></div><div class="function" id="plot_max_fields"><p class="function-str"><span class="function-name">plot_max_fields</span>(<span class="function-arg">xs</span>, **<span class="function-arg">kw</span>)</p><p class="docstr">Plot the maximum magnetic and electric field on split vertical axes, along the ROW with conductor locations shown in artificial coordinates.<br>&ensp;&ensp;&ensp;&ensp;args:<br>&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;xs - a CrossSection object<br>&ensp;&ensp;&ensp;&ensp;kw:<br>&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;ax - target Axes<br>&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;fig - Figure object, target figure for plotting, overridden by 'ax'<br>&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;title - string, exact plot title<br>&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;save - bool, toggle plot saving<br>&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;path - string, destination/filename for saved figure<br>&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;format - string, saved plot format/extension (default 'png')<br>&ensp;&ensp;&ensp;&ensp;returns:<br>&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;fig - Figure object<br>&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;ax_B - B field Axes<br>&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;ax_E - E field Axes</p>
                <div class="source">
                    <h4 onclick="toggleSource(this)">show source</h4>
                    <div class="code">
                        <div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">plot_max_fields</span><span class="p">(</span><span class="n">xs</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Plot the maximum magnetic and electric field on split vertical axes, along</span>
<span class="sd">    the ROW with conductor locations shown in artificial coordinates.</span>
<span class="sd">    args:</span>
<span class="sd">        xs - a CrossSection object</span>
<span class="sd">    kw:</span>
<span class="sd">        ax - target Axes</span>
<span class="sd">        fig - Figure object, target figure for plotting, overridden by &#39;ax&#39;</span>
<span class="sd">        title - string, exact plot title</span>
<span class="sd">        save - bool, toggle plot saving</span>
<span class="sd">        path - string, destination/filename for saved figure</span>
<span class="sd">        format - string, saved plot format/extension (default &#39;png&#39;)</span>
<span class="sd">    returns:</span>
<span class="sd">        fig - Figure object</span>
<span class="sd">        ax_B - B field Axes</span>
<span class="sd">        ax_E - E field Axes&quot;&quot;&quot;</span>

    <span class="c1">#get plotting objects</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">ax_B</span> <span class="o">=</span> <span class="n">_prepare_fig</span><span class="p">(</span><span class="o">**</span><span class="n">kw</span><span class="p">)</span>
    <span class="n">ax_E</span> <span class="o">=</span> <span class="n">ax_B</span><span class="o">.</span><span class="n">twinx</span><span class="p">()</span>
    <span class="c1">#get plotting specs</span>
    <span class="n">xmax</span> <span class="o">=</span> <span class="n">_find_xmax</span><span class="p">(</span><span class="n">xs</span><span class="p">)</span>
    <span class="c1">#plot the field curves</span>
    <span class="n">kw</span><span class="p">[</span><span class="s1">&#39;H&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">ax_B</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xs</span><span class="o">.</span><span class="n">fields</span><span class="p">[</span><span class="s1">&#39;Bmax&#39;</span><span class="p">][</span><span class="o">-</span><span class="n">xmax</span><span class="p">:</span><span class="n">xmax</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="n">_B_color</span><span class="p">,</span>
                        <span class="n">linewidth</span><span class="o">=</span><span class="n">_fields_linewidth</span><span class="p">)[</span><span class="mi">0</span><span class="p">],</span>
                <span class="n">ax_E</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xs</span><span class="o">.</span><span class="n">fields</span><span class="p">[</span><span class="s1">&#39;Emax&#39;</span><span class="p">][</span><span class="o">-</span><span class="n">xmax</span><span class="p">:</span><span class="n">xmax</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="n">_E_color</span><span class="p">,</span>
                        <span class="n">linewidth</span><span class="o">=</span><span class="n">_fields_linewidth</span><span class="p">)[</span><span class="mi">0</span><span class="p">]]</span>
    <span class="n">kw</span><span class="p">[</span><span class="s1">&#39;L&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s1">r&#39;Magnetic Field $(mG)$&#39;</span><span class="p">,</span>
            <span class="s1">r&#39;Electric Field $(kV/m)$&#39;</span><span class="p">]</span>
    <span class="c1">#plot wires</span>
    <span class="n">_plot_wires</span><span class="p">(</span><span class="n">ax_B</span><span class="p">,</span> <span class="n">xs</span><span class="o">.</span><span class="n">hot</span><span class="p">,</span> <span class="n">xs</span><span class="o">.</span><span class="n">gnd</span><span class="p">,</span> <span class="n">xs</span><span class="o">.</span><span class="n">fields</span><span class="p">[</span><span class="s1">&#39;Bmax&#39;</span><span class="p">],</span> <span class="o">**</span><span class="n">kw</span><span class="p">)</span>
    <span class="n">_check_und_conds</span><span class="p">([</span><span class="n">xs</span><span class="p">],</span> <span class="p">[</span><span class="n">ax_B</span><span class="p">,</span> <span class="n">ax_E</span><span class="p">],</span> <span class="o">**</span><span class="n">kw</span><span class="p">)</span>
    <span class="c1">#adjust axis limits if headspace is called for</span>
    <span class="k">if</span><span class="p">(</span><span class="n">_include_headspace</span><span class="p">):</span>
        <span class="n">yl</span> <span class="o">=</span> <span class="n">ax_B</span><span class="o">.</span><span class="n">get_ylim</span><span class="p">()</span>
        <span class="n">ax_B</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">yl</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">_fields_plots_xs_headspace</span><span class="p">)</span><span class="o">*</span><span class="n">yl</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">yl</span> <span class="o">=</span> <span class="n">ax_E</span><span class="o">.</span><span class="n">get_ylim</span><span class="p">()</span>
        <span class="n">ax_E</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">yl</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">_fields_plots_xs_headspace</span><span class="p">)</span><span class="o">*</span><span class="n">yl</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
    <span class="c1">#plot ROW lines</span>
    <span class="n">_plot_ROW_edges</span><span class="p">(</span><span class="n">ax_B</span><span class="p">,</span> <span class="n">xs</span><span class="o">.</span><span class="n">lROW</span><span class="p">,</span> <span class="n">xs</span><span class="o">.</span><span class="n">rROW</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">)</span>
    <span class="c1">#set axis text</span>
    <span class="n">ax_B</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">r&#39;Distance from Center of ROW $(ft)$&#39;</span><span class="p">)</span>
    <span class="n">ax_B</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">r&#39;Maximum Magnetic Field $(mG)$&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">_B_color</span><span class="p">)</span>
    <span class="n">ax_E</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">r&#39;Maximum Electric Field $(kV/m)$&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">_E_color</span><span class="p">)</span>
    <span class="n">ax_B</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Maximum Magnetic and Electric Fields - </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">xs</span><span class="o">.</span><span class="n">title</span><span class="p">)</span>
    <span class="c1">#set color of axis spines and ticklabels</span>
    <span class="n">_color_twin_axes</span><span class="p">(</span><span class="n">ax_B</span><span class="p">,</span> <span class="n">_B_color</span><span class="p">,</span> <span class="n">ax_E</span><span class="p">,</span> <span class="n">_E_color</span><span class="p">)</span>
    <span class="c1">#legend</span>
    <span class="n">ax_B</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">kw</span><span class="p">[</span><span class="s1">&#39;H&#39;</span><span class="p">],</span> <span class="n">kw</span><span class="p">[</span><span class="s1">&#39;L&#39;</span><span class="p">],</span> <span class="n">numpoints</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">_format_line_axes_legends</span><span class="p">(</span><span class="n">ax_B</span><span class="p">,</span> <span class="n">ax_E</span><span class="p">)</span>
    <span class="n">_format_twin_axes</span><span class="p">(</span><span class="n">ax_B</span><span class="p">,</span> <span class="n">ax_E</span><span class="p">)</span>
    <span class="c1">#save the fig or don&#39;t, depending on keywords</span>
    <span class="n">_save_fig</span><span class="p">(</span><span class="n">xs</span><span class="o">.</span><span class="n">sheet</span><span class="p">,</span> <span class="n">fig</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">)</span>
    <span class="c1">#return</span>
    <span class="k">return</span><span class="p">(</span><span class="n">fig</span><span class="p">,</span> <span class="n">ax_B</span><span class="p">,</span> <span class="n">ax_E</span><span class="p">)</span>
</pre></div>

                    </div>
                </div></div><div class="function" id="plot_xs"><p class="function-str"><span class="function-name">plot_xs</span>(<span class="function-arg">xs</span>, **<span class="function-arg">kw</span>)</p><p class="docstr">Plot CrossSection conductors and ROW edges without any fields<br>&ensp;&ensp;&ensp;&ensp;args:<br>&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;xs - CrossSection objects<br>&ensp;&ensp;&ensp;&ensp;kw:<br>&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;ax - target Axes<br>&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;fig - Figure object, target figure for plotting, overridden by 'ax'<br>&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;save - bool, toggle plot saving<br>&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;path - string, destination/filename for saved figure<br>&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;format - string, saved plot format/extension (default 'png')</p>
                <div class="source">
                    <h4 onclick="toggleSource(this)">show source</h4>
                    <div class="code">
                        <div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">plot_xs</span><span class="p">(</span><span class="n">xs</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Plot CrossSection conductors and ROW edges without any fields</span>
<span class="sd">    args:</span>
<span class="sd">        xs - CrossSection objects</span>
<span class="sd">    kw:</span>
<span class="sd">        ax - target Axes</span>
<span class="sd">        fig - Figure object, target figure for plotting, overridden by &#39;ax&#39;</span>
<span class="sd">        save - bool, toggle plot saving</span>
<span class="sd">        path - string, destination/filename for saved figure</span>
<span class="sd">        format - string, saved plot format/extension (default &#39;png&#39;)&quot;&quot;&quot;</span>
    <span class="c1">#get plotting objects</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">_prepare_fig</span><span class="p">(</span><span class="o">**</span><span class="n">kw</span><span class="p">)</span>
    <span class="n">size</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">get_size_inches</span><span class="p">()</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">set_size_inches</span><span class="p">(</span><span class="n">size</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="mi">3</span><span class="p">,</span> <span class="n">size</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
    <span class="c1">#init handles and labels lists for legend</span>
    <span class="n">kw</span><span class="p">[</span><span class="s1">&#39;H&#39;</span><span class="p">],</span> <span class="n">kw</span><span class="p">[</span><span class="s1">&#39;L&#39;</span><span class="p">],</span> <span class="n">kw</span><span class="p">[</span><span class="s1">&#39;scale&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[],</span> <span class="bp">False</span>
    <span class="c1">#plot wires</span>
    <span class="n">_plot_wires</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">xs</span><span class="o">.</span><span class="n">hot</span><span class="p">,</span> <span class="n">xs</span><span class="o">.</span><span class="n">gnd</span><span class="p">,</span> <span class="p">[</span><span class="n">c</span><span class="o">.</span><span class="n">y</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">xs</span><span class="o">.</span><span class="n">conds</span><span class="p">],</span> <span class="o">**</span><span class="n">kw</span><span class="p">)</span>
    <span class="c1">#adjust axis limits if headspace is called for</span>
    <span class="k">if</span><span class="p">(</span><span class="n">_include_headspace</span><span class="p">):</span>
        <span class="n">yl</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_ylim</span><span class="p">()</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">yl</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">_fields_plots_xs_headspace</span><span class="p">)</span><span class="o">*</span><span class="n">yl</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
    <span class="c1">#plot ROW lines</span>
    <span class="n">_plot_ROW_edges</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">xs</span><span class="o">.</span><span class="n">lROW</span><span class="p">,</span> <span class="n">xs</span><span class="o">.</span><span class="n">rROW</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">)</span>
    <span class="c1">#check underground conductors</span>
    <span class="n">_check_und_conds</span><span class="p">([</span><span class="n">xs</span><span class="p">],</span> <span class="p">[</span><span class="n">ax</span><span class="p">],</span> <span class="o">**</span><span class="n">kw</span><span class="p">)</span>
    <span class="c1">#set axis text and legend</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Cross Section Configuration - </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">xs</span><span class="o">.</span><span class="n">title</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">r&#39;Distance from Center of ROW $(ft)$&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">r&#39;Height Above Ground $(ft)$&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">kw</span><span class="p">[</span><span class="s1">&#39;H&#39;</span><span class="p">],</span> <span class="n">kw</span><span class="p">[</span><span class="s1">&#39;L&#39;</span><span class="p">],</span> <span class="n">numpoints</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="c1">#format</span>
    <span class="n">_format_line_axes_legends</span><span class="p">(</span><span class="n">ax</span><span class="p">)</span>
    <span class="c1">#save or don&#39;t</span>
    <span class="n">_save_fig</span><span class="p">(</span><span class="n">xs</span><span class="o">.</span><span class="n">sheet</span><span class="p">,</span> <span class="n">fig</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">)</span>
    <span class="c1">#return</span>
    <span class="k">return</span><span class="p">(</span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span><span class="p">)</span>
</pre></div>

                    </div>
                </div></div><div class="function" id="read_DAT"><p class="function-str"><span class="function-name">read_DAT</span>(<span class="function-arg">file_path</span>)</p><p class="docstr">Read a DAT file, which can have some funky extra characters if the numbers are too large (percent signs)<br>&ensp;&ensp;&ensp;&ensp;args:<br>&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;file_path - string, path to DAT file<br>&ensp;&ensp;&ensp;&ensp;returns:<br>&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;pandas DataFrame with 'Bx','By','Bprod','Bmax','Ex','Ey','Eprod',<br>&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;and 'Emax' columns, and the distance ('x') in the index</p>
                <div class="source">
                    <h4 onclick="toggleSource(this)">show source</h4>
                    <div class="code">
                        <div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">read_DAT</span><span class="p">(</span><span class="n">file_path</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Read a DAT file, which can have some funky extra characters if the numbers</span>
<span class="sd">    are too large (percent signs)</span>
<span class="sd">    args:</span>
<span class="sd">        file_path - string, path to DAT file</span>
<span class="sd">    returns:</span>
<span class="sd">        pandas DataFrame with &#39;Bx&#39;,&#39;By&#39;,&#39;Bprod&#39;,&#39;Bmax&#39;,&#39;Ex&#39;,&#39;Ey&#39;,&#39;Eprod&#39;,</span>
<span class="sd">        and &#39;Emax&#39; columns, and the distance (&#39;x&#39;) in the index&quot;&quot;&quot;</span>

    <span class="c1">#check that the target file is a DAT</span>
    <span class="n">fields_funks</span><span class="o">.</span><span class="n">_check_extension</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="s1">&#39;DAT&#39;</span><span class="p">,</span> <span class="s2">&quot;&quot;&quot;Input file must have a &#39;.DAT&#39; extension.&quot;&quot;&quot;</span><span class="p">)</span>
    <span class="c1">#load data</span>
    <span class="n">und_message</span> <span class="o">=</span> <span class="s1">&#39;Electric Field cannot be computed for underground circuit&#39;</span>
    <span class="n">und_only</span> <span class="o">=</span> <span class="bp">False</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span><span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">ifile</span><span class="p">:</span>
        <span class="c1">#read through the header</span>
        <span class="n">line</span> <span class="o">=</span> <span class="n">ifile</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span>
        <span class="k">while</span><span class="p">(</span><span class="ow">not</span> <span class="p">(</span><span class="s1">&#39;----&#39;</span> <span class="ow">in</span> <span class="n">line</span><span class="p">)):</span>
            <span class="n">line</span> <span class="o">=</span> <span class="n">ifile</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span>
            <span class="k">if</span><span class="p">(</span><span class="n">und_message</span> <span class="ow">in</span> <span class="n">line</span><span class="p">):</span>
                <span class="n">und_only</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="c1">#get the data</span>
        <span class="n">data</span> <span class="o">=</span> <span class="p">[[]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">9</span><span class="p">)]</span>
        <span class="n">line</span> <span class="o">=</span> <span class="n">ifile</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span>
        <span class="k">while</span><span class="p">(</span><span class="n">line</span><span class="p">):</span>
            <span class="k">if</span><span class="p">(</span><span class="n">line</span><span class="p">):</span>
                <span class="c1">#check strange % signs printed with large numbers</span>
                <span class="k">if</span><span class="p">(</span><span class="n">line</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;%&#39;</span><span class="p">):</span>
                    <span class="n">line</span> <span class="o">+=</span> <span class="n">ifile</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span>
            <span class="n">l</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;%&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()]</span>
            <span class="k">if</span><span class="p">(</span><span class="n">l</span> <span class="ow">and</span> <span class="nb">all</span><span class="p">([</span><span class="n">fields_funks</span><span class="o">.</span><span class="n">_is_number</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">l</span><span class="p">])):</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">):</span>
                    <span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">l</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span>
                <span class="k">if</span><span class="p">(</span><span class="ow">not</span> <span class="p">(</span><span class="n">und_only</span><span class="p">)):</span>
                    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="mi">9</span><span class="p">):</span>
                        <span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">l</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="mi">9</span><span class="p">):</span>
                        <span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mf">0.</span><span class="p">)</span>
            <span class="n">line</span> <span class="o">=</span> <span class="n">ifile</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span>
    <span class="k">return</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="o">=</span>
        <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">([</span><span class="s1">&#39;Bx&#39;</span><span class="p">,</span><span class="s1">&#39;By&#39;</span><span class="p">,</span><span class="s1">&#39;Bprod&#39;</span><span class="p">,</span><span class="s1">&#39;Bmax&#39;</span><span class="p">,</span><span class="s1">&#39;Ex&#39;</span><span class="p">,</span><span class="s1">&#39;Ey&#39;</span><span class="p">,</span><span class="s1">&#39;Eprod&#39;</span><span class="p">,</span><span class="s1">&#39;Emax&#39;</span><span class="p">],</span><span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">:])),</span>
        <span class="n">index</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
</pre></div>

                    </div>
                </div></div><div class="function" id="run"><p class="function-str"><span class="function-name">run</span>(<span class="function-arg">template_path</span>, **<span class="function-arg">kw</span>)</p><p class="docstr">Import the templates in an excel file with the path 'template_path' then generate a workbook of all fields results and lots of plots. Use the 'path' keyword argument to specify a destination for the output, otherwise it will be saved to the template's directory. Returns a SectionBook object.<br>&ensp;&ensp;&ensp;&ensp;args:<br>&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;template_path - path to cross section template excel workbook<br>&ensp;&ensp;&ensp;&ensp;kw:<br>&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;sheets - a list of sheet names to load, default is all sheets<br>&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;path - string, destination/filename for saved files<br>&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;format - string, saved plot format (usually 'png' or 'pdf')<br>&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;xmax - cutoff distance from ROW center in plots</p>
                <div class="source">
                    <h4 onclick="toggleSource(this)">show source</h4>
                    <div class="code">
                        <div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="n">template_path</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Import the templates in an excel file with the path &#39;template_path&#39; then</span>
<span class="sd">    generate a workbook of all fields results and lots of plots. Use the &#39;path&#39;</span>
<span class="sd">    keyword argument to specify a destination for the output, otherwise it will</span>
<span class="sd">    be saved to the template&#39;s directory. Returns a SectionBook object.</span>
<span class="sd">    args:</span>
<span class="sd">        template_path - path to cross section template excel workbook</span>
<span class="sd">    kw:</span>
<span class="sd">        sheets - a list of sheet names to load, default is all sheets</span>
<span class="sd">        path - string, destination/filename for saved files</span>
<span class="sd">        format - string, saved plot format (usually &#39;png&#39; or &#39;pdf&#39;)</span>
<span class="sd">        xmax - cutoff distance from ROW center in plots&quot;&quot;&quot;</span>
    <span class="c1">#force saving for the plotting functions if there is no &#39;path&#39; keyword</span>
    <span class="k">if</span><span class="p">(</span><span class="ow">not</span> <span class="p">(</span><span class="s1">&#39;path&#39;</span> <span class="ow">in</span> <span class="n">kw</span><span class="p">)):</span>
        <span class="n">kw</span><span class="p">[</span><span class="s1">&#39;save&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="c1">#also direct output files to the same directory as the template</span>
        <span class="n">kw</span><span class="p">[</span><span class="s1">&#39;path&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">template_path</span><span class="p">)</span>
    <span class="c1">#import templates</span>
    <span class="n">sb</span> <span class="o">=</span> <span class="n">load_template</span><span class="p">(</span><span class="n">template_path</span><span class="p">)</span>
    <span class="c1">#export the full results workbook</span>
    <span class="n">sb</span><span class="o">.</span><span class="n">results_export</span><span class="p">(</span><span class="o">**</span><span class="n">kw</span><span class="p">)</span>
    <span class="c1">#export ROW edge results</span>
    <span class="n">sb</span><span class="o">.</span><span class="n">ROW_edge_export</span><span class="p">(</span><span class="o">**</span><span class="n">kw</span><span class="p">)</span>
    <span class="c1">#export single CrossSection plots</span>
    <span class="k">for</span> <span class="n">xs</span> <span class="ow">in</span> <span class="n">sb</span><span class="p">:</span>
        <span class="n">fig</span><span class="p">,</span> <span class="n">ax_E</span><span class="p">,</span> <span class="n">ax_B</span> <span class="o">=</span> <span class="n">fields_plots</span><span class="o">.</span><span class="n">plot_max_fields</span><span class="p">(</span><span class="n">xs</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">)</span>
        <span class="n">fields_plots</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>
    <span class="c1">#export group comparison line plots</span>
    <span class="n">fields_plots</span><span class="o">.</span><span class="n">plot_groups</span><span class="p">(</span><span class="n">sb</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">)</span>
    <span class="c1">#export group ROW comparison bar plots</span>
    <span class="n">fields_plots</span><span class="o">.</span><span class="n">plot_groups_at_ROW</span><span class="p">(</span><span class="n">sb</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">)</span>
    <span class="k">return</span><span class="p">(</span><span class="n">sb</span><span class="p">)</span>
</pre></div>

                    </div>
                </div></div><div class="function" id="show"><p class="function-str"><span class="function-name">show</span>()</p><p class="docstr">Call plt.show() to display open figures</p>
                <div class="source">
                    <h4 onclick="toggleSource(this)">show source</h4>
                    <div class="code">
                        <div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">show</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;Call plt.show() to display open figures&quot;&quot;&quot;</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>

                    </div>
                </div></div><div class="function" id="target_fields"><p class="function-str"><span class="function-name">target_fields</span>(<span class="function-arg">xs</span>, <span class="function-arg">tags</span>, <span class="function-arg">B_l</span>, <span class="function-arg">B_r</span>, <span class="function-arg">E_l</span>, <span class="function-arg">E_r</span>, **<span class="function-arg">kw</span>)</p><p class="docstr">Increase conductor y coordinates until fields at ROW edges are below thresholds. All selected conductors are adjusted by the same amount. If any of the thresholds are empty or false, None is returned for their adjustment result.<br>&ensp;&ensp;&ensp;&ensp;args:<br>&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;xs - CrossSection object to perform adjustments on<br>&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;tags - iterable of Conductor tags, identifying which ones to raise<br>&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;B_l - magnetic field threshold at left ROW edge*<br>&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;B_r - magnetic field threshold at right ROW edge*<br>&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;E_l - electric field threshold at left ROW edge*<br>&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;E_r - electric field threshold at right ROW edge*<br><br>&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;*an implicitly False input will ignore that field-edge<br>&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;combination, return None in the return variable 'h', and cause<br>&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;the returned SectionBook to omit that field-edge combo.<br><br>&ensp;&ensp;&ensp;&ensp;kw:<br>&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;max_iter - maximum number of _bisection iterations allowed,<br>&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;default is 1e3<br>&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;rel_err - tolerance threshold for relative error (e.g. 0.01 is 1 %),<br>&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;default is 1e-6.<br>&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;hhigh - upper limit of the height adjustment, default is 1.0e6<br>&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;save - toggle saving of the results DataFrame to an excel book<br>&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;path - location/filename for saved results workbook, forces saving<br>&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;even if no 'save' keyword is used.<br>&ensp;&ensp;&ensp;&ensp;returns:<br>&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;h - height adjustments necessary for E and B fields at left and<br>&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;right ROW edges. The ordering is: (B_left, B_right, E_left, E_right)<br>&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;adj - a new SectionBook object with the adjusted conductor heights<br>&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;for each scenario in a CrossSection</p>
                <div class="source">
                    <h4 onclick="toggleSource(this)">show source</h4>
                    <div class="code">
                        <div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">target_fields</span><span class="p">(</span><span class="n">xs</span><span class="p">,</span> <span class="n">tags</span><span class="p">,</span> <span class="n">B_l</span><span class="p">,</span> <span class="n">B_r</span><span class="p">,</span> <span class="n">E_l</span><span class="p">,</span> <span class="n">E_r</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Increase conductor y coordinates until fields at ROW edges are below</span>
<span class="sd">    thresholds. All selected conductors are adjusted by the same amount. If any</span>
<span class="sd">    of the thresholds are empty or false, None is returned for their adjustment</span>
<span class="sd">    result.</span>
<span class="sd">    args:</span>
<span class="sd">        xs - CrossSection object to perform adjustments on</span>
<span class="sd">        tags - iterable of Conductor tags, identifying which ones to raise</span>
<span class="sd">        B_l - magnetic field threshold at left ROW edge*</span>
<span class="sd">        B_r - magnetic field threshold at right ROW edge*</span>
<span class="sd">        E_l - electric field threshold at left ROW edge*</span>
<span class="sd">        E_r - electric field threshold at right ROW edge*</span>

<span class="sd">            *an implicitly False input will ignore that field-edge</span>
<span class="sd">            combination, return None in the return variable &#39;h&#39;, and cause</span>
<span class="sd">            the returned SectionBook to omit that field-edge combo.</span>

<span class="sd">    kw:</span>
<span class="sd">        max_iter - maximum number of _bisection iterations allowed,</span>
<span class="sd">                    default is 1e3</span>
<span class="sd">        rel_err - tolerance threshold for relative error (e.g. 0.01 is 1 %),</span>
<span class="sd">                    default is 1e-6.</span>
<span class="sd">        hhigh - upper limit of the height adjustment, default is 1.0e6</span>
<span class="sd">        save - toggle saving of the results DataFrame to an excel book</span>
<span class="sd">        path - location/filename for saved results workbook, forces saving</span>
<span class="sd">                even if no &#39;save&#39; keyword is used.</span>
<span class="sd">    returns:</span>
<span class="sd">        h - height adjustments necessary for E and B fields at left and</span>
<span class="sd">            right ROW edges. The ordering is: (B_left, B_right, E_left, E_right)</span>
<span class="sd">        adj - a new SectionBook object with the adjusted conductor heights</span>
<span class="sd">                for each scenario in a CrossSection&quot;&quot;&quot;</span>
    <span class="c1">#convert &#39;all&#39; inputs to numeric indices</span>
    <span class="k">if</span><span class="p">(</span><span class="n">tags</span> <span class="o">==</span> <span class="s1">&#39;all&#39;</span><span class="p">):</span>
        <span class="n">tags</span> <span class="o">=</span> <span class="n">xs</span><span class="o">.</span><span class="n">tags</span>
    <span class="c1">#maximum number of iterations and relative error tolerance</span>
    <span class="k">if</span><span class="p">(</span><span class="s1">&#39;max_iter&#39;</span> <span class="ow">in</span> <span class="n">kw</span><span class="p">):</span>
        <span class="n">max_iter</span> <span class="o">=</span> <span class="n">kw</span><span class="p">[</span><span class="s1">&#39;max_iter&#39;</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">max_iter</span> <span class="o">=</span> <span class="mf">1e3</span>
    <span class="k">if</span><span class="p">(</span><span class="s1">&#39;rel_err&#39;</span> <span class="ow">in</span> <span class="n">kw</span><span class="p">):</span>
        <span class="n">rel_err</span> <span class="o">=</span> <span class="n">kw</span><span class="p">[</span><span class="s1">&#39;rel_err&#39;</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">rel_err</span> <span class="o">=</span> <span class="mf">1.0e-6</span>
    <span class="k">if</span><span class="p">(</span><span class="s1">&#39;hhigh&#39;</span> <span class="ow">in</span> <span class="n">kw</span><span class="p">):</span>
        <span class="n">hhigh</span> <span class="o">=</span> <span class="n">kw</span><span class="p">[</span><span class="s1">&#39;hhigh&#39;</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">hhigh</span> <span class="o">=</span> <span class="mf">1.0e6</span>
    <span class="n">hlow</span> <span class="o">=</span> <span class="mf">0.0</span>
    <span class="c1">#flattened indices</span>
    <span class="n">temp</span> <span class="o">=</span> <span class="n">xs</span><span class="o">.</span><span class="n">tags</span>
    <span class="n">conds</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">temp</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">tags</span><span class="p">])</span>
    <span class="c1">#run secant method to find adjustments for each target</span>
    <span class="n">h_B_l</span><span class="p">,</span> <span class="n">h_B_r</span><span class="p">,</span> <span class="n">h_E_l</span><span class="p">,</span> <span class="n">h_E_r</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="bp">None</span>
    <span class="k">if</span><span class="p">(</span><span class="n">B_l</span><span class="p">):</span>
        <span class="n">h_B_l</span> <span class="o">=</span> <span class="n">_bisect</span><span class="p">(</span><span class="n">xs</span><span class="p">,</span> <span class="n">conds</span><span class="p">,</span> <span class="n">xs</span><span class="o">.</span><span class="n">lROW</span><span class="p">,</span> <span class="n">_B_funk</span><span class="p">,</span> <span class="n">B_l</span><span class="p">,</span>
                <span class="n">hlow</span><span class="p">,</span> <span class="n">hhigh</span><span class="p">,</span> <span class="n">max_iter</span><span class="p">,</span> <span class="n">rel_err</span><span class="p">)</span>
    <span class="k">if</span><span class="p">(</span><span class="n">B_r</span><span class="p">):</span>
        <span class="n">h_B_r</span> <span class="o">=</span> <span class="n">_bisect</span><span class="p">(</span><span class="n">xs</span><span class="p">,</span> <span class="n">conds</span><span class="p">,</span> <span class="n">xs</span><span class="o">.</span><span class="n">rROW</span><span class="p">,</span> <span class="n">_B_funk</span><span class="p">,</span> <span class="n">B_r</span><span class="p">,</span>
                <span class="n">hlow</span><span class="p">,</span> <span class="n">hhigh</span><span class="p">,</span> <span class="n">max_iter</span><span class="p">,</span> <span class="n">rel_err</span><span class="p">)</span>
    <span class="k">if</span><span class="p">(</span><span class="n">E_l</span><span class="p">):</span>
        <span class="n">h_E_l</span> <span class="o">=</span> <span class="n">_bisect</span><span class="p">(</span><span class="n">xs</span><span class="p">,</span> <span class="n">conds</span><span class="p">,</span> <span class="n">xs</span><span class="o">.</span><span class="n">lROW</span><span class="p">,</span> <span class="n">_E_funk</span><span class="p">,</span> <span class="n">E_l</span><span class="p">,</span>
                <span class="n">hlow</span><span class="p">,</span> <span class="n">hhigh</span><span class="p">,</span> <span class="n">max_iter</span><span class="p">,</span> <span class="n">rel_err</span><span class="p">)</span>
    <span class="k">if</span><span class="p">(</span><span class="n">E_r</span><span class="p">):</span>
        <span class="n">h_E_r</span> <span class="o">=</span> <span class="n">_bisect</span><span class="p">(</span><span class="n">xs</span><span class="p">,</span> <span class="n">conds</span><span class="p">,</span> <span class="n">xs</span><span class="o">.</span><span class="n">rROW</span><span class="p">,</span> <span class="n">_E_funk</span><span class="p">,</span> <span class="n">E_r</span><span class="p">,</span>
                <span class="n">hlow</span><span class="p">,</span> <span class="n">hhigh</span><span class="p">,</span> <span class="n">max_iter</span><span class="p">,</span> <span class="n">rel_err</span><span class="p">)</span>
    <span class="c1">#create return variables</span>
    <span class="n">h</span> <span class="o">=</span> <span class="p">(</span><span class="n">h_B_l</span><span class="p">,</span> <span class="n">h_B_r</span><span class="p">,</span> <span class="n">h_E_l</span><span class="p">,</span> <span class="n">h_E_r</span><span class="p">)</span>
    <span class="n">fn</span> <span class="o">=</span> <span class="n">_path_str_condition</span><span class="p">(</span><span class="n">xs</span><span class="o">.</span><span class="n">sheet</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="s1">&#39;-&#39;</span><span class="p">)</span>
    <span class="n">xs</span> <span class="o">=</span> <span class="n">xs</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="n">adj</span> <span class="o">=</span> <span class="n">fields_class</span><span class="o">.</span><span class="n">SectionBook</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">-height_adjusted&#39;</span> <span class="o">%</span> <span class="n">xs</span><span class="o">.</span><span class="n">sheet</span><span class="p">)</span>
    <span class="n">xs</span><span class="o">.</span><span class="n">sheet</span> <span class="o">+=</span> <span class="s1">&#39; (original)&#39;</span>
    <span class="n">xs</span><span class="o">.</span><span class="n">tag</span> <span class="o">=</span> <span class="s1">&#39;Height Adjusted&#39;</span>
    <span class="n">adj</span><span class="o">.</span><span class="n">add_section</span><span class="p">(</span><span class="n">xs</span><span class="p">)</span>
    <span class="n">sheets</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Adjusted for Bmax left&#39;</span><span class="p">,</span><span class="s1">&#39;Adjusted for Bmax right&#39;</span><span class="p">,</span>
                <span class="s1">&#39;Adjusted for Emax left&#39;</span><span class="p">,</span><span class="s1">&#39;Adjusted for Emax right&#39;</span><span class="p">]</span>
    <span class="n">titles</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Height Adjusted for </span><span class="si">%g</span><span class="s1"> mG at left ROW edge&#39;</span> <span class="o">%</span> <span class="n">B_l</span><span class="p">,</span>
                <span class="s1">&#39;Height Adjusted for </span><span class="si">%g</span><span class="s1"> mG at right ROW edge&#39;</span> <span class="o">%</span> <span class="n">B_r</span><span class="p">,</span>
                <span class="s1">&#39;Height Adjusted for </span><span class="si">%g</span><span class="s1"> kV/m at left ROW edge&#39;</span> <span class="o">%</span> <span class="n">E_l</span><span class="p">,</span>
                <span class="s1">&#39;Height Adjusted for </span><span class="si">%g</span><span class="s1"> kV/m at right ROW edge&#39;</span> <span class="o">%</span> <span class="n">E_r</span><span class="p">]</span>
    <span class="n">xs_tags</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Height Adjusted&#39;</span><span class="p">]</span><span class="o">*</span><span class="mi">4</span>
    <span class="k">for</span> <span class="n">s</span><span class="p">,</span> <span class="n">ti</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">sheets</span><span class="p">,</span> <span class="n">titles</span><span class="p">,</span> <span class="n">h</span><span class="p">,</span> <span class="n">xs_tags</span><span class="p">):</span>
        <span class="k">if</span><span class="p">(</span><span class="n">a</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">):</span>
            <span class="c1">#copy the input xs</span>
            <span class="n">new_xs</span> <span class="o">=</span> <span class="n">xs</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="c1">#change the identification fields</span>
            <span class="n">new_xs</span><span class="o">.</span><span class="n">sheet</span><span class="p">,</span> <span class="n">new_xs</span><span class="o">.</span><span class="n">title</span><span class="p">,</span> <span class="n">new_xs</span><span class="o">.</span><span class="n">tag</span> <span class="o">=</span> <span class="n">s</span><span class="p">,</span> <span class="n">ti</span><span class="p">,</span> <span class="n">t</span>
            <span class="c1">#adjust conductor heights</span>
            <span class="k">for</span> <span class="n">c_tag</span> <span class="ow">in</span> <span class="n">tags</span><span class="p">:</span>
                <span class="n">new_xs</span><span class="p">[</span><span class="n">c_tag</span><span class="p">]</span><span class="o">.</span><span class="n">y</span> <span class="o">+=</span> <span class="n">a</span>
            <span class="c1">#store new_xs in the SectionBook</span>
            <span class="n">adj</span><span class="o">.</span><span class="n">add_section</span><span class="p">(</span><span class="n">new_xs</span><span class="p">)</span>
    <span class="c1">#deal with saving</span>
    <span class="k">if</span><span class="p">(</span><span class="s1">&#39;path&#39;</span> <span class="ow">in</span> <span class="n">kw</span><span class="p">):</span>
        <span class="n">kw</span><span class="p">[</span><span class="s1">&#39;save&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">True</span>
    <span class="k">if</span><span class="p">(</span><span class="s1">&#39;save&#39;</span> <span class="ow">in</span> <span class="n">kw</span><span class="p">):</span>
        <span class="k">if</span><span class="p">(</span><span class="n">kw</span><span class="p">[</span><span class="s1">&#39;save&#39;</span><span class="p">]):</span>
            <span class="n">fn</span> <span class="o">=</span> <span class="n">_path_manage</span><span class="p">(</span><span class="n">fn</span> <span class="o">+</span> <span class="s1">&#39;_height_adjustments&#39;</span><span class="p">,</span> <span class="s1">&#39;xlsx&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">)</span>
            <span class="n">xl</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">ExcelWriter</span><span class="p">(</span><span class="n">fn</span><span class="p">,</span> <span class="n">engine</span><span class="o">=</span><span class="s1">&#39;xlsxwriter&#39;</span><span class="p">)</span>
            <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;Height Addition (ft)&#39;</span><span class="p">:</span> <span class="nb">list</span><span class="p">(</span><span class="n">h</span><span class="p">)},</span>
                    <span class="n">index</span><span class="o">=</span><span class="n">sheets</span><span class="p">)</span><span class="o">.</span><span class="n">to_excel</span><span class="p">(</span><span class="n">xl</span><span class="p">,</span> <span class="n">sheet_name</span><span class="o">=</span><span class="s1">&#39;Adjustments&#39;</span><span class="p">)</span>
            <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">([</span><span class="s1">&#39;Height - &#39;</span><span class="o">+</span><span class="n">s</span><span class="o">+</span><span class="s1">&#39; (ft)&#39;</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">adj</span><span class="o">.</span><span class="n">sheets</span><span class="p">],</span>
                    <span class="p">[[</span><span class="n">adj</span><span class="p">[</span><span class="n">s</span><span class="p">][</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">y</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">tags</span><span class="p">]</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">adj</span><span class="o">.</span><span class="n">sheets</span><span class="p">])),</span>
                    <span class="n">index</span><span class="o">=</span><span class="n">tags</span><span class="p">)</span><span class="o">.</span><span class="n">to_excel</span><span class="p">(</span><span class="n">xl</span><span class="p">,</span>
                            <span class="n">sheet_name</span><span class="o">=</span><span class="s1">&#39;Adjusted Conductor Heights&#39;</span><span class="p">,</span>
                            <span class="n">index_label</span><span class="o">=</span><span class="s1">&#39;Conductor Tag&#39;</span><span class="p">)</span>
            <span class="n">adj</span><span class="o">.</span><span class="n">ROW_edge_export</span><span class="p">(</span><span class="n">xl</span> <span class="o">=</span> <span class="n">xl</span><span class="p">)</span>
            <span class="n">df</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">h</span> <span class="o">=</span> <span class="n">_xs_sb_diff</span><span class="p">(</span><span class="n">xs</span><span class="p">,</span> <span class="n">adj</span><span class="p">)</span>
            <span class="n">df</span><span class="o">.</span><span class="n">to_excel</span><span class="p">(</span><span class="n">xl</span><span class="p">,</span> <span class="n">sheet_name</span><span class="o">=</span><span class="s1">&#39;ROW_edge_diff&#39;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
                    <span class="n">columns</span><span class="o">=</span><span class="n">c</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="n">h</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">xs</span> <span class="ow">in</span> <span class="n">adj</span><span class="p">:</span>
                <span class="n">xs</span><span class="o">.</span><span class="n">fields</span><span class="o">.</span><span class="n">to_excel</span><span class="p">(</span><span class="n">xl</span><span class="p">,</span> <span class="n">sheet_name</span><span class="o">=</span><span class="n">xs</span><span class="o">.</span><span class="n">sheet</span><span class="p">,</span>
                        <span class="n">index_label</span><span class="o">=</span><span class="s1">&#39;Distance (ft)&#39;</span><span class="p">)</span>
            <span class="n">xl</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
            <span class="k">print</span><span class="p">(</span><span class="s1">&#39;Optimal phasing results written to: </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">fn</span><span class="p">)</span>

    <span class="k">return</span><span class="p">(</span><span class="n">h</span><span class="p">,</span> <span class="n">adj</span><span class="p">)</span>
</pre></div>

                    </div>
                </div></div><div class="function" id="to_FLD"><p class="function-str"><span class="function-name">to_FLD</span>(<span class="function-arg">xs</span>, **<span class="function-arg">kw</span>)</p><p class="docstr">Create an FLD input file for FIELDS from a CrossSection object<br>&ensp;&ensp;&ensp;&ensp;args:<br>&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;xs - CrossSection object<br>&ensp;&ensp;&ensp;&ensp;kw:<br>&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;path - output file destination</p>
                <div class="source">
                    <h4 onclick="toggleSource(this)">show source</h4>
                    <div class="code">
                        <div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">to_FLD</span><span class="p">(</span><span class="n">xs</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Create an FLD input file for FIELDS from a CrossSection object</span>
<span class="sd">    args:</span>
<span class="sd">        xs - CrossSection object</span>
<span class="sd">    kw:</span>
<span class="sd">        path - output file destination&quot;&quot;&quot;</span>
    <span class="c1">#check input</span>
    <span class="k">if</span><span class="p">(</span><span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">xs</span><span class="p">,</span> <span class="n">fields_class</span><span class="o">.</span><span class="n">CrossSection</span><span class="p">)):</span>
        <span class="k">raise</span><span class="p">(</span><span class="n">fields_class</span><span class="o">.</span><span class="n">EMFError</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;Input argument to to_FLD() must be a</span>
<span class="s2">        CrossSection object, not an input of type: </span><span class="si">%s</span><span class="s2"> Use to_FLDs() for a</span>
<span class="s2">        SectionBook object.&quot;&quot;&quot;</span> <span class="o">%</span> <span class="nb">str</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">xs</span><span class="p">))))</span>
    <span class="c1">#get a filename</span>
    <span class="n">fn</span> <span class="o">=</span> <span class="n">fields_funks</span><span class="o">.</span><span class="n">_path_manage</span><span class="p">(</span><span class="n">xs</span><span class="o">.</span><span class="n">sheet</span><span class="p">,</span> <span class="s1">&#39;FLD&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">)</span>
    <span class="c1">#write the .FLD file</span>
    <span class="n">ofile</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">fn</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span>
    <span class="c1">#miscellaneous stuff first</span>
    <span class="n">_write_FLD_entries</span><span class="p">(</span><span class="n">ofile</span><span class="p">,</span> <span class="n">xs</span><span class="o">.</span><span class="n">sheet</span><span class="p">,</span> <span class="n">xs</span><span class="o">.</span><span class="n">title</span><span class="p">,</span> <span class="mi">60</span><span class="p">,</span> <span class="n">xs</span><span class="o">.</span><span class="n">soil_resistivity</span><span class="p">,</span>
            <span class="n">xs</span><span class="o">.</span><span class="n">max_dist</span><span class="p">,</span> <span class="n">xs</span><span class="o">.</span><span class="n">step</span><span class="p">,</span> <span class="n">xs</span><span class="o">.</span><span class="n">sample_height</span><span class="p">,</span> <span class="n">xs</span><span class="o">.</span><span class="n">lROW</span><span class="p">,</span> <span class="n">xs</span><span class="o">.</span><span class="n">rROW</span><span class="p">)</span>
    <span class="c1">#number of conductors and ground wires</span>
    <span class="n">Lconds</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">xs</span><span class="o">.</span><span class="n">hot</span><span class="p">)</span>
    <span class="n">_write_FLD_entries</span><span class="p">(</span><span class="n">ofile</span><span class="p">,</span> <span class="n">Lconds</span><span class="p">)</span>
    <span class="n">Lgrounds</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">xs</span><span class="o">.</span><span class="n">gnd</span><span class="p">)</span>
    <span class="n">_write_FLD_entries</span><span class="p">(</span><span class="n">ofile</span><span class="p">,</span> <span class="n">Lgrounds</span><span class="p">)</span>
    <span class="c1">#write the hot and gnd conductor data in the same format</span>
    <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">xs</span><span class="o">.</span><span class="n">hot</span> <span class="o">+</span> <span class="n">xs</span><span class="o">.</span><span class="n">gnd</span><span class="p">:</span>
        <span class="n">_write_FLD_entries</span><span class="p">(</span><span class="n">ofile</span><span class="p">,</span> <span class="n">c</span><span class="o">.</span><span class="n">tag</span><span class="p">,</span> <span class="n">c</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">c</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="n">c</span><span class="o">.</span><span class="n">subconds</span><span class="p">,</span> <span class="n">c</span><span class="o">.</span><span class="n">d_cond</span><span class="p">,</span> <span class="n">c</span><span class="o">.</span><span class="n">d_bund</span><span class="p">,</span>
                <span class="s1">&#39;ED!(I)&#39;</span><span class="p">,</span> <span class="n">c</span><span class="o">.</span><span class="n">I</span><span class="p">,</span> <span class="n">c</span><span class="o">.</span><span class="n">V</span><span class="p">,</span> <span class="n">c</span><span class="o">.</span><span class="n">phase</span><span class="p">)</span>
    <span class="c1">#write the ground wire data a second time, in a different format</span>
    <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">xs</span><span class="o">.</span><span class="n">gnd</span><span class="p">:</span>
        <span class="n">_write_FLD_entries</span><span class="p">(</span><span class="n">ofile</span><span class="p">,</span> <span class="n">c</span><span class="o">.</span><span class="n">tag</span><span class="p">,</span> <span class="n">c</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">c</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="n">c</span><span class="o">.</span><span class="n">d_cond</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
    <span class="c1">#close/save</span>
    <span class="n">ofile</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="k">print</span><span class="p">(</span><span class="s1">&#39;FLD file generated: </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">fn</span><span class="p">)</span>
</pre></div>

                    </div>
                </div></div><div class="function" id="to_FLDs"><p class="function-str"><span class="function-name">to_FLDs</span>(*<span class="function-arg">args</span>, **<span class="function-arg">kw</span>)</p><p class="docstr">Load or recieve a template workbook of CrossSections and convert them all to FLD files<br>&ensp;&ensp;&ensp;&ensp;args:<br>&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;can either be a path string to a target template workbook or an<br>&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;existing SectionBook object<br>&ensp;&ensp;&ensp;&ensp;kw:<br>&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;path - output destination for FLD files</p>
                <div class="source">
                    <h4 onclick="toggleSource(this)">show source</h4>
                    <div class="code">
                        <div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">to_FLDs</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Load or recieve a template workbook of CrossSections and convert them all to FLD files</span>
<span class="sd">    args:</span>
<span class="sd">        can either be a path string to a target template workbook or an</span>
<span class="sd">        existing SectionBook object</span>
<span class="sd">    kw:</span>
<span class="sd">        path - output destination for FLD files&quot;&quot;&quot;</span>
    <span class="k">if</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">==</span> <span class="nb">str</span><span class="p">):</span>
        <span class="c1">#load the template</span>
        <span class="n">sb</span> <span class="o">=</span> <span class="n">fields_funks</span><span class="o">.</span><span class="n">load_template</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="k">if</span><span class="p">(</span><span class="s1">&#39;path&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">kw</span><span class="p">):</span>
            <span class="n">kw</span><span class="p">[</span><span class="s1">&#39;path&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="k">elif</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">fields_class</span><span class="o">.</span><span class="n">SectionBook</span><span class="p">)):</span>
        <span class="n">sb</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span><span class="p">(</span><span class="n">fields_class</span><span class="o">.</span><span class="n">EMFError</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;Input argument to to_FLDs() must be a</span>
<span class="s2">        filepath or a SectionBook.&quot;&quot;&quot;</span><span class="p">))</span>
    <span class="c1">#check for duplicate sheets</span>
    <span class="n">sheets</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">xs</span> <span class="ow">in</span> <span class="n">sb</span><span class="p">:</span>
        <span class="k">if</span><span class="p">(</span><span class="n">xs</span><span class="o">.</span><span class="n">sheet</span> <span class="ow">in</span> <span class="n">sheets</span><span class="p">):</span>
            <span class="k">raise</span><span class="p">(</span><span class="n">fields_class</span><span class="o">.</span><span class="n">EMFError</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;Can&#39;t create FLD files because of</span>
<span class="s2">            duplicate CrossSection names. Name &quot;</span><span class="si">%s</span><span class="s2">&quot; is used at least twice.&quot;&quot;&quot;</span> <span class="o">%</span>
            <span class="n">xs</span><span class="o">.</span><span class="n">sheet</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">sheets</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">xs</span><span class="o">.</span><span class="n">sheet</span><span class="p">)</span>
    <span class="c1">#generate FLD files</span>
    <span class="k">for</span> <span class="n">xs</span> <span class="ow">in</span> <span class="n">sb</span><span class="p">:</span>
        <span class="n">to_FLD</span><span class="p">(</span><span class="n">xs</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">)</span>
</pre></div>

                    </div>
                </div></div><div class="function" id="to_FLDs_crawl"><p class="function-str"><span class="function-name">to_FLDs_crawl</span>(<span class="function-arg">dir_name</span>, **<span class="function-arg">kw</span>)</p><p class="docstr">crawl a directory and all of its subdirectories for excel workbooks that can be passed to create_FLDs(). The FLD files are generated in the same directory as the template book they come from.</p>
                <div class="source">
                    <h4 onclick="toggleSource(this)">show source</h4>
                    <div class="code">
                        <div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">to_FLDs_crawl</span><span class="p">(</span><span class="n">dir_name</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;crawl a directory and all of its subdirectories for excel workbooks that</span>
<span class="sd">    can be passed to create_FLDs(). The FLD files are generated in the same</span>
<span class="sd">    directory as the template book they come from.&quot;&quot;&quot;</span>

    <span class="c1">#get input directory&#39;s file and subdir names</span>
    <span class="n">dir_contents</span> <span class="o">=</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">dir_name</span><span class="p">)</span>

    <span class="c1">#loop over the dir_contents</span>
    <span class="k">for</span> <span class="n">dir_element</span> <span class="ow">in</span> <span class="n">dir_contents</span><span class="p">:</span>
        <span class="k">if</span><span class="p">(</span><span class="n">dir_element</span><span class="p">[</span><span class="o">-</span><span class="mi">5</span><span class="p">:]</span> <span class="o">==</span> <span class="s1">&#39;.xlsx&#39;</span><span class="p">):</span>
            <span class="c1">#operate on the file</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">to_FLDs</span><span class="p">(</span><span class="n">dir_element</span><span class="p">,</span> <span class="n">path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">dir_element</span><span class="p">))</span>
            <span class="k">except</span><span class="p">(</span><span class="ne">KeyError</span><span class="p">,</span> <span class="ne">ValueError</span><span class="p">,</span> <span class="ne">IOError</span><span class="p">,</span> <span class="n">fields_class</span><span class="o">.</span><span class="n">EMFError</span><span class="p">)</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="k">print</span><span class="p">(</span><span class="s1">&#39;failure to write FLD files from:</span><span class="se">\n\t</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">dir_element</span><span class="p">)</span>
                <span class="k">if</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">e</span><span class="p">)</span> <span class="ow">is</span> <span class="n">fields_class</span><span class="o">.</span><span class="n">EMFError</span><span class="p">):</span>
                    <span class="k">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n\t</span><span class="s1">Because of EMFError:&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1">#if the element is a subdirecory, crawl it</span>
            <span class="k">if</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">dir_element</span><span class="p">)):</span>
                <span class="n">to_FLDs_crawl</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dir_element</span><span class="p">,</span> <span class="s1">&#39;*&#39;</span><span class="p">))</span>
</pre></div>

                    </div>
                </div></div></div>

                <!--classes section-->
                <div class="section" id="classes"><h2>classes</h2><div class="class" id="Conductor"><h3>Conductor</h3><p class="docstr">A single power line object representing an infintely long conductor and storing basic physical parameters like the line's 2D coordinates, size, voltage, current, phase angle, etc. The Conductor class is the functional unit of emf.fields. Groups of Conductors are organized by higher level CrossSection objects to form complete 2D EMF models of parellel sets of power lines. CrossSection objects use the physical parameters stored in Conductor objects to compute predicted EMF values at a fixed height across a preset distance perpendicular to the power lines.</p><div class="function" ><p class="function-str"><span class="function-name">Conductor</span>(*<span class="function-arg">args</span>)</p><p class="docstr">args:<br>&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;tag - scalar hashable, mandatory, essentially just a name<br>&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;params - dict or list, available Conductor parameters are:<br><br>&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;x, y, subconds, d_cond, d_bund, V, I, phase<br><br>&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;A list can be passed with the values of any number of the above<br>&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;paremeters (in the order listed above) or a dict can be passed<br>&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;with any number of those parameter strings as keys.<br><br>&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;cond - an existing Conductor object, parameters that are not set<br>&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;with the second arg will be borrowed from the Conductor</p>
                <div class="source">
                    <h4 onclick="toggleSource(this)">show source</h4>
                    <div class="code">
                        <div class="highlight"><pre><span></span>    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        args:</span>
<span class="sd">            tag - scalar hashable, mandatory, essentially just a name</span>
<span class="sd">            params - dict or list, available Conductor parameters are:</span>

<span class="sd">                    x, y, subconds, d_cond, d_bund, V, I, phase</span>

<span class="sd">                A list can be passed with the values of any number of the above</span>
<span class="sd">                paremeters (in the order listed above) or a dict can be passed</span>
<span class="sd">                with any number of those parameter strings as keys.</span>

<span class="sd">            cond - an existing Conductor object, parameters that are not set</span>
<span class="sd">                    with the second arg will be borrowed from the Conductor&quot;&quot;&quot;</span>

        <span class="k">if</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">):</span>
            <span class="k">raise</span><span class="p">(</span><span class="n">EMFError</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;Conductor objects must be initialized with 1-3</span>
<span class="s2">            args, the first of which must be the Conductor &#39;tag&#39;. The second arg</span>
<span class="s2">            can be a dict or list setting the Conductor&#39;s paremeters. See the</span>
<span class="s2">            Conductor class doc string for more info on the second arg.&quot;&quot;&quot;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_tag</span> <span class="o">=</span> <span class="bp">None</span> <span class="c1">#conductor label</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_xs</span> <span class="o">=</span> <span class="bp">None</span> <span class="c1">#parent CrossSection object</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_freq</span> <span class="o">=</span> <span class="mf">60.0</span> <span class="c1">#phase frequency in Hertz</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_x</span> <span class="o">=</span> <span class="bp">None</span> <span class="c1">#x coordinate</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_y</span> <span class="o">=</span> <span class="bp">None</span> <span class="c1">#y coordinate</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_subconds</span> <span class="o">=</span> <span class="mi">1</span> <span class="c1">#number of subconductors per bundle</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_d_cond</span> <span class="o">=</span> <span class="bp">None</span> <span class="c1">#conductor diameter</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_d_bund</span> <span class="o">=</span> <span class="bp">None</span> <span class="c1">#bundle diameter</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_V</span> <span class="o">=</span> <span class="bp">None</span> <span class="c1">#line voltage</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_I</span> <span class="o">=</span> <span class="bp">None</span> <span class="c1">#line current</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_phase</span> <span class="o">=</span> <span class="bp">None</span> <span class="c1">#phase angle in degrees</span>
        <span class="c1">#set tag property</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tag</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="c1">#set other parameters</span>
        <span class="k">if</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">):</span>

            <span class="n">a</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">p</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="s1">&#39;subconds&#39;</span><span class="p">,</span> <span class="s1">&#39;d_cond&#39;</span><span class="p">,</span> <span class="s1">&#39;d_bund&#39;</span><span class="p">,</span> <span class="s1">&#39;V&#39;</span><span class="p">,</span> <span class="s1">&#39;I&#39;</span><span class="p">,</span> <span class="s1">&#39;phase&#39;</span><span class="p">]</span>

            <span class="k">if</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">list</span><span class="p">):</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">a</span><span class="p">)):</span>
                    <span class="k">exec</span><span class="p">(</span><span class="s1">&#39;self.</span><span class="si">%s</span><span class="s1"> = </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="nb">str</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">])))</span>
                <span class="n">p</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">:]</span>

            <span class="k">elif</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">dict</span><span class="p">):</span>
                <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">a</span><span class="p">:</span>
                    <span class="k">if</span><span class="p">(</span><span class="n">k</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">p</span><span class="p">):</span>
                        <span class="k">raise</span><span class="p">(</span><span class="n">EMFError</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;Unexpected dictionary key &quot;</span><span class="si">%s</span><span class="s2">&quot;</span>
<span class="s2">                        encountered in Conductor initialization.&quot;&quot;&quot;</span><span class="o">%</span> <span class="nb">str</span><span class="p">(</span><span class="n">k</span><span class="p">)))</span>
                    <span class="k">exec</span><span class="p">(</span><span class="s1">&#39;self.</span><span class="si">%s</span><span class="s1"> = </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="n">k</span><span class="p">])))</span>
                    <span class="n">p</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span><span class="p">(</span><span class="n">EMFError</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;The second argument to Conductor initialization</span>
<span class="s2">                must be a list or dict. See the Conductor class doc string for</span>
<span class="s2">                more info on the second arg.&quot;&quot;&quot;</span><span class="p">))</span>

        <span class="k">if</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">):</span>
            <span class="n">c</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
            <span class="k">if</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)):</span>
                <span class="k">raise</span><span class="p">(</span><span class="n">EMFError</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;The third argument must be an existing</span>
<span class="s2">                Conductor object from which all unset parameters in the newly</span>
<span class="s2">                created Conductor are copied.&quot;&quot;&quot;</span><span class="p">))</span>
            <span class="k">for</span> <span class="n">q</span> <span class="ow">in</span> <span class="n">p</span><span class="p">:</span>
                <span class="k">if</span><span class="p">(</span><span class="nb">eval</span><span class="p">(</span><span class="s1">&#39;c.</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">q</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">):</span>
                    <span class="k">exec</span><span class="p">(</span><span class="s1">&#39;self.</span><span class="si">%s</span><span class="s1"> = c.</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">q</span><span class="p">,</span> <span class="n">q</span><span class="p">))</span>
</pre></div>

                    </div>
                </div></div><div class="properties" id="Conductor-properties"><h4>Properties</h4><div class="property" id="Conductor-I"><p class="property-name">I</p><p class="docstr">Conductor phase current, not line current (Amps)</p></div><div class="property" id="Conductor-V"><p class="property-name">V</p><p class="docstr">Conductor phase voltage, not line voltage (kilovolts, kV)</p></div><div class="property" id="Conductor-complete"><p class="property-name">complete</p><p class="docstr">Check if all Conductor variables have been set<br>&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;returns:<br>&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;b - bool, True if all physical parameters are not None<br>&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;v - name of first unset parameter or None</p></div><div class="property" id="Conductor-d_bund"><p class="property-name">d_bund</p><p class="docstr">Diameter of the conductor bundle, defaults to d_cond if subconds == 1 (inches)</p></div><div class="property" id="Conductor-d_cond"><p class="property-name">d_cond</p><p class="docstr">Diameter of the conductor or a single subconductor if subconds > 1 (inches)</p></div><div class="property" id="Conductor-freq"><p class="property-name">freq</p><p class="docstr">Conductor frequency (Hz), cannot be set because Conductors in the same CrossSection are assumed to have equal frequencies, making the frequency irrelevant. This is a stand in value that does not currently affect EMF calculations in any way.</p></div><div class="property" id="Conductor-phase"><p class="property-name">phase</p><p class="docstr">Conductor phase angle (degrees)</p></div><div class="property" id="Conductor-subconds"><p class="property-name">subconds</p><p class="docstr">The number of subconductors in the conductor "bundle," defaults to 1 if left unset</p></div><div class="property" id="Conductor-tag"><p class="property-name">tag</p><p class="docstr">Conductor object identification, usually a string but can be anything hashable</p></div><div class="property" id="Conductor-x"><p class="property-name">x</p><p class="docstr">Conductor x coordinate (ft)</p></div><div class="property" id="Conductor-y"><p class="property-name">y</p><p class="docstr">Conductor y coordinate (ft)</p></div></div><div class="methods" id="Conductor-methods"><h4>Methods</h4><div class="function" id=Conductor-copy><p class="function-str"><span class="function-name">copy</span>()</p><p class="docstr">Return a deep copy of the Conductor object</p>
                <div class="source">
                    <h4 onclick="toggleSource(this)">show source</h4>
                    <div class="code">
                        <div class="highlight"><pre><span></span>    <span class="k">def</span> <span class="nf">copy</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s1">&#39;Return a deep copy of the Conductor object&#39;</span>
        <span class="k">return</span><span class="p">(</span><span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="p">))</span>
</pre></div>

                    </div>
                </div></div></div></div><div class="class" id="CrossSection"><h3>CrossSection</h3><p class="docstr">An object representing a single model of a set of parellel power lines. CrossSections are containers for Conductor objects, providing dict-like access to the Conductors by their 'tag' properties, which also store modeling information like the sampling locations and the horizontal locations of right-of-way (ROW) edges, which usually mark the edge of the utility company's property and the location of regulatory interest. CrossSections use the physical parameters stored in Conductor objects to compute predicted EMF values.</p><div class="function" ><p class="function-str"><span class="function-name">CrossSection</span>(<span class="function-arg">sheet</span>, *<span class="function-arg">args</span>)</p><p class="docstr">CrossSection must be initialized with a sheet string, and a list of Conductor objects can optionally be passed in in the second arg<br>&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;args:<br>&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;sheet - string, the name of the CrossSection<br>&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;conds - optional list of Conducor objects to copy into the xs</p>
                <div class="source">
                    <h4 onclick="toggleSource(this)">show source</h4>
                    <div class="code">
                        <div class="highlight"><pre><span></span>    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sheet</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;CrossSection must be initialized with a sheet string, and a list of</span>
<span class="sd">        Conductor objects can optionally be passed in in the second arg</span>
<span class="sd">        args:</span>
<span class="sd">            sheet - string, the name of the CrossSection</span>
<span class="sd">            conds - optional list of Conducor objects to copy into the xs&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_sheet</span> <span class="o">=</span> <span class="n">sheet</span> <span class="c1">#mandatory, short, template worksheet name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_tag</span> <span class="o">=</span> <span class="bp">None</span> <span class="c1">#identifier linking multiple CrossSection objects</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_title</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span> <span class="c1">#longer form, used for plotting text</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_sb</span> <span class="o">=</span> <span class="bp">None</span> <span class="c1">#parent SectionBook object</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">soil_resistivity</span> <span class="o">=</span> <span class="mf">100.0</span> <span class="c1">#?</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_max_dist</span> <span class="o">=</span> <span class="mf">100.0</span> <span class="c1">#maximum simulated distance from the ROW center</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_step</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="c1">#step size for calculations</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_sample_height</span> <span class="o">=</span> <span class="mf">3.0</span> <span class="c1">#uniform sample height</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_lROW</span> <span class="o">=</span> <span class="bp">None</span> <span class="c1">#exact coordinate of the left ROW edge</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_rROW</span> <span class="o">=</span> <span class="bp">None</span> <span class="c1">#exact coordinate of the left ROW edge</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_conds</span> <span class="o">=</span> <span class="p">[]</span> <span class="c1">#list of Conductor objects</span>
        <span class="c1">#dictionary mapping Conductor tags to Conductor objects</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_tag2idx</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
        <span class="c1">#integer indexer</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_i</span> <span class="o">=</span> <span class="n">_IntegerIndexer</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">conds</span><span class="p">)</span>
        <span class="c1">#DataFrame storing results, populated with _calculate_fields()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_fields</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="c1">#add conductors if they&#39;re passed in</span>
        <span class="k">if</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">add_conductor</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
</pre></div>

                    </div>
                </div></div><div class="properties" id="CrossSection-properties"><h4>Properties</h4><div class="property" id="CrossSection-I"><p class="property-name">I</p><p class="docstr">Generate an array of Conductor currents (Amps), in the same order as 'conds'</p></div><div class="property" id="CrossSection-ROW_edge_fields"><p class="property-name">ROW_edge_fields</p><p class="docstr">Slice the 'fields' DataFrame and return another DataFrame with only the results at the left and right right-of-way (ROW) edges, the locations of which are set in 'lROW' and 'rROW'.</p></div><div class="property" id="CrossSection-V"><p class="property-name">V</p><p class="docstr">Generate an array of Conductor voltages (kilovolts, kV), in the same order as 'conds'</p></div><div class="property" id="CrossSection-complete"><p class="property-name">complete</p><p class="docstr">Check that all variables in each conductor in the CrossSection are set, and not left with the initial None values.<br>&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;returns:<br>&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;b - True if all Conductors are complete, False if not<br>&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;t - tag of first incomplete Conductor, if any, else None<br>&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;v - variable name of first unset variable in first incomplete Conductor, if any, else None</p></div><div class="property" id="CrossSection-conds"><p class="property-name">conds</p><p class="docstr">List of Conductor objects added to the CrossSection. Do not modify it directly, but use the CrossSection methods add_conductor() and remove_conductor() to manage which Conductor objects are in a CrossSection.</p></div><div class="property" id="CrossSection-d_bund"><p class="property-name">d_bund</p><p class="docstr">Generate an array of Conductor bundle diameters (inches, see Conductor.d_bund), in the same order as 'conds'</p></div><div class="property" id="CrossSection-d_cond"><p class="property-name">d_cond</p><p class="docstr">Generate an array of Conductor diameters (inches, see Conductor.d_cond), in the same order as 'conds'</p></div><div class="property" id="CrossSection-fields"><p class="property-name">fields</p><p class="docstr">A pandas DataFrame of magnetic and electric field results at the points defined by 'x_sample' and 'y_sample'. The results are calculated and stored upon the first reference to this property. If Conductor objects in the CrossSection are modified in relevant ways, the results are cleared and recalculated when 'fields' is next accessed. All updating/refreshing is done automatically. The DataFrame of results is indexed by the values in 'x_sample' and has the following columns 'Ex', 'Ey', 'Eprod', 'Emax', 'Bx', 'By', 'Bprod', and 'Bmax.' The columns correspond to different components of the electric and magnetic fields (see emf.fields.phasors_to_magnitudes()). The electric fields are reported in units of kV/m and the magnetic fields are reported in units of mG (milliGauss).</p></div><div class="property" id="CrossSection-freq"><p class="property-name">freq</p><p class="docstr">Generate an array of Conductor frequencies, in the same order as 'conds'</p></div><div class="property" id="CrossSection-gnd"><p class="property-name">gnd</p><p class="docstr">Return a list of the grounded (zero voltage) Conductor objects in the CrossSection</p></div><div class="property" id="CrossSection-hot"><p class="property-name">hot</p><p class="docstr">Return a list of the hot (nonzero voltage) Conductor objects in the CrossSection</p></div><div class="property" id="CrossSection-i"><p class="property-name">i</p><p class="docstr">Use CrossSection.i[] to retrieve Conductor objects by the integer order in which they were added to the CrossSection. For example, CrossSection.i[0] gets the first Conductor added, CrossSection.i[4] gets the fifth one added, etc.</p></div><div class="property" id="CrossSection-lROW"><p class="property-name">lROW</p><p class="docstr">Horizontal location of the left (negative x) edge of the right-of-way (ROW), a point of interest on the left side of the model (ft)</p></div><div class="property" id="CrossSection-max_dist"><p class="property-name">max_dist</p><p class="docstr">Maximum horizontal distance of sample points for EMF calculations (ft), default is 100. Resolution is controlled by the 'step' property.</p></div><div class="property" id="CrossSection-phase"><p class="property-name">phase</p><p class="docstr">Generate an array of Conductor phase angles (degrees), in the same order as 'conds'</p></div><div class="property" id="CrossSection-rROW"><p class="property-name">rROW</p><p class="docstr">Horizontal location of the right (positive x) edge of the right-of-way (ROW), a point of interest on the left side of the model (ft)</p></div><div class="property" id="CrossSection-sample_height"><p class="property-name">sample_height</p><p class="docstr">Height of all sample points (ft), default is 3</p></div><div class="property" id="CrossSection-sheet"><p class="property-name">sheet</p><p class="docstr">The principle identification variable of a CrossSection, should be a string briefly identifying the object. CrossSections are retrieved from SectionBook objects by their sheet strings.</p></div><div class="property" id="CrossSection-step"><p class="property-name">step</p><p class="docstr">Horizontal distance between sample points for EMF calculations (ft), default is 1</p></div><div class="property" id="CrossSection-subconds"><p class="property-name">subconds</p><p class="docstr">Generate an array of Conductor subconductor counts (see Conductor.subconds), in the same order as 'conds'</p></div><div class="property" id="CrossSection-tag"><p class="property-name">tag</p><p class="docstr">Very short variable used to group CrossSections in SectionBooks. CrossSection objects in SectionBooks that have the same tag properties are grouped for functions that involve comparisons.</p></div><div class="property" id="CrossSection-tags"><p class="property-name">tags</p><p class="docstr">Return a list of the tags of Conductors in the CrossSection, in the order in which the Conductors were added</p></div><div class="property" id="CrossSection-title"><p class="property-name">title</p><p class="docstr">Longer form identification string, used in plot titles and such</p></div><div class="property" id="CrossSection-x"><p class="property-name">x</p><p class="docstr">Generate an array of Conductor x coordinates (ft), in the same order as 'conds'</p></div><div class="property" id="CrossSection-x_sample"><p class="property-name">x_sample</p><p class="docstr">Compute an array of horizontal coordinates (ft) for EMF calculations, based on 'max_dist' and 'step'. The left and right ROW edge locations ('lROW' and 'rROW') are always included in the returned array.</p></div><div class="property" id="CrossSection-y"><p class="property-name">y</p><p class="docstr">Generate an array of Conductor y coordinate (ft)s, in the same order as 'conds'</p></div><div class="property" id="CrossSection-y_sample"><p class="property-name">y_sample</p><p class="docstr">Return an array the same length as 'x_sample' with all values equal to 'sample_height'</p></div></div><div class="methods" id="CrossSection-methods"><h4>Methods</h4><div class="function" id=CrossSection-add_conductor><p class="function-str"><span class="function-name">add_conductor</span>(<span class="function-arg">cond</span>)</p><p class="docstr">Add a copy of a Conductor object to the CrossSection, which can be accessed by indexing the CrossSection like a dictionary, using the Conductor's 'tag' attribute.<br>&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;args:<br>&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;cond - Conductor object to add</p>
                <div class="source">
                    <h4 onclick="toggleSource(this)">show source</h4>
                    <div class="code">
                        <div class="highlight"><pre><span></span>    <span class="k">def</span> <span class="nf">add_conductor</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cond</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Add a copy of a Conductor object to the CrossSection, which can be</span>
<span class="sd">        accessed by indexing the CrossSection like a dictionary, using the</span>
<span class="sd">        Conductor&#39;s &#39;tag&#39; attribute.</span>
<span class="sd">        args:</span>
<span class="sd">            cond - Conductor object to add&quot;&quot;&quot;</span>
        <span class="c1">#check if the Conductor is complete</span>
        <span class="n">b</span><span class="p">,</span> <span class="n">v</span> <span class="o">=</span> <span class="n">cond</span><span class="o">.</span><span class="n">complete</span>
        <span class="k">if</span><span class="p">(</span><span class="ow">not</span> <span class="n">b</span><span class="p">):</span>
            <span class="k">raise</span><span class="p">(</span><span class="n">EMFError</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;Cannot add Conductor &quot;</span><span class="si">%s</span><span class="s2">&quot; to the CrossSection</span>
<span class="s2">            because it is not complete. The parameter &quot;</span><span class="si">%s</span><span class="s2">&quot; is not set.&quot;&quot;&quot;</span>
            <span class="o">%</span> <span class="p">(</span><span class="n">cond</span><span class="o">.</span><span class="n">tag</span><span class="p">,</span> <span class="n">v</span><span class="p">[</span><span class="mi">1</span><span class="p">:])))</span>
        <span class="c1">#check if the tag has already been used</span>
        <span class="k">if</span><span class="p">(</span><span class="n">cond</span><span class="o">.</span><span class="n">tag</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tag2idx</span><span class="p">):</span>
            <span class="k">raise</span><span class="p">(</span><span class="n">EMFError</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;A Conductor with tag &quot;</span><span class="si">%s</span><span class="s2">&quot; is already in</span>
<span class="s2">            CrossSection &quot;</span><span class="si">%s</span><span class="s2">&quot;. Another Conductor with the same tag cannot be</span>
<span class="s2">            added&quot;&quot;&quot;</span>
            <span class="o">%</span> <span class="p">(</span><span class="n">cond</span><span class="o">.</span><span class="n">tag</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">sheet</span><span class="p">)))</span>
        <span class="c1">#see if the conductor is grounded</span>
        <span class="k">if</span><span class="p">(</span><span class="n">cond</span><span class="o">.</span><span class="n">V</span> <span class="o">==</span> <span class="mi">0</span><span class="p">):</span>
            <span class="c1">#probably shouldn&#39;t have current if grounded</span>
            <span class="k">if</span><span class="p">(</span><span class="n">cond</span><span class="o">.</span><span class="n">I</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">):</span>
                <span class="k">print</span> <span class="n">cond</span><span class="o">.</span><span class="n">I</span>
                <span class="k">print</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;Conductor with tag &quot;</span><span class="si">%s</span><span class="s2">&quot; in CrossSection &quot;</span><span class="si">%s</span><span class="s2">&quot; is grounded</span>
<span class="s2">                (V = 0) but has nonzero current?&quot;&quot;&quot;</span>
                <span class="o">%</span> <span class="p">(</span><span class="n">cond</span><span class="o">.</span><span class="n">tag</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">sheet</span><span class="p">))</span>
        <span class="c1">#add to self.conds and indexing dict</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_tag2idx</span><span class="p">[</span><span class="n">cond</span><span class="o">.</span><span class="n">tag</span><span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">conds</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">conds</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">cond</span><span class="p">))</span>
        <span class="c1">#associate xs with the conductor</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">conds</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">_xs</span> <span class="o">=</span> <span class="bp">self</span>
</pre></div>

                    </div>
                </div></div><div class="function" id=CrossSection-compare_DAT><p class="function-str"><span class="function-name">compare_DAT</span>(<span class="function-arg">DAT_path</span>, **<span class="function-arg">kw</span>)</p><p class="docstr">Load a FIELDS output file (.DAT) to calculate absolute and percentage differences between it and the CrossSection object's results. The results in the DAT file must be sampled at the same x coordinates as those in the CrossSection. A panel of comparison results is returned. If the 'save' or 'path' keywords are used, the comparison results will be saved with plots demonstrating the comparisons.<br>&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;args:<br>&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;DAT_path - path of FIELDS results file<br>&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;kw:<br>&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;save - bool, toggle whether output Panel and figures are saved,<br>&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;also saves figures with error and comparison plots<br>&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;path - string, destination of saved files, will force save == True<br>&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;round - int, round the results in self.fields to a certain number<br>&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;of digits in an attempt to exactly match the FIELDS results, which are printed only to the<br>&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;thousandths digit<br>&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;truncate - bool, truncate results after the thousandths digit<br>&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;returns:<br>&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;pan - pandas Panel with DAT results, results of this code,<br>&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;the absolute error between, and the relative error between</p>
                <div class="source">
                    <h4 onclick="toggleSource(this)">show source</h4>
                    <div class="code">
                        <div class="highlight"><pre><span></span>    <span class="k">def</span> <span class="nf">compare_DAT</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">DAT_path</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Load a FIELDS output file (.DAT) to calculate absolute and percentage</span>
<span class="sd">        differences between it and the CrossSection object&#39;s results. The results</span>
<span class="sd">        in the DAT file must be sampled at the same x coordinates as those in the</span>
<span class="sd">        CrossSection. A panel of comparison results is returned. If the &#39;save&#39; or</span>
<span class="sd">        &#39;path&#39; keywords are used, the comparison results will be saved with plots</span>
<span class="sd">        demonstrating the comparisons.</span>
<span class="sd">        args:</span>
<span class="sd">            DAT_path - path of FIELDS results file</span>
<span class="sd">        kw:</span>
<span class="sd">            save - bool, toggle whether output Panel and figures are saved,</span>
<span class="sd">                    also saves figures with error and comparison plots</span>
<span class="sd">            path - string, destination of saved files, will force save == True</span>
<span class="sd">            round - int, round the results in self.fields to a certain number</span>
<span class="sd">                    of digits in an attempt to exactly match the FIELDS results,</span>
<span class="sd">                    which are printed only to the</span>
<span class="sd">                    thousandths digit</span>
<span class="sd">            truncate - bool, truncate results after the thousandths digit</span>
<span class="sd">        returns:</span>
<span class="sd">            pan - pandas Panel with DAT results, results of this code,</span>
<span class="sd">                the absolute error between, and the relative error between&quot;&quot;&quot;</span>
        <span class="c1">#load the .DAT file into a dataframe</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">FIELDS_io</span><span class="o">.</span><span class="n">read_DAT</span><span class="p">(</span><span class="n">DAT_path</span><span class="p">)</span>
        <span class="c1">#check dataframe shape compatibility</span>
        <span class="k">if</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">shape</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fields</span><span class="o">.</span><span class="n">shape</span><span class="p">):</span>
            <span class="k">raise</span><span class="p">(</span><span class="n">EMFError</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;self.fields in CrossSection named &quot;</span><span class="si">%s</span><span class="s2">&quot; and the</span>
<span class="s2">            imported .DAT DataFrame have different shapes. Be sure to target the</span>
<span class="s2">            correct .DAT file and that it has compatible DIST values.&quot;&quot;&quot;</span> <span class="o">%</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sheet</span><span class="p">))</span>
        <span class="c1">#prepare a dictionary to create a Panel</span>
        <span class="k">if</span><span class="p">((</span><span class="s1">&#39;round&#39;</span> <span class="ow">in</span> <span class="n">kw</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="s1">&#39;truncate&#39;</span> <span class="ow">in</span> <span class="n">kw</span><span class="p">)):</span>
            <span class="k">raise</span><span class="p">(</span><span class="n">FLDError</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;Cannot both round and truncate for DAT comparison.</span>
<span class="s2">            Choose either rounding or truncation.&quot;&quot;&quot;</span><span class="p">))</span>
        <span class="k">elif</span><span class="p">(</span><span class="s1">&#39;round&#39;</span> <span class="ow">in</span> <span class="n">kw</span><span class="p">):</span>
            <span class="n">f</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fields</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">kw</span><span class="p">[</span><span class="s1">&#39;round&#39;</span><span class="p">])</span>
        <span class="k">elif</span><span class="p">(</span><span class="s1">&#39;truncate&#39;</span> <span class="ow">in</span> <span class="n">kw</span><span class="p">):</span>
            <span class="k">if</span><span class="p">(</span><span class="n">kw</span><span class="p">[</span><span class="s1">&#39;truncate&#39;</span><span class="p">]):</span>
                <span class="n">f</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fields</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">deep</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">f</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">f</span><span class="o">.</span><span class="n">index</span><span class="p">:</span>
                        <span class="n">f</span><span class="p">[</span><span class="n">c</span><span class="p">]</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%.3f</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">f</span><span class="p">[</span><span class="n">c</span><span class="p">]</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">f</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fields</span>
        <span class="n">frames</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;FIELDS_DAT_results&#39;</span><span class="p">,</span> <span class="s1">&#39;python_results&#39;</span><span class="p">,</span>
                <span class="s1">&#39;Absolute Difference&#39;</span><span class="p">,</span> <span class="s1">&#39;Percent Difference&#39;</span><span class="p">]</span>
        <span class="n">pan</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Panel</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="p">{</span><span class="n">frames</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="p">:</span> <span class="n">df</span><span class="p">,</span>
                <span class="n">frames</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span> <span class="n">f</span><span class="p">,</span>
                <span class="n">frames</span><span class="p">[</span><span class="mi">2</span><span class="p">]:</span> <span class="n">f</span> <span class="o">-</span> <span class="n">df</span><span class="p">,</span>
                <span class="n">frames</span><span class="p">[</span><span class="mi">3</span><span class="p">]:</span> <span class="mi">100</span><span class="o">*</span><span class="p">(</span><span class="n">f</span> <span class="o">-</span> <span class="n">df</span><span class="p">)</span><span class="o">/</span><span class="n">f</span><span class="p">})</span>
        <span class="c1">#write data and save figures if called for</span>
        <span class="k">if</span><span class="p">(</span><span class="s1">&#39;path&#39;</span> <span class="ow">in</span> <span class="n">kw</span><span class="p">):</span>
            <span class="n">kw</span><span class="p">[</span><span class="s1">&#39;save&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="k">if</span><span class="p">(</span><span class="s1">&#39;save&#39;</span> <span class="ow">in</span> <span class="n">kw</span><span class="p">):</span>
            <span class="k">if</span><span class="p">(</span><span class="n">kw</span><span class="p">[</span><span class="s1">&#39;save&#39;</span><span class="p">]):</span>
                <span class="n">fn</span> <span class="o">=</span> <span class="n">fields_funks</span><span class="o">.</span><span class="n">_path_manage</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sheet</span> <span class="o">+</span> <span class="s1">&#39;-DAT_comparison&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;.xlsx&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">)</span>
                <span class="n">xl</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">ExcelWriter</span><span class="p">(</span><span class="n">fn</span><span class="p">,</span> <span class="n">engine</span><span class="o">=</span><span class="s1">&#39;xlsxwriter&#39;</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">frames</span><span class="p">:</span>
                    <span class="n">pan</span><span class="p">[</span><span class="n">f</span><span class="p">]</span><span class="o">.</span><span class="n">to_excel</span><span class="p">(</span><span class="n">xl</span><span class="p">,</span> <span class="n">index_label</span><span class="o">=</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="n">sheet_name</span><span class="o">=</span><span class="n">f</span><span class="p">)</span>
                <span class="n">xl</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
                <span class="k">print</span><span class="p">(</span><span class="s1">&#39;DAT comparison book saved to: &quot;</span><span class="si">%s</span><span class="s1">&quot;&#39;</span> <span class="o">%</span> <span class="n">fn</span><span class="p">)</span>
                <span class="c1">#make plots of the absolute and percent error</span>
                <span class="n">figs</span> <span class="o">=</span> <span class="n">fields_plots</span><span class="o">.</span><span class="n">_plot_DAT_comparison</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pan</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">)</span>
        <span class="c1">#return the Panel</span>
        <span class="k">return</span><span class="p">(</span><span class="n">pan</span><span class="p">)</span>
</pre></div>

                    </div>
                </div></div><div class="function" id=CrossSection-copy><p class="function-str"><span class="function-name">copy</span>()</p><p class="docstr">Return a deep copy of the CrossSection object</p>
                <div class="source">
                    <h4 onclick="toggleSource(this)">show source</h4>
                    <div class="code">
                        <div class="highlight"><pre><span></span>    <span class="k">def</span> <span class="nf">copy</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return a deep copy of the CrossSection object&quot;&quot;&quot;</span>
        <span class="k">return</span><span class="p">(</span><span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="p">))</span>
</pre></div>

                    </div>
                </div></div><div class="function" id=CrossSection-export><p class="function-str"><span class="function-name">export</span>(**<span class="function-arg">kw</span>)</p><p class="docstr">Write the 'fields' DataFrame to a csv<br>&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;kw:<br>&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;path - string, destination/filename for saved file</p>
                <div class="source">
                    <h4 onclick="toggleSource(this)">show source</h4>
                    <div class="code">
                        <div class="highlight"><pre><span></span>    <span class="k">def</span> <span class="nf">export</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Write the &#39;fields&#39; DataFrame to a csv</span>
<span class="sd">        kw:</span>
<span class="sd">            path - string, destination/filename for saved file&quot;&quot;&quot;</span>
        <span class="c1">#path management</span>
        <span class="n">fn</span> <span class="o">=</span> <span class="n">fields_funks</span><span class="o">.</span><span class="n">_path_manage</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sheet</span> <span class="o">+</span> <span class="s1">&#39;-all_results&#39;</span><span class="p">,</span> <span class="s1">&#39;.csv&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">)</span>
        <span class="c1">#write results</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fields</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">fn</span><span class="p">,</span> <span class="n">index_label</span><span class="o">=</span><span class="s1">&#39;Distance (ft)&#39;</span><span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="s1">&#39;Cross section fields written to: </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">fn</span><span class="p">)</span>
</pre></div>

                    </div>
                </div></div><div class="function" id=CrossSection-remove_conductor><p class="function-str"><span class="function-name">remove_conductor</span>(<span class="function-arg">key</span>)</p><p class="docstr">Remove a Conductor object from the CrossSection<br>&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;args:<br>&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;key - Conductor tag or Conductor object to remove</p>
                <div class="source">
                    <h4 onclick="toggleSource(this)">show source</h4>
                    <div class="code">
                        <div class="highlight"><pre><span></span>    <span class="k">def</span> <span class="nf">remove_conductor</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Remove a Conductor object from the CrossSection</span>
<span class="sd">        args:</span>
<span class="sd">            key - Conductor tag or Conductor object to remove&quot;&quot;&quot;</span>
        <span class="c1">#check input</span>
        <span class="k">if</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">key</span><span class="p">)</span> <span class="ow">is</span> <span class="n">Conductor</span><span class="p">):</span>
            <span class="n">key</span> <span class="o">=</span> <span class="n">key</span><span class="o">.</span><span class="n">tag</span>
        <span class="c1">#check in the hot dict</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">idx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tag2idx</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
        <span class="k">except</span><span class="p">(</span><span class="ne">KeyError</span><span class="p">):</span>
            <span class="k">pass</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">conds</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">_xs</span> <span class="o">=</span> <span class="bp">None</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">conds</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">idx</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_update_tag2idx</span><span class="p">()</span>
</pre></div>

                    </div>
                </div></div><div class="function" id=CrossSection-sample><p class="function-str"><span class="function-name">sample</span>(*<span class="function-arg">args</span>)</p><p class="docstr">Get a random Conductor  or a list of random Conductors from the CrossSection<br>&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;args:<br>&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;an input integer determines the number of random xss fetched,<br>&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;which might not be unique</p>
                <div class="source">
                    <h4 onclick="toggleSource(this)">show source</h4>
                    <div class="code">
                        <div class="highlight"><pre><span></span>    <span class="k">def</span> <span class="nf">sample</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Get a random Conductor  or a list of random Conductors from the CrossSection</span>
<span class="sd">        args:</span>
<span class="sd">            an input integer determines the number of random xss fetched,</span>
<span class="sd">            which might not be unique&quot;&quot;&quot;</span>
        <span class="n">c</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">conds</span>
        <span class="k">if</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">):</span>
            <span class="k">return</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">conds</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">c</span><span class="p">))])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">r</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">c</span><span class="p">),</span> <span class="n">size</span><span class="o">=</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="k">return</span><span class="p">([</span><span class="n">c</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">r</span><span class="p">])</span>
</pre></div>

                    </div>
                </div></div></div></div><div class="class" id="SectionBook"><h3>SectionBook</h3><p class="docstr">A top level class organizing a group of CrossSection objects. It provides dict-like access to child CrossSection objects by their 'sheet' properties. It also maintains a table of maximum field results at the ROW edges of each CrossSection added (the ROW_edge_max property), provides exporting methods, and can be passed to plotting functions to generate plots comparing groups of CrossSections. CrossSections in a SectionBook are grouped by their 'tag' properties. Those with identical tags are automatically grouped.</p><div class="function" ><p class="function-str"><span class="function-name">SectionBook</span>(<span class="function-arg">name</span>, *<span class="function-arg">args</span>)</p><p class="docstr">SectionBooks must be initialized with a name string, with the option to pass a list of CrossSection objects in the second arg that will be copied into the new object<br>&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;args:<br>&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;name - string, name of SectionBook<br>&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;xs - list of CrossSection objects to copy into the SectionBook</p>
                <div class="source">
                    <h4 onclick="toggleSource(this)">show source</h4>
                    <div class="code">
                        <div class="highlight"><pre><span></span>    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;SectionBooks must be initialized with a name string, with the option</span>
<span class="sd">        to pass a list of CrossSection objects in the second arg that will be</span>
<span class="sd">        copied into the new object</span>
<span class="sd">        args:</span>
<span class="sd">            name - string, name of SectionBook</span>
<span class="sd">            xs - list of CrossSection objects to copy into the SectionBook&quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_name</span> <span class="o">=</span> <span class="n">name</span> <span class="c1">#mandatory identification field</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_xss</span> <span class="o">=</span> <span class="p">[]</span> <span class="c1">#list of cross section objects</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_sheet2idx</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span> <span class="c1">#for CrossSection retrieval</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_i</span> <span class="o">=</span> <span class="n">_IntegerIndexer</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">xss</span><span class="p">)</span>
        <span class="c1">#add CrossSections if they&#39;re passed in</span>
        <span class="k">if</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">xs</span> <span class="ow">in</span> <span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">add_section</span><span class="p">(</span><span class="n">xs</span><span class="p">)</span>
</pre></div>

                    </div>
                </div></div><div class="properties" id="SectionBook-properties"><h4>Properties</h4><div class="property" id="SectionBook-ROW_edge_max"><p class="property-name">ROW_edge_max</p><p class="docstr">DataFrame with maximum field magnitudes at the right-of-way (ROW) edges of each CrossSection in the SectionBook. The DataFrame is indexed by the CrossSection sheet strings, and has columns 'Bmaxl', 'Bmaxr', 'Emaxl', 'Emaxr'.</p></div><div class="property" id="SectionBook-complete"><p class="property-name">complete</p><p class="docstr">Check that all CrossSections in the SectionBook are complete<br>&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;returns:<br>&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;b - True if all xcs are complete, False if not<br>&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;sheet - sheet of first incomplete xs, if any, else None<br>&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;ctag - tag of first incomplete Conductor in first incomplete xs,<br>&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;if any, else None<br>&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;v - variable name of first unset variable in first incomplete<br>&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;Conductor in first incomplete xs, if any, else None</p></div><div class="property" id="SectionBook-i"><p class="property-name">i</p><p class="docstr">Use SectionBook.i[] to retrieve CrossSection objects by the integer order in which they were added to the SectionBook. For example, SectionBook.i[0] gets the first CrossSection added, SectionBook.i[4] gets the fifth one added, etc.</p></div><div class="property" id="SectionBook-name"><p class="property-name">name</p><p class="docstr">Mandatory string identifying the SectionBook object</p></div><div class="property" id="SectionBook-sheets"><p class="property-name">sheets</p><p class="docstr">A list of CrossSection sheet strings, in the same order as 'xss'</p></div><div class="property" id="SectionBook-tag_groups"><p class="property-name">tag_groups</p><p class="docstr">A list of lists of grouped CrossSection objects</p></div><div class="property" id="SectionBook-tags"><p class="property-name">tags</p><p class="docstr">A set of unique CrossSection tags</p></div><div class="property" id="SectionBook-titles"><p class="property-name">titles</p><p class="docstr">A list of CrossSection titles, in the same order as 'xss'</p></div><div class="property" id="SectionBook-xss"><p class="property-name">xss</p><p class="docstr">List of CrossSection objects added to the SectionBook. Should not be edited directly, but with SectionBook.add_section() and SectionBook.remove_section().</p></div></div><div class="methods" id="SectionBook-methods"><h4>Methods</h4><div class="function" id=SectionBook-ROW_edge_export><p class="function-str"><span class="function-name">ROW_edge_export</span>(**<span class="function-arg">kw</span>)</p><p class="docstr">Write max field results at ROW edges for each cross section to an excel or csv file. Default is csv.<br>&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;kw:<br>&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;file_type - string, accepts 'csv' or 'excel' (default csv)<br>&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;path - string, destination/filename for saved file<br>&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;xl - pandas ExcelWriter object, takes precedence over 'path'</p>
                <div class="source">
                    <h4 onclick="toggleSource(this)">show source</h4>
                    <div class="code">
                        <div class="highlight"><pre><span></span>    <span class="k">def</span> <span class="nf">ROW_edge_export</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Write max field results at ROW edges for each cross section to an</span>
<span class="sd">        excel or csv file. Default is csv.</span>
<span class="sd">        kw:</span>
<span class="sd">            file_type - string, accepts &#39;csv&#39; or &#39;excel&#39; (default csv)</span>
<span class="sd">            path - string, destination/filename for saved file</span>
<span class="sd">            xl - pandas ExcelWriter object, takes precedence over &#39;path&#39;&quot;&quot;&quot;</span>
        <span class="c1">#be sure ROW_edge_results are current</span>
        <span class="c1">#self.compile_ROW_edge_results()</span>
        <span class="c1">#export</span>
        <span class="n">c</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Bmaxl&#39;</span><span class="p">,</span><span class="s1">&#39;Bmaxr&#39;</span><span class="p">,</span><span class="s1">&#39;Emaxl&#39;</span><span class="p">,</span><span class="s1">&#39;Emaxr&#39;</span><span class="p">]</span>
        <span class="n">h</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Bmax - Left ROW Edge&#39;</span><span class="p">,</span> <span class="s1">&#39;Bmax - Right ROW Edge&#39;</span><span class="p">,</span>
            <span class="s1">&#39;Emax - Left ROW Edge&#39;</span><span class="p">,</span> <span class="s1">&#39;Emax - Right ROW Edge&#39;</span><span class="p">]</span>
        <span class="n">wo</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="k">if</span><span class="p">(</span><span class="s1">&#39;xl&#39;</span> <span class="ow">in</span> <span class="n">kw</span><span class="p">):</span>
            <span class="n">wo</span> <span class="o">=</span> <span class="n">kw</span><span class="p">[</span><span class="s1">&#39;xl&#39;</span><span class="p">]</span>
        <span class="k">elif</span><span class="p">(</span><span class="s1">&#39;file_type&#39;</span> <span class="ow">in</span> <span class="n">kw</span><span class="p">):</span>
            <span class="n">file_type</span> <span class="o">=</span> <span class="n">kw</span><span class="p">[</span><span class="s1">&#39;file_type&#39;</span><span class="p">]</span>
            <span class="k">if</span><span class="p">(</span><span class="n">file_type</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;.&#39;</span><span class="p">):</span>
                <span class="n">file_type</span> <span class="o">=</span> <span class="n">file_type</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
            <span class="k">if</span><span class="p">(</span><span class="n">file_type</span> <span class="o">==</span> <span class="s1">&#39;excel&#39;</span><span class="p">):</span>
                <span class="n">wo</span> <span class="o">=</span> <span class="n">fields_funks</span><span class="o">.</span><span class="n">_path_manage</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="s1">&#39;-ROW_edge_results&#39;</span><span class="p">,</span>
                        <span class="s1">&#39;.xlsx&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">)</span>
        <span class="k">if</span><span class="p">(</span><span class="n">wo</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ROW_edge_max</span><span class="o">.</span><span class="n">to_excel</span><span class="p">(</span><span class="n">wo</span><span class="p">,</span> <span class="n">index_label</span><span class="o">=</span><span class="s1">&#39;Sheet&#39;</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="n">c</span><span class="p">,</span>
                                    <span class="n">header</span><span class="o">=</span><span class="n">h</span><span class="p">,</span> <span class="n">sheet_name</span><span class="o">=</span><span class="s1">&#39;ROW_edge_max&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">wo</span> <span class="o">=</span> <span class="n">fields_funks</span><span class="o">.</span><span class="n">_path_manage</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="s1">&#39;-ROW_edge_results&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;.csv&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ROW_edge_max</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">wo</span><span class="p">,</span> <span class="n">index_label</span><span class="o">=</span><span class="s1">&#39;Sheet&#39;</span><span class="p">,</span>
                    <span class="n">columns</span><span class="o">=</span><span class="n">c</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="n">h</span><span class="p">)</span>
        <span class="k">if</span><span class="p">(</span><span class="ow">not</span> <span class="p">(</span><span class="s1">&#39;xl&#39;</span> <span class="ow">in</span> <span class="n">kw</span><span class="p">)):</span>
            <span class="k">print</span><span class="p">(</span><span class="s1">&#39;Maximum fields at ROW edges written to: </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">wo</span><span class="p">)</span>
</pre></div>

                    </div>
                </div></div><div class="function" id=SectionBook-add_section><p class="function-str"><span class="function-name">add_section</span>(<span class="function-arg">xs</span>, **<span class="function-arg">kw</span>)</p><p class="docstr">Copy a CrossSection into the SectionBook. Use this method instead of directly editing the 'xss' list.<br>&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;args:<br>&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;xs - CrossSection object to add to SectionBook (a copy is added)<br>&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;kw:<br>&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;sheet - a new sheet name for the added CrossSection</p>
                <div class="source">
                    <h4 onclick="toggleSource(this)">show source</h4>
                    <div class="code">
                        <div class="highlight"><pre><span></span>    <span class="k">def</span> <span class="nf">add_section</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">xs</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Copy a CrossSection into the SectionBook. Use this method instead of</span>
<span class="sd">        directly editing the &#39;xss&#39; list.</span>
<span class="sd">        args:</span>
<span class="sd">            xs - CrossSection object to add to SectionBook (a copy is added)</span>
<span class="sd">        kw:</span>
<span class="sd">            sheet - a new sheet name for the added CrossSection&quot;&quot;&quot;</span>
        <span class="c1">#copy xs</span>
        <span class="n">xs</span><span class="o">.</span><span class="n">_fields</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="n">xs</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">xs</span><span class="p">)</span>
        <span class="c1">#get sheet</span>
        <span class="k">if</span><span class="p">(</span><span class="s1">&#39;sheet&#39;</span> <span class="ow">in</span> <span class="n">kw</span><span class="p">):</span>
            <span class="n">xs</span><span class="o">.</span><span class="n">sheet</span> <span class="o">=</span> <span class="n">kw</span><span class="p">[</span><span class="s1">&#39;sheet&#39;</span><span class="p">]</span>
        <span class="c1">#Prevent adding CrossSections with the same sheets</span>
        <span class="k">if</span><span class="p">(</span><span class="n">xs</span><span class="o">.</span><span class="n">sheet</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sheet2idx</span><span class="p">):</span>
            <span class="k">raise</span><span class="p">(</span><span class="n">EMFError</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;CrossSection name &quot;</span><span class="si">%s</span><span class="s2">&quot; already exists in the</span>
<span class="s2">            SectionBook. Duplicate names would cause collisions in the lookup</span>
<span class="s2">            dictionary (self._sheet2idx). Use a different name.&quot;&quot;&quot;</span> <span class="o">%</span> <span class="n">xs</span><span class="o">.</span><span class="n">sheet</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1">#add the CrossSection and update indexing dict</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_sheet2idx</span><span class="p">[</span><span class="n">xs</span><span class="o">.</span><span class="n">sheet</span><span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">xss</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">xss</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">xs</span><span class="p">)</span>
            <span class="c1">#associate self with the copied CrossSection</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">xss</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">_sb</span> <span class="o">=</span> <span class="bp">self</span>
</pre></div>

                    </div>
                </div></div><div class="function" id=SectionBook-export><p class="function-str"><span class="function-name">export</span>(**<span class="function-arg">kw</span>)</p><p class="docstr">Write complete sets of model results to an excel workbook with each CrossSection's 'fields' DataFrame in a separate sheet. Also write the ROW_edge_max DataFrame to a csv.<br>&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;kw:<br>&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;path - string, destination/filename for saved file</p>
                <div class="source">
                    <h4 onclick="toggleSource(this)">show source</h4>
                    <div class="code">
                        <div class="highlight"><pre><span></span>    <span class="k">def</span> <span class="nf">export</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Write complete sets of model results to an excel workbook with each</span>
<span class="sd">        CrossSection&#39;s &#39;fields&#39; DataFrame in a separate sheet. Also write the</span>
<span class="sd">        ROW_edge_max DataFrame to a csv.</span>
<span class="sd">        kw:</span>
<span class="sd">            path - string, destination/filename for saved file&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">results_export</span><span class="p">(</span><span class="o">**</span><span class="n">kw</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ROW_edge_export</span><span class="p">(</span><span class="o">**</span><span class="n">kw</span><span class="p">)</span>
</pre></div>

                    </div>
                </div></div><div class="function" id=SectionBook-remove_section><p class="function-str"><span class="function-name">remove_section</span>(<span class="function-arg">sheet</span>)</p><p class="docstr">Remove a CrossSection from the SectionBook by providing its sheet string<br>&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;args:<br>&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;sheet - sheet string of CrossSection to remove</p>
                <div class="source">
                    <h4 onclick="toggleSource(this)">show source</h4>
                    <div class="code">
                        <div class="highlight"><pre><span></span>    <span class="k">def</span> <span class="nf">remove_section</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sheet</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Remove a CrossSection from the SectionBook by providing its sheet string</span>
<span class="sd">        args:</span>
<span class="sd">            sheet - sheet string of CrossSection to remove&quot;&quot;&quot;</span>
        <span class="c1">#check sheet is in self</span>
        <span class="k">if</span><span class="p">(</span><span class="n">sheet</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sheet2idx</span><span class="p">):</span>
            <span class="k">raise</span><span class="p">(</span><span class="n">EMFError</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;Sheet </span><span class="si">%s</span><span class="s2"> cannot be removed because it does not</span>
<span class="s2">            exist in the SectionBook object&quot;&quot;&quot;</span> <span class="o">%</span> <span class="n">sheet</span><span class="p">))</span>
        <span class="c1">#delete from self.xss list</span>
        <span class="n">idx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sheet2idx</span><span class="p">[</span><span class="n">sheet</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">xss</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">idx</span><span class="p">)</span>
        <span class="c1">#update</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_update_sheet2idx</span><span class="p">()</span>
</pre></div>

                    </div>
                </div></div><div class="function" id=SectionBook-results_export><p class="function-str"><span class="function-name">results_export</span>(**<span class="function-arg">kw</span>)</p><p class="docstr">Write all of the cross section results to an excel workbook with each CrossSection's 'fields' DataFrame in a separate sheet.<br>&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;kw:<br>&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;path - string, destination/filename for saved file</p>
                <div class="source">
                    <h4 onclick="toggleSource(this)">show source</h4>
                    <div class="code">
                        <div class="highlight"><pre><span></span>    <span class="k">def</span> <span class="nf">results_export</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Write all of the cross section results to an excel workbook with each</span>
<span class="sd">        CrossSection&#39;s &#39;fields&#39; DataFrame in a separate sheet.</span>
<span class="sd">        kw:</span>
<span class="sd">            path - string, destination/filename for saved file&quot;&quot;&quot;</span>
        <span class="c1">#path management</span>
        <span class="n">fn</span> <span class="o">=</span> <span class="n">fields_funks</span><span class="o">.</span><span class="n">_path_manage</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="s1">&#39;-all_results&#39;</span><span class="p">,</span><span class="s1">&#39;.xlsx&#39;</span><span class="p">,</span><span class="o">**</span><span class="n">kw</span><span class="p">)</span>
        <span class="c1">#write results</span>
        <span class="n">xlwriter</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">ExcelWriter</span><span class="p">(</span><span class="n">fn</span><span class="p">,</span> <span class="n">engine</span><span class="o">=</span><span class="s1">&#39;xlsxwriter&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">xs</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
            <span class="n">xs</span><span class="o">.</span><span class="n">fields</span><span class="o">.</span><span class="n">to_excel</span><span class="p">(</span><span class="n">xlwriter</span><span class="p">,</span> <span class="n">sheet_name</span><span class="o">=</span><span class="n">xs</span><span class="o">.</span><span class="n">sheet</span><span class="p">,</span>
                    <span class="n">index_label</span><span class="o">=</span><span class="s1">&#39;Distance (ft)&#39;</span><span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="s1">&#39;Full SectionBook results written to: </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">fn</span><span class="p">)</span>
</pre></div>

                    </div>
                </div></div><div class="function" id=SectionBook-sample><p class="function-str"><span class="function-name">sample</span>(*<span class="function-arg">args</span>)</p><p class="docstr">Get a random CrossSection from the SectionBook or a list of random CrossSection objects<br>&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;args:<br>&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;an input integer determines the number of random CrossSections returned in a list, which may not be unique</p>
                <div class="source">
                    <h4 onclick="toggleSource(this)">show source</h4>
                    <div class="code">
                        <div class="highlight"><pre><span></span>    <span class="k">def</span> <span class="nf">sample</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Get a random CrossSection from the SectionBook or a list of random CrossSection objects</span>
<span class="sd">        args:</span>
<span class="sd">            an input integer determines the number of random CrossSections</span>
<span class="sd">            returned in a list, which may not be unique&quot;&quot;&quot;</span>
        <span class="k">if</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">):</span>
            <span class="k">return</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">xss</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">))])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">r</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">),</span> <span class="n">size</span><span class="o">=</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="k">return</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">xss</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">r</span><span class="p">])</span>
</pre></div>

                    </div>
                </div></div></div></div></div>

                <!--others section-->
                <div class="section" id="others"><h2>others</h2>
                <div class="other" id="EPSILON">
                    <span class="other-name">EPSILON</span><br>
                    &ensp;&ensp;&ensp;&ensp;<span class="other-type">type:</span>float<br>
                    &ensp;&ensp;&ensp;&ensp;<span class="other-value">value:</span>8.854e-12
                    
                </div>
                <div class="other" id="MU">
                    <span class="other-name">MU</span><br>
                    &ensp;&ensp;&ensp;&ensp;<span class="other-type">type:</span>float<br>
                    &ensp;&ensp;&ensp;&ensp;<span class="other-value">value:</span>1.2566370614359173e-06
                    
                </div>
                <div class="other" id="electric_prefactor">
                    <span class="other-name">electric_prefactor</span><br>
                    &ensp;&ensp;&ensp;&ensp;<span class="other-type">type:</span>float<br>
                    &ensp;&ensp;&ensp;&ensp;<span class="other-value">value:</span>17975484875.976437
                    
                </div>
                <div class="other" id="magnetic_prefactor">
                    <span class="other-name">magnetic_prefactor</span><br>
                    &ensp;&ensp;&ensp;&ensp;<span class="other-type">type:</span>float<br>
                    &ensp;&ensp;&ensp;&ensp;<span class="other-value">value:</span>2.0
                    
                </div>
            </div>

        </body>

        <!--Control the width and height of the #main element-->
        <script type="text/javascript">function arrange(){
    var nav_wrapper = document.getElementById('nav-wrapper');
    var nav = document.getElementById('nav');
    var main = document.getElementById('main');

    var w_nav = nav.offsetWidth + 1;
    var w = w_nav.toString() + 'px';
    main.setAttribute('style', 'margin-left: ' + w);
    main.style.marginLeft = w;

};

arrange();

function toggleSource(obj){
    var parent = obj.parentElement;
    var children = parent.children;

    var header = children[0];
    var code = children[1];
    var codeDisplay = code.style.display;

    if(codeDisplay == 'block'){
        code.style.display = 'none';
        header.innerHTML = 'show source';
        parent.style.borderColor = '#383838'
    }else{
        code.style.display = 'block';
        header.innerHTML = 'hide source';
        parent.style.borderColor = '#C678DD'
    };

    arrange();
};
</script>

    </html>
    